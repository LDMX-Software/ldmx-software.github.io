<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=9"/>
		<meta name="generator" content="Doxygen 1.9.5"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>LDMX Software: g4db Namespace Reference</title>
		<link href="tabs.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
		<link href="doxygen.css" rel="stylesheet" type="text/css" />
		<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom_dark_theme.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectalign" style="padding-left: 0.5em;">
							<div id="projectname">LDMX Software
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a> &#124;
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">g4db Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="namespaces" name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespaceg4db_1_1example"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceg4db_1_1example.html">example</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:namespaceg4db_1_1parse"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceg4db_1_1parse.html">parse</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classg4db_1_1ElementXsecCache.html">ElementXsecCache</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classg4db_1_1ElementXsecInterpolation.html">ElementXsecInterpolation</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classg4db_1_1G4DarkBreMModel.html">G4DarkBreMModel</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structg4db_1_1OutgoingKinematics.html">OutgoingKinematics</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classg4db_1_1PrototypeModel.html">PrototypeModel</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aeb20d92b785bc3bd4b49716e57c31951"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceg4db.html#aeb20d92b785bc3bd4b49716e57c31951">parseLibrary</a> (const std::string &amp;path, int aprime_lhe_id, std::map&lt; int, std::map&lt; double, std::vector&lt; <a class="el" href="structg4db_1_1OutgoingKinematics.html">OutgoingKinematics</a> &gt; &gt; &gt; &amp;lib)</td></tr>
<tr class="separator:aeb20d92b785bc3bd4b49716e57c31951"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac233198f46aede3c840ac70da4980bde"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceg4db.html#ac233198f46aede3c840ac70da4980bde">dumpLibrary</a> (std::ostream &amp;o, const std::map&lt; int, std::map&lt; double, std::vector&lt; <a class="el" href="structg4db_1_1OutgoingKinematics.html">OutgoingKinematics</a> &gt; &gt; &gt; &amp;lib)</td></tr>
<tr class="separator:ac233198f46aede3c840ac70da4980bde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c0369bb92bc1335f0b5d7b99dbd1fe0"><td class="memTemplParams" colspan="2">template&lt;typename IntegrandFunction &gt; </td></tr>
<tr class="memitem:a6c0369bb92bc1335f0b5d7b99dbd1fe0"><td class="memTemplItemLeft" align="right" valign="top">static double&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespaceg4db.html#a6c0369bb92bc1335f0b5d7b99dbd1fe0">integrate</a> (IntegrandFunction F, double low, double high)</td></tr>
<tr class="separator:a6c0369bb92bc1335f0b5d7b99dbd1fe0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abeae992b175580d08a51d8ea7d1a8c45"><td class="memItemLeft" align="right" valign="top">static double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceg4db.html#abeae992b175580d08a51d8ea7d1a8c45">flux_factor_chi_numerical</a> (G4double A, G4double Z, double tmin, double tmax)</td></tr>
<tr class="separator:abeae992b175580d08a51d8ea7d1a8c45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1d8b68fbfacf353705d7b3727f3076d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceg4db.html#aa1d8b68fbfacf353705d7b3727f3076d">hasEnding</a> (const std::string &amp;str, const std::string &amp;end)</td></tr>
<tr class="separator:aa1d8b68fbfacf353705d7b3727f3076d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >G4DarkBreM internal namespace </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ac233198f46aede3c840ac70da4980bde" name="ac233198f46aede3c840ac70da4980bde"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac233198f46aede3c840ac70da4980bde">&#9670;&#160;</a></span>dumpLibrary()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void g4db::dumpLibrary </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; int, std::map&lt; double, std::vector&lt; <a class="el" href="structg4db_1_1OutgoingKinematics.html">OutgoingKinematics</a> &gt; &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>lib</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Dump the input library to the input output stream</p>
<dl class="section note"><dt>Note</dt><dd>This is only helpful for our extraction executable and for testing that the parsing is performing correctly.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">o</td><td>output stream to write CSV to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lib</td><td>library to write out </td></tr>
  </table>
  </dd>
</dl>
<p >This function writes out the input library as CSV to the input output stream in the same format as expected by <a class="el" href="namespaceg4db_1_1parse.html#a6839ecc42cbbabf91ec90d69baeab358">parse::csv</a>.</p>
<p >This function writes out the input library as CSV to the input output stream in the same format as expected by <a class="el" href="namespaceg4db_1_1parse.html#a6839ecc42cbbabf91ec90d69baeab358">parse::csv</a>.</p>

<p class="definition">Definition at line <a class="el" href="ParseLibrary_8cxx_source.html#l00246">246</a> of file <a class="el" href="ParseLibrary_8cxx_source.html">ParseLibrary.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  246</span>                                                                                                       {</div>
<div class="line"><span class="lineno">  251</span>  o &lt;&lt; <span class="stringliteral">&quot;target_Z,incident_energy,recoil_energy,recoil_px,recoil_py,recoil_pz,&quot;</span></div>
<div class="line"><span class="lineno">  252</span>         <span class="stringliteral">&quot;centerMomentum_energy,centerMomentum_px,centerMomentum_py,centerMomentum_pz\n&quot;</span>;</div>
<div class="line"><span class="lineno">  253</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; Z_submap : lib) {</div>
<div class="line"><span class="lineno">  254</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; beam_events : Z_submap.second) {</div>
<div class="line"><span class="lineno">  255</span>      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; sample : beam_events.second) {</div>
<div class="line"><span class="lineno">  256</span>        o &lt;&lt; Z_submap.first &lt;&lt; <span class="charliteral">&#39;,&#39;</span></div>
<div class="line"><span class="lineno">  257</span>          &lt;&lt; sample.E &lt;&lt; <span class="charliteral">&#39;,&#39;</span></div>
<div class="line"><span class="lineno">  258</span>          &lt;&lt; sample.lepton.e() &lt;&lt; <span class="charliteral">&#39;,&#39;</span></div>
<div class="line"><span class="lineno">  259</span>          &lt;&lt; sample.lepton.px() &lt;&lt; <span class="charliteral">&#39;,&#39;</span></div>
<div class="line"><span class="lineno">  260</span>          &lt;&lt; sample.lepton.py() &lt;&lt; <span class="charliteral">&#39;,&#39;</span></div>
<div class="line"><span class="lineno">  261</span>          &lt;&lt; sample.lepton.pz() &lt;&lt; <span class="charliteral">&#39;,&#39;</span></div>
<div class="line"><span class="lineno">  262</span>          &lt;&lt; sample.centerMomentum.e() &lt;&lt; <span class="charliteral">&#39;,&#39;</span></div>
<div class="line"><span class="lineno">  263</span>          &lt;&lt; sample.centerMomentum.px() &lt;&lt; <span class="charliteral">&#39;,&#39;</span></div>
<div class="line"><span class="lineno">  264</span>          &lt;&lt; sample.centerMomentum.py() &lt;&lt; <span class="charliteral">&#39;,&#39;</span></div>
<div class="line"><span class="lineno">  265</span>          &lt;&lt; sample.centerMomentum.pz() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><span class="lineno">  266</span>      }</div>
<div class="line"><span class="lineno">  267</span>    }</div>
<div class="line"><span class="lineno">  268</span>  }</div>
<div class="line"><span class="lineno">  269</span>  o.flush();</div>
<div class="line"><span class="lineno">  270</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="abeae992b175580d08a51d8ea7d1a8c45" name="abeae992b175580d08a51d8ea7d1a8c45"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abeae992b175580d08a51d8ea7d1a8c45">&#9670;&#160;</a></span>flux_factor_chi_numerical()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static double g4db::flux_factor_chi_numerical </td>
          <td>(</td>
          <td class="paramtype">G4double&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">G4double&#160;</td>
          <td class="paramname"><em>Z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>tmin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>tmax</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >numerically integrate the value of the flux factor chi</p>
<p >The integration of the form factor into the flux factor can be done analytically with a tool like mathematica, but when including the inelastic term, it produces such a complicated result that the numerical integration is actually <em>faster</em> than the analytical one.</p>
<p >The form factors are copied from Appendix A (Eq A18 and A19) of <a href="https://journals.aps.org/prd/pdf/10.1103/PhysRevD.80.075018">https://journals.aps.org/prd/pdf/10.1103/PhysRevD.80.075018</a></p>
<p >Here, the equations are listed for reference.  </p><p class="formulaDsp">
<picture><source srcset="form_29_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\begin{equation}
\chi(x,\theta) = \int^{t_{max}}_{t_{min}} dt \left( \frac{Z^2a^4t^2}{(1+a^2t)^2(1+t/d)^2}+\frac{Za_p^4t^2}{(1+a_p^2t)^2(1+t/0.71)^8}\left(1+\frac{t(\mu_p^2-1)}{4m_p^2}\right)^2\right)\frac{t-t_{min}}{t^2}
\end{equation}" src="form_29.png"/></picture>
</p>
<p> where  </p><p class="formulaDsp">
<picture><source srcset="form_30_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\begin{equation}
a = \frac{111.0}{m_e Z^{1/3}}
\quad
a_p = \frac{773.0}{m_e Z^{2/3}}
\quad
d = \frac{0.164}{A^{2/3}}
\end{equation}" src="form_30.png"/></picture>
</p>
<ul>
<li><picture><source srcset="form_31_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$m_e$" src="form_31.png"/></picture> is the mass of the electron in GeV</li>
<li><picture><source srcset="form_32_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$m_p = 0.938$" src="form_32.png"/></picture> is the mass of the proton in GeV</li>
<li><picture><source srcset="form_33_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\mu_p = 2.79$" src="form_33.png"/></picture> is the proton <picture><source srcset="form_34_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\mu$" src="form_34.png"/></picture></li>
<li><picture><source srcset="form_35_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$A$" src="form_35.png"/></picture> is the atomic mass of the target nucleus in amu</li>
<li><picture><source srcset="form_36_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$Z$" src="form_36.png"/></picture> is the atomic number of the target nucleus</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">A</td><td>atomic mass of the target nucleus in amu </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Z</td><td>atomic number of target nucleus </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tmin</td><td>lower limit of integration over t </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tmax</td><td>upper limit of integration over t </td></tr>
  </table>
  </dd>
</dl>
<p >We've manually expanded the integrand to cancel out the 1/t^2 factor from the differential, this helps the numerical integration converge because we aren't teetering on the edge of division by zero</p>
<p >The <code>auto</code> used in the integrand definition represents a <em>function</em> whose return value is a <code>double</code> and which has a single input <code>lnt</code>. This lambda expression saves us the time of having to re-calculate the form factor constants that do not depend on <code>t</code> because it can inherit their values from the environment. The return value is a double since it is calculated by simple arithmetic operations on doubles.</p>
<p >The integrand is so sharply peaked at t close to tmin, it is very helpful to do the integration in the variable u = ln(t) rather than t itself.</p>

<p class="definition">Definition at line <a class="el" href="G4DarkBreMModel_8cxx_source.html#l00094">94</a> of file <a class="el" href="G4DarkBreMModel_8cxx_source.html">G4DarkBreMModel.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   94</span>                                                                                          {</div>
<div class="line"><span class="lineno">   95</span>  <span class="comment">/*</span></div>
<div class="line"><span class="lineno">   96</span><span class="comment">   * bin = (mu_p^2 - 1)/(4 m_pr^2)</span></div>
<div class="line"><span class="lineno">   97</span><span class="comment">   * mel = mass of electron in GeV</span></div>
<div class="line"><span class="lineno">   98</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">   99</span>  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> bin = (2.79*2.79 - 1)/(4*0.938*0.938),</div>
<div class="line"><span class="lineno">  100</span>                      mel = 0.000511;</div>
<div class="line"><span class="lineno">  101</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> ael = 111.0*pow(Z,-1./3.)/mel,</div>
<div class="line"><span class="lineno">  102</span>               del = 0.164*pow(A,-2./3.),</div>
<div class="line"><span class="lineno">  103</span>               ain = 773.0*pow(Z,-2./3.)/mel,</div>
<div class="line"><span class="lineno">  104</span>               din = 0.71,</div>
<div class="line"><span class="lineno">  105</span>               ael_inv2 = pow(ael, -2),</div>
<div class="line"><span class="lineno">  106</span>               ain_inv2 = pow(ain, -2);</div>
<div class="line"><span class="lineno">  107</span> </div>
<div class="line"><span class="lineno">  125</span>  <span class="keyword">auto</span> integrand = [&amp;](<span class="keywordtype">double</span> lnt) {</div>
<div class="line"><span class="lineno">  126</span>    <span class="keywordtype">double</span> t = exp(lnt);</div>
<div class="line"><span class="lineno">  127</span>    <span class="keywordtype">double</span> ael_factor = 1./(ael_inv2 + t),</div>
<div class="line"><span class="lineno">  128</span>           del_factor = 1./(1+t/del),</div>
<div class="line"><span class="lineno">  129</span>           ain_factor = 1./(ain_inv2 + t),</div>
<div class="line"><span class="lineno">  130</span>           din_factor = 1./(1+t/din),</div>
<div class="line"><span class="lineno">  131</span>           nucl = (1 + t*bin);</div>
<div class="line"><span class="lineno">  132</span>    </div>
<div class="line"><span class="lineno">  133</span>    <span class="keywordflow">return</span> (pow(ael_factor*del_factor*Z, 2)</div>
<div class="line"><span class="lineno">  134</span>            + Z*pow(ain_factor*nucl*din_factor*din_factor*din_factor*din_factor, 2)</div>
<div class="line"><span class="lineno">  135</span>           )*(t-tmin)*t;</div>
<div class="line"><span class="lineno">  136</span>  };</div>
<div class="line"><span class="lineno">  137</span> </div>
<div class="line"><span class="lineno">  138</span>  <span class="keywordflow">return</span> integrate(integrand,log(tmin),log(tmax));</div>
<div class="line"><span class="lineno">  139</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="G4DarkBreMModel_8cxx_source.html#l00054">integrate()</a>.</p>

<p class="reference">Referenced by <a class="el" href="G4DarkBreMModel_8cxx_source.html#l00197">g4db::G4DarkBreMModel::ComputeCrossSectionPerAtom()</a>.</p>

</div>
</div>
<a id="aa1d8b68fbfacf353705d7b3727f3076d" name="aa1d8b68fbfacf353705d7b3727f3076d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1d8b68fbfacf353705d7b3727f3076d">&#9670;&#160;</a></span>hasEnding()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool g4db::hasEnding </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>end</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Check if the input string has the input ending</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">str</td><td>string to test </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">end</td><td>ending to have </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the last characters of str are end </dd></dl>

<p class="definition">Definition at line <a class="el" href="ParseLibrary_8cxx_source.html#l00024">24</a> of file <a class="el" href="ParseLibrary_8cxx_source.html">ParseLibrary.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   24</span>                                                           {</div>
<div class="line"><span class="lineno">   25</span>  <span class="keywordflow">if</span> (str.length() &gt;= end.length()) {</div>
<div class="line"><span class="lineno">   26</span>    <span class="keywordflow">return</span> (str.compare(str.length() - end.length(), end.length(), end) == 0);</div>
<div class="line"><span class="lineno">   27</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   28</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   29</span>  }</div>
<div class="line"><span class="lineno">   30</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="ParseLibrary_8cxx_source.html#l00189">parseLibrary()</a>.</p>

</div>
</div>
<a id="a6c0369bb92bc1335f0b5d7b99dbd1fe0" name="a6c0369bb92bc1335f0b5d7b99dbd1fe0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c0369bb92bc1335f0b5d7b99dbd1fe0">&#9670;&#160;</a></span>integrate()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename IntegrandFunction &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static double g4db::integrate </td>
          <td>(</td>
          <td class="paramtype">IntegrandFunction&#160;</td>
          <td class="paramname"><em>F</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>low</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>high</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >The integration method we will be using for our numerical integrals</p>
<p >The Gauss-Kronrod method was chosen due to its ability to limit the number of calls to the function representing the integrand which should help improve performance for us due to the complexity of our integrand. The order of the GK method was chosen after some experimentation, starting at a high value (61) and then lowering it to achieve better performance while checking the accuracy of the results.</p>
<p >As explained in the <a href="https://www.boost.org/doc/libs/master/libs/math/doc/html/math_toolkit/gauss_kronrod.html">Boost GK Docs</a>, generally the error estimation technique for this method is overly pessimistic, so we can confidently set the maximum depth low and the desired relative error high compared to other methods. We have followed the examples in the docs where we use max_depth to 5 and relative error to 1e-9.</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">IntegrandFunction</td><td>function type whose signature is <code>double(*)(double)</code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">F</td><td>function to integrate </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">low</td><td>lower limit of integration </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">high</td><td>upper limit of integration </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="G4DarkBreMModel_8cxx_source.html#l00054">54</a> of file <a class="el" href="G4DarkBreMModel_8cxx_source.html">G4DarkBreMModel.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   54</span>                                                                      {</div>
<div class="line"><span class="lineno">   55</span>  <span class="keyword">using </span>int_method = boost::math::quadrature::gauss_kronrod&lt;double, 61&gt;;</div>
<div class="line"><span class="lineno">   56</span>  <span class="keywordflow">return</span> int_method::integrate(F, low, high, 5, 1e-9);</div>
<div class="line"><span class="lineno">   57</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="G4DarkBreMModel_8cxx_source.html#l00197">g4db::G4DarkBreMModel::ComputeCrossSectionPerAtom()</a>, and <a class="el" href="G4DarkBreMModel_8cxx_source.html#l00094">flux_factor_chi_numerical()</a>.</p>

</div>
</div>
<a id="aeb20d92b785bc3bd4b49716e57c31951" name="aeb20d92b785bc3bd4b49716e57c31951"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb20d92b785bc3bd4b49716e57c31951">&#9670;&#160;</a></span>parseLibrary()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void g4db::parseLibrary </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>aprime_lhe_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::map&lt; int, std::map&lt; double, std::vector&lt; <a class="el" href="structg4db_1_1OutgoingKinematics.html">OutgoingKinematics</a> &gt; &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>lib</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >parse the input library and return the in-memory kinematics library</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Library Specification</h2>
<p >A "library" includes a single file or a directory holding multiple files. No subdirectories are inspected, so the directory must be "flat". Each file in a library can either be a CSV file or an LHE file, both of which can be compressed by gzip if desired.</p>
<h3><a class="anchor" id="autotoc_md11"></a>
CSV</h3>
<p >The CSV file is expected to have a <b>single</b> header line which names the columns. These column names have no requirements (besides the existence of this line).</p>
<p >The CSV is required to have 10 columns on all non-empty lines of the file. The 10 columns of the CSV all are in MeV and <em>in order</em> are</p><ol type="1">
<li>The target Z</li>
<li>The incident lepton energy</li>
<li>The total energy of the recoil</li>
<li>The x-component of the recoil momentum</li>
<li>The y-component of the recoil momentum</li>
<li>The z-component of the recoil momentum</li>
<li>The total energy of the A'</li>
<li>The x-component of the A' momentum</li>
<li>The y-component of the A' momentum</li>
<li>The z-component of the A' momentum</li>
</ol>
<h3><a class="anchor" id="autotoc_md12"></a>
LHE</h3>
<p >The LHE files must have dark brem events in it where "dark brem event" in this context is defined below. </p><div class="fragment"><div class="line">lepton_id -1 &lt;skip&gt; &lt;skip&gt; &lt;skip&gt; &lt;skip&gt; px py pz E m</div>
<div class="line">&lt;skip-line&gt;</div>
<div class="line">&lt;skip-line&gt;</div>
<div class="line">lepton_id 1 &lt;skip&gt; &lt;skip&gt; &lt;skip&gt; &lt;skip&gt; px py pz E m</div>
<div class="line">&lt;skip-line&gt;</div>
<div class="line">&lt;skip-line&gt;</div>
<div class="line">aprime_id 1 &lt;skip&gt; &lt;skip&gt; &lt;skip&gt; &lt;skip&gt; px py pz E m</div>
</div><!-- fragment --><p >We also check each line if it contains a 'Znuc' string. Looking for the target Z value from this line matching the following format. </p><div class="fragment"><div class="line">&lt;num&gt;   &lt;Z&gt; # Znuc &lt;other comments&gt;</div>
</div><!-- fragment --><p> This is supposed to match a line of the param_card dumped into the header of the LHE. In other words, this parser should function properly if your MG/ME model has a configurable parameter in param_card.dat for the target Z and that parameter is called 'Znuc'.</p>
<p >This matches a subcomponent of the LHE scheme written by MadGraph/MadEvent (hence the reason this is the "lhe" parser); however, a lot of information is skipped and additional assumptions are made in order to increase the parsing speed.</p>
<p >The <code>lepton_id</code> is allowed to be <em>either</em> 11 or 13 <em>everywhere</em>. No consistency checking is done.</p>
<p >The <code>E</code> from the first line is used as the incident lepton energy. The four-momentum from the middle line is the recoil lepton's four momentum, and the four-momentum from the last line is used in conjuction with the recoil four-momentum to calculate the center of momentum vector.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">path</td><td>path to library to parse </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">aprime_lhe_id</td><td>the ID number for the A' (aka dark photon) in the library being parsed </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">lib</td><td>map of target Z and incident energy keys to set of outgoing kinematics </td></tr>
  </table>
  </dd>
</dl>
<p >If the input path has one of the four file extensions below, we assume it is a file to be parsed into the library.</p><ul>
<li>'.csv'</li>
<li>'.csv.gz'</li>
<li>'.lhe'</li>
<li>'.lhe.gz'</li>
</ul>
<p >If the extension ends with '.gz', then a decompression step is added to the input stream. Boost.Iostream provides the gzip_decompressor "filter" which does the decompression on the data stream as it is being read in.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="namespaceg4db_1_1parse.html#a6839ecc42cbbabf91ec90d69baeab358">parse::csv</a> for files ending with '.csv' or '.csv.gz' </dd>
<dd>
<a class="el" href="namespaceg4db_1_1parse.html#ae1f0c3e2ec9ce516573f008d535a92ea">parse::lhe</a> for files ending with '.lhe' or '.lhe.gz'</dd></dl>
<p>If the input path <em>does not</em> match one of the four accepted extensions, then we assume it is a directory</p>
<dl class="section note"><dt>Note</dt><dd>We <em>do not</em> recursively enter subdirectories.</dd></dl>
<p>If any of the directory entries has one of the acceptable extensions, we recursively call this function on that file path so that it can be parsed into the library.</p>
<p >If we can't open the path that we assumed was a directory as a directory, we end processing.</p>
<p >If the input path has one of the four file extensions below, we assume it is a file to be parsed into the library.</p><ul>
<li>'.csv'</li>
<li>'.csv.gz'</li>
<li>'.lhe'</li>
<li>'.lhe.gz'</li>
</ul>
<p >If the extension ends with '.gz', then a decompression step is added to the input stream. Boost.Iostream provides the gzip_decompressor "filter" which does the decompression on the data stream as it is being read in.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="namespaceg4db_1_1parse.html#a6839ecc42cbbabf91ec90d69baeab358">parse::csv</a> for files ending with '.csv' or '.csv.gz' </dd>
<dd>
<a class="el" href="namespaceg4db_1_1parse.html#ae1f0c3e2ec9ce516573f008d535a92ea">parse::lhe</a> for files ending with '.lhe' or '.lhe.gz'</dd></dl>
<p>If the input path <em>does not</em> match one of the four accepted extensions, then we assume it is a directory</p>
<dl class="section note"><dt>Note</dt><dd>We <em>do not</em> recursively enter subdirectories.</dd></dl>
<p>If any of the directory entries has one of the acceptable extensions, we recursively call this function on that file path so that it can be parsed into the library.</p>
<p >If we can't open the path that we assumed was a directory as a directory, we end processing.</p>

<p class="definition">Definition at line <a class="el" href="ParseLibrary_8cxx_source.html#l00189">189</a> of file <a class="el" href="ParseLibrary_8cxx_source.html">ParseLibrary.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  189</span>                                                                                                                             {</div>
<div class="line"><span class="lineno">  190</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceg4db.html#aa1d8b68fbfacf353705d7b3727f3076d">hasEnding</a>(path, <span class="stringliteral">&quot;.csv&quot;</span>) or <a class="code hl_function" href="namespaceg4db.html#aa1d8b68fbfacf353705d7b3727f3076d">hasEnding</a>(path, <span class="stringliteral">&quot;.csv.gz&quot;</span>) or <a class="code hl_function" href="namespaceg4db.html#aa1d8b68fbfacf353705d7b3727f3076d">hasEnding</a>(path, <span class="stringliteral">&quot;.lhe&quot;</span>) or <a class="code hl_function" href="namespaceg4db.html#aa1d8b68fbfacf353705d7b3727f3076d">hasEnding</a>(path, <span class="stringliteral">&quot;.lhe.gz&quot;</span>)) {</div>
<div class="line"><span class="lineno">  207</span>    boost::iostreams::filtering_istream reader;</div>
<div class="line"><span class="lineno">  208</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceg4db.html#aa1d8b68fbfacf353705d7b3727f3076d">hasEnding</a>(path, <span class="stringliteral">&quot;.gz&quot;</span>)) reader.push(boost::iostreams::gzip_decompressor());</div>
<div class="line"><span class="lineno">  209</span>    reader.push(boost::iostreams::file_source(path)); </div>
<div class="line"><span class="lineno">  210</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceg4db.html#aa1d8b68fbfacf353705d7b3727f3076d">hasEnding</a>(path, <span class="stringliteral">&quot;.csv&quot;</span>) or <a class="code hl_function" href="namespaceg4db.html#aa1d8b68fbfacf353705d7b3727f3076d">hasEnding</a>(path, <span class="stringliteral">&quot;.csv.gz&quot;</span>)) parse::csv(reader, lib); </div>
<div class="line"><span class="lineno">  211</span>    <span class="keywordflow">else</span> parse::lhe(reader, aprime_lhe_id, lib);</div>
<div class="line"><span class="lineno">  212</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  219</span>    DIR *dir;            <span class="comment">// handle to opened directory</span></div>
<div class="line"><span class="lineno">  220</span>    <span class="keyword">struct </span>dirent *ent;  <span class="comment">// handle to entry inside directory</span></div>
<div class="line"><span class="lineno">  221</span>    <span class="keywordflow">if</span> ((dir = opendir(path.c_str())) != NULL) {</div>
<div class="line"><span class="lineno">  222</span>      <span class="comment">// directory can be opened</span></div>
<div class="line"><span class="lineno">  223</span>      <span class="keywordflow">while</span> ((ent = readdir(dir)) != NULL) {</div>
<div class="line"><span class="lineno">  224</span>        std::string fp = path + <span class="charliteral">&#39;/&#39;</span> + std::string(ent-&gt;d_name);</div>
<div class="line"><span class="lineno">  225</span>        <span class="keywordflow">if</span> (hasEnding(fp,<span class="stringliteral">&quot;.lhe&quot;</span>) or hasEnding(fp, <span class="stringliteral">&quot;.lhe.gz&quot;</span>)</div>
<div class="line"><span class="lineno">  226</span>            or hasEnding(fp,<span class="stringliteral">&quot;.csv&quot;</span>) or hasEnding(fp, <span class="stringliteral">&quot;.csv.gz&quot;</span>)) {</div>
<div class="line"><span class="lineno">  232</span>          parseLibrary(fp, aprime_lhe_id, lib);</div>
<div class="line"><span class="lineno">  233</span>        }</div>
<div class="line"><span class="lineno">  234</span>      }</div>
<div class="line"><span class="lineno">  235</span>      closedir(dir);</div>
<div class="line"><span class="lineno">  236</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  241</span>      <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Unable to open &#39;&quot;</span>+path+<span class="stringliteral">&quot;&#39; as a directory.&quot;</span>);</div>
<div class="line"><span class="lineno">  242</span>    }</div>
<div class="line"><span class="lineno">  243</span>  }</div>
<div class="line"><span class="lineno">  244</span>}</div>
<div class="ttc" id="anamespaceg4db_html_aa1d8b68fbfacf353705d7b3727f3076d"><div class="ttname"><a href="namespaceg4db.html#aa1d8b68fbfacf353705d7b3727f3076d">g4db::hasEnding</a></div><div class="ttdeci">bool hasEnding(const std::string &amp;str, const std::string &amp;end)</div><div class="ttdef"><b>Definition:</b> <a href="ParseLibrary_8cxx_source.html#l00024">ParseLibrary.cxx:24</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ParseLibrary_8cxx_source.html#l00160">g4db::parse::csv()</a>, <a class="el" href="ParseLibrary_8cxx_source.html#l00024">hasEnding()</a>, <a class="el" href="ParseLibrary_8cxx_source.html#l00080">g4db::parse::lhe()</a>, and <a class="el" href="ParseLibrary_8cxx_source.html#l00189">parseLibrary()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ParseLibrary_8cxx_source.html#l00189">parseLibrary()</a>, and <a class="el" href="G4DarkBreMModel_8cxx_source.html#l00506">g4db::G4DarkBreMModel::SetMadGraphDataLibrary()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
		<script src="custom.js"></script>
	</body>
</html>