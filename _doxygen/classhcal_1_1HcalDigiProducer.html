<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=9"/>
		<meta name="generator" content="Doxygen 1.9.1"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>LDMX Software: hcal::HcalDigiProducer Class Reference</title>
		<link href="tabs.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
		<link href="doxygen.css" rel="stylesheet" type="text/css" />
		<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom_dark_theme.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectalign" style="padding-left: 0.5em;">
							<div id="projectname">LDMX Software
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part --><!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>hcal</b></li><li class="navelem"><a class="el" href="classhcal_1_1HcalDigiProducer.html">HcalDigiProducer</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classhcal_1_1HcalDigiProducer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">hcal::HcalDigiProducer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Performs basic HCal digitization.  
 <a href="classhcal_1_1HcalDigiProducer.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="HcalDigiProducer_8h_source.html">HcalDigiProducer.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a20b54ae7c4948024e008586816085c9b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#a20b54ae7c4948024e008586816085c9b">HcalDigiProducer</a> (const std::string &amp;name, <a class="el" href="classframework_1_1Process.html">framework::Process</a> &amp;process)</td></tr>
<tr class="separator:a20b54ae7c4948024e008586816085c9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf52ad892dce51b498f7791891ef2a7a"><td class="memItemLeft" align="right" valign="top"><a id="aaf52ad892dce51b498f7791891ef2a7a"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#aaf52ad892dce51b498f7791891ef2a7a">~HcalDigiProducer</a> ()=default</td></tr>
<tr class="memdesc:aaf52ad892dce51b498f7791891ef2a7a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default destructor. <br /></td></tr>
<tr class="separator:aaf52ad892dce51b498f7791891ef2a7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3bd185138d6bd2edd0acf2e866991d7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#ae3bd185138d6bd2edd0acf2e866991d7">configure</a> (<a class="el" href="classframework_1_1config_1_1Parameters.html">framework::config::Parameters</a> &amp;) final override</td></tr>
<tr class="separator:ae3bd185138d6bd2edd0acf2e866991d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae44fca8b4ef481cb8f82e23c4d7aab2e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#ae44fca8b4ef481cb8f82e23c4d7aab2e">produce</a> (<a class="el" href="classframework_1_1Event.html">framework::Event</a> &amp;event) final override</td></tr>
<tr class="separator:ae44fca8b4ef481cb8f82e23c4d7aab2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classframework_1_1Producer"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classframework_1_1Producer')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classframework_1_1Producer.html">framework::Producer</a></td></tr>
<tr class="memitem:a27ea7492352028e450f24f4750c62e1b inherit pub_methods_classframework_1_1Producer"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1Producer.html#a27ea7492352028e450f24f4750c62e1b">Producer</a> (const std::string &amp;name, <a class="el" href="classframework_1_1Process.html">Process</a> &amp;process)</td></tr>
<tr class="separator:a27ea7492352028e450f24f4750c62e1b inherit pub_methods_classframework_1_1Producer"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b68d090cd4e50c3c572825bc57bebff inherit pub_methods_classframework_1_1Producer"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1Producer.html#a8b68d090cd4e50c3c572825bc57bebff">beforeNewRun</a> (<a class="el" href="classldmx_1_1RunHeader.html">ldmx::RunHeader</a> &amp;header)</td></tr>
<tr class="separator:a8b68d090cd4e50c3c572825bc57bebff inherit pub_methods_classframework_1_1Producer"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classframework_1_1EventProcessor"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classframework_1_1EventProcessor')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classframework_1_1EventProcessor.html">framework::EventProcessor</a></td></tr>
<tr class="memitem:a7b079c9d4c0ac12bd9d1342073a6ae19 inherit pub_methods_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#a7b079c9d4c0ac12bd9d1342073a6ae19">EventProcessor</a> (const std::string &amp;name, <a class="el" href="classframework_1_1Process.html">Process</a> &amp;process)</td></tr>
<tr class="separator:a7b079c9d4c0ac12bd9d1342073a6ae19 inherit pub_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa9cc0358f4d501e403263b19ddc613c inherit pub_methods_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#aaa9cc0358f4d501e403263b19ddc613c">~EventProcessor</a> ()</td></tr>
<tr class="separator:aaa9cc0358f4d501e403263b19ddc613c inherit pub_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93e19454e18fd62bc2081d40b3f41c62 inherit pub_methods_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#a93e19454e18fd62bc2081d40b3f41c62">onNewRun</a> (const <a class="el" href="classldmx_1_1RunHeader.html">ldmx::RunHeader</a> &amp;runHeader)</td></tr>
<tr class="separator:a93e19454e18fd62bc2081d40b3f41c62 inherit pub_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab717fa73bbfb14424eb856e87b760e2c inherit pub_methods_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#ab717fa73bbfb14424eb856e87b760e2c">onFileOpen</a> (<a class="el" href="classframework_1_1EventFile.html">EventFile</a> &amp;eventFile)</td></tr>
<tr class="separator:ab717fa73bbfb14424eb856e87b760e2c inherit pub_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6692c259d89b5ad39ceb2a302cd7e0e5 inherit pub_methods_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#a6692c259d89b5ad39ceb2a302cd7e0e5">onFileClose</a> (<a class="el" href="classframework_1_1EventFile.html">EventFile</a> &amp;eventFile)</td></tr>
<tr class="separator:a6692c259d89b5ad39ceb2a302cd7e0e5 inherit pub_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab54bb3abaafcb4f4b4b42d0a2ff616a9 inherit pub_methods_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#ab54bb3abaafcb4f4b4b42d0a2ff616a9">onProcessStart</a> ()</td></tr>
<tr class="separator:ab54bb3abaafcb4f4b4b42d0a2ff616a9 inherit pub_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a527ebdf1fe665011964d9ce42a5521ad inherit pub_methods_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#a527ebdf1fe665011964d9ce42a5521ad">onProcessEnd</a> ()</td></tr>
<tr class="separator:a527ebdf1fe665011964d9ce42a5521ad inherit pub_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac22d6f61690abaab55a53b8814fb9dd0 inherit pub_methods_classframework_1_1EventProcessor"><td class="memTemplParams" colspan="2">template&lt;class T &gt; </td></tr>
<tr class="memitem:ac22d6f61690abaab55a53b8814fb9dd0 inherit pub_methods_classframework_1_1EventProcessor"><td class="memTemplItemLeft" align="right" valign="top">const T &amp;&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#ac22d6f61690abaab55a53b8814fb9dd0">getCondition</a> (const std::string &amp;condition_name)</td></tr>
<tr class="separator:ac22d6f61690abaab55a53b8814fb9dd0 inherit pub_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae243bb073918259e747a8f8f144b0053 inherit pub_methods_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top">TDirectory *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#ae243bb073918259e747a8f8f144b0053">getHistoDirectory</a> ()</td></tr>
<tr class="separator:ae243bb073918259e747a8f8f144b0053 inherit pub_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f93ec80a4207c3847d629482e81989d inherit pub_methods_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#a2f93ec80a4207c3847d629482e81989d">setStorageHint</a> (framework::StorageControlHint hint)</td></tr>
<tr class="separator:a2f93ec80a4207c3847d629482e81989d inherit pub_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacc5699b669ced944eac4eeea2ade915 inherit pub_methods_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#aacc5699b669ced944eac4eeea2ade915">setStorageHint</a> (framework::StorageControlHint hint, const std::string &amp;purposeString)</td></tr>
<tr class="separator:aacc5699b669ced944eac4eeea2ade915 inherit pub_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af212ff21b3ebec223facbfb02502ecdf inherit pub_methods_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#af212ff21b3ebec223facbfb02502ecdf">getLogFrequency</a> () const</td></tr>
<tr class="separator:af212ff21b3ebec223facbfb02502ecdf inherit pub_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adde4ce813307a7d232eb5f4eda859b42 inherit pub_methods_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#adde4ce813307a7d232eb5f4eda859b42">getRunNumber</a> () const</td></tr>
<tr class="separator:adde4ce813307a7d232eb5f4eda859b42 inherit pub_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9467d0d35043af7ed66a6b46cbca85ca inherit pub_methods_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#a9467d0d35043af7ed66a6b46cbca85ca">getName</a> () const</td></tr>
<tr class="separator:a9467d0d35043af7ed66a6b46cbca85ca inherit pub_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ed5966370da67ee0c89f7d6f9c8436d inherit pub_methods_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#a5ed5966370da67ee0c89f7d6f9c8436d">createHistograms</a> (const std::vector&lt; <a class="el" href="classframework_1_1config_1_1Parameters.html">framework::config::Parameters</a> &gt; &amp;histos)</td></tr>
<tr class="separator:a5ed5966370da67ee0c89f7d6f9c8436d inherit pub_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a7d6e9bf49db864b6fb99b1841b5878c6"><td class="memItemLeft" align="right" valign="top"><a id="a7d6e9bf49db864b6fb99b1841b5878c6"></a>
std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#a7d6e9bf49db864b6fb99b1841b5878c6">inputCollName_</a></td></tr>
<tr class="memdesc:a7d6e9bf49db864b6fb99b1841b5878c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">input hit collection name <br /></td></tr>
<tr class="separator:a7d6e9bf49db864b6fb99b1841b5878c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2806b040b218ebc864abbe3a63db63c"><td class="memItemLeft" align="right" valign="top"><a id="ad2806b040b218ebc864abbe3a63db63c"></a>
std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#ad2806b040b218ebc864abbe3a63db63c">inputPassName_</a></td></tr>
<tr class="memdesc:ad2806b040b218ebc864abbe3a63db63c"><td class="mdescLeft">&#160;</td><td class="mdescRight">input pass name <br /></td></tr>
<tr class="separator:ad2806b040b218ebc864abbe3a63db63c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a326eb0f0fa3ec2013d9bb9ba5cdb37cd"><td class="memItemLeft" align="right" valign="top"><a id="a326eb0f0fa3ec2013d9bb9ba5cdb37cd"></a>
std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#a326eb0f0fa3ec2013d9bb9ba5cdb37cd">digiCollName_</a></td></tr>
<tr class="memdesc:a326eb0f0fa3ec2013d9bb9ba5cdb37cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">output hit collection name <br /></td></tr>
<tr class="separator:a326eb0f0fa3ec2013d9bb9ba5cdb37cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa36ad55847617ebd9238c903d7f93fb3"><td class="memItemLeft" align="right" valign="top"><a id="aa36ad55847617ebd9238c903d7f93fb3"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#aa36ad55847617ebd9238c903d7f93fb3">clockCycle_</a></td></tr>
<tr class="memdesc:aa36ad55847617ebd9238c903d7f93fb3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Time interval for chip clock in ns. <br /></td></tr>
<tr class="separator:aa36ad55847617ebd9238c903d7f93fb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a609560c3306d8250cfe930ce9ead3677"><td class="memItemLeft" align="right" valign="top"><a id="a609560c3306d8250cfe930ce9ead3677"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#a609560c3306d8250cfe930ce9ead3677">nADCs_</a></td></tr>
<tr class="memdesc:a609560c3306d8250cfe930ce9ead3677"><td class="mdescLeft">&#160;</td><td class="mdescRight">Depth of ADC buffer. <br /></td></tr>
<tr class="separator:a609560c3306d8250cfe930ce9ead3677"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbbcd1ed932d4bd6d2b413389c3f361e"><td class="memItemLeft" align="right" valign="top"><a id="adbbcd1ed932d4bd6d2b413389c3f361e"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#adbbcd1ed932d4bd6d2b413389c3f361e">iSOI_</a></td></tr>
<tr class="memdesc:adbbcd1ed932d4bd6d2b413389c3f361e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Index for the Sample Of Interest in the list of digi samples. <br /></td></tr>
<tr class="separator:adbbcd1ed932d4bd6d2b413389c3f361e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a650bae00fb1a9a41789d7e63607958e4"><td class="memItemLeft" align="right" valign="top"><a id="a650bae00fb1a9a41789d7e63607958e4"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#a650bae00fb1a9a41789d7e63607958e4">MeV_</a></td></tr>
<tr class="memdesc:a650bae00fb1a9a41789d7e63607958e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Conversion from energy in MeV to voltage in mV. <br /></td></tr>
<tr class="separator:a650bae00fb1a9a41789d7e63607958e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25dcab4605628b669e1f74ff4f586552"><td class="memItemLeft" align="right" valign="top"><a id="a25dcab4605628b669e1f74ff4f586552"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#a25dcab4605628b669e1f74ff4f586552">attlength_</a></td></tr>
<tr class="memdesc:a25dcab4605628b669e1f74ff4f586552"><td class="mdescLeft">&#160;</td><td class="mdescRight">Strip attenuation length [m]. <br /></td></tr>
<tr class="separator:a25dcab4605628b669e1f74ff4f586552"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01f82c5ba266c333c19196e5819b03e1"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#a01f82c5ba266c333c19196e5819b03e1">noise_</a> {true}</td></tr>
<tr class="separator:a01f82c5ba266c333c19196e5819b03e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a791c6c1074e62a4cecae1233149ff8dd"><td class="memItemLeft" align="right" valign="top"><a id="a791c6c1074e62a4cecae1233149ff8dd"></a>
std::unique_ptr&lt; <a class="el" href="classldmx_1_1HgcrocEmulator.html">ldmx::HgcrocEmulator</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#a791c6c1074e62a4cecae1233149ff8dd">hgcroc_</a></td></tr>
<tr class="memdesc:a791c6c1074e62a4cecae1233149ff8dd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hgcroc Emulator to digitize analog voltage signals. <br /></td></tr>
<tr class="separator:a791c6c1074e62a4cecae1233149ff8dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4db5353e2ed4df91d2349d707ff6ce39"><td class="memItemLeft" align="right" valign="top"><a id="a4db5353e2ed4df91d2349d707ff6ce39"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#a4db5353e2ed4df91d2349d707ff6ce39">ns_</a></td></tr>
<tr class="memdesc:a4db5353e2ed4df91d2349d707ff6ce39"><td class="mdescLeft">&#160;</td><td class="mdescRight">Conversion from time in ns to ticks of the internal clock. <br /></td></tr>
<tr class="separator:a4db5353e2ed4df91d2349d707ff6ce39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29ac2f405f25d3afbd96fb6c4a2bec80"><td class="memItemLeft" align="right" valign="top"><a id="a29ac2f405f25d3afbd96fb6c4a2bec80"></a>
std::unique_ptr&lt; <a class="el" href="classldmx_1_1NoiseGenerator.html">ldmx::NoiseGenerator</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#a29ac2f405f25d3afbd96fb6c4a2bec80">noiseGenerator_</a></td></tr>
<tr class="memdesc:a29ac2f405f25d3afbd96fb6c4a2bec80"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates noise hits based off of number of cells that are not hit. <br /></td></tr>
<tr class="separator:a29ac2f405f25d3afbd96fb6c4a2bec80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adae695077b45d750aa098820bf56d598"><td class="memItemLeft" align="right" valign="top"><a id="adae695077b45d750aa098820bf56d598"></a>
std::unique_ptr&lt; TRandom3 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhcal_1_1HcalDigiProducer.html#adae695077b45d750aa098820bf56d598">noiseInjector_</a></td></tr>
<tr class="memdesc:adae695077b45d750aa098820bf56d598"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates Gaussian noise on top of real hits. <br /></td></tr>
<tr class="separator:adae695077b45d750aa098820bf56d598"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pub_static_methods_classframework_1_1EventProcessor"><td colspan="2" onclick="javascript:toggleInherit('pub_static_methods_classframework_1_1EventProcessor')"><img src="closed.png" alt="-"/>&#160;Static Public Member Functions inherited from <a class="el" href="classframework_1_1EventProcessor.html">framework::EventProcessor</a></td></tr>
<tr class="memitem:a055eb62b2fdde542be4225dfe3a7f9c9 inherit pub_static_methods_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#a055eb62b2fdde542be4225dfe3a7f9c9">declare</a> (const std::string &amp;classname, int classtype, <a class="el" href="namespaceframework.html#a60a0153b9002bf2a85c7c4017e21e568">EventProcessorMaker</a> *)</td></tr>
<tr class="separator:a055eb62b2fdde542be4225dfe3a7f9c9 inherit pub_static_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_static_attribs_classframework_1_1Producer"><td colspan="2" onclick="javascript:toggleInherit('pub_static_attribs_classframework_1_1Producer')"><img src="closed.png" alt="-"/>&#160;Static Public Attributes inherited from <a class="el" href="classframework_1_1Producer.html">framework::Producer</a></td></tr>
<tr class="memitem:a6433d7808e67a79fc83d4c6f7e57224a inherit pub_static_attribs_classframework_1_1Producer"><td class="memItemLeft" align="right" valign="top">static const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1Producer.html#a6433d7808e67a79fc83d4c6f7e57224a">CLASSTYPE</a> {1}</td></tr>
<tr class="separator:a6433d7808e67a79fc83d4c6f7e57224a inherit pub_static_attribs_classframework_1_1Producer"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_methods_classframework_1_1EventProcessor"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_classframework_1_1EventProcessor')"><img src="closed.png" alt="-"/>&#160;Protected Member Functions inherited from <a class="el" href="classframework_1_1EventProcessor.html">framework::EventProcessor</a></td></tr>
<tr class="memitem:a8d42387da8fbb2d1f01f5ecebb64dd7d inherit pro_methods_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#a8d42387da8fbb2d1f01f5ecebb64dd7d">abortEvent</a> ()</td></tr>
<tr class="separator:a8d42387da8fbb2d1f01f5ecebb64dd7d inherit pro_methods_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_attribs_classframework_1_1EventProcessor"><td colspan="2" onclick="javascript:toggleInherit('pro_attribs_classframework_1_1EventProcessor')"><img src="closed.png" alt="-"/>&#160;Protected Attributes inherited from <a class="el" href="classframework_1_1EventProcessor.html">framework::EventProcessor</a></td></tr>
<tr class="memitem:ae8a2bfe0849be1531e195438c1eaba4c inherit pro_attribs_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top"><a id="ae8a2bfe0849be1531e195438c1eaba4c"></a>
<a class="el" href="classframework_1_1HistogramHelper.html">HistogramHelper</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#ae8a2bfe0849be1531e195438c1eaba4c">histograms_</a></td></tr>
<tr class="memdesc:ae8a2bfe0849be1531e195438c1eaba4c inherit pro_attribs_classframework_1_1EventProcessor"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interface class for making and filling histograms. <br /></td></tr>
<tr class="separator:ae8a2bfe0849be1531e195438c1eaba4c inherit pro_attribs_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a410e35c73c9b196961e5c35127321814 inherit pro_attribs_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top"><a id="a410e35c73c9b196961e5c35127321814"></a>
<a class="el" href="classframework_1_1NtupleManager.html">NtupleManager</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#a410e35c73c9b196961e5c35127321814">ntuple_</a> {<a class="el" href="classframework_1_1NtupleManager.html#a95b2bb3823b5a35568c5facb85d441d1">NtupleManager::getInstance</a>()}</td></tr>
<tr class="memdesc:a410e35c73c9b196961e5c35127321814 inherit pro_attribs_classframework_1_1EventProcessor"><td class="mdescLeft">&#160;</td><td class="mdescRight">Manager for any ntuples. <br /></td></tr>
<tr class="separator:a410e35c73c9b196961e5c35127321814 inherit pro_attribs_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae350c3e5c91a69b8910bf1229ed21430 inherit pro_attribs_classframework_1_1EventProcessor"><td class="memItemLeft" align="right" valign="top"><a id="ae350c3e5c91a69b8910bf1229ed21430"></a>
logging::logger&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classframework_1_1EventProcessor.html#ae350c3e5c91a69b8910bf1229ed21430">theLog_</a></td></tr>
<tr class="memdesc:ae350c3e5c91a69b8910bf1229ed21430 inherit pro_attribs_classframework_1_1EventProcessor"><td class="mdescLeft">&#160;</td><td class="mdescRight">The logger for this <a class="el" href="classframework_1_1EventProcessor.html" title="Base class for all event processing components.">EventProcessor</a>. <br /></td></tr>
<tr class="separator:ae350c3e5c91a69b8910bf1229ed21430 inherit pro_attribs_classframework_1_1EventProcessor"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Performs basic HCal digitization. </p>

<p class="definition">Definition at line <a class="el" href="HcalDigiProducer_8h_source.html#l00029">29</a> of file <a class="el" href="HcalDigiProducer_8h_source.html">HcalDigiProducer.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a20b54ae7c4948024e008586816085c9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20b54ae7c4948024e008586816085c9b">&#9670;&nbsp;</a></span>HcalDigiProducer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">hcal::HcalDigiProducer::HcalDigiProducer </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classframework_1_1Process.html">framework::Process</a> &amp;&#160;</td>
          <td class="paramname"><em>process</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Constructor Makes unique noise generator and injector for this class </p>

<p class="definition">Definition at line <a class="el" href="HcalDigiProducer_8cxx_source.html#l00015">15</a> of file <a class="el" href="HcalDigiProducer_8cxx_source.html">HcalDigiProducer.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    : <a class="code" href="classframework_1_1Producer.html#a27ea7492352028e450f24f4750c62e1b">Producer</a>(name, process) {</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">   * Noise generator by default uses a Gausian model for noise</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">   * i.e. It assumes the noise is distributed around a mean (setPedestal)</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">   * with a certain RMS (setNoise) and then calculates</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">   * how many hits should be generated for a given number of empty</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">   * channels and a minimum readout value (setNoiseThreshold)</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <a class="code" href="classhcal_1_1HcalDigiProducer.html#a29ac2f405f25d3afbd96fb6c4a2bec80">noiseGenerator_</a> = std::make_unique&lt;ldmx::NoiseGenerator&gt;();</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;}</div>
<div class="ttc" id="aclassframework_1_1Producer_html_a27ea7492352028e450f24f4750c62e1b"><div class="ttname"><a href="classframework_1_1Producer.html#a27ea7492352028e450f24f4750c62e1b">framework::Producer::Producer</a></div><div class="ttdeci">Producer(const std::string &amp;name, Process &amp;process)</div><div class="ttdef"><b>Definition:</b> <a href="EventProcessor_8cxx_source.html#l00068">EventProcessor.cxx:68</a></div></div>
<div class="ttc" id="aclasshcal_1_1HcalDigiProducer_html_a29ac2f405f25d3afbd96fb6c4a2bec80"><div class="ttname"><a href="classhcal_1_1HcalDigiProducer.html#a29ac2f405f25d3afbd96fb6c4a2bec80">hcal::HcalDigiProducer::noiseGenerator_</a></div><div class="ttdeci">std::unique_ptr&lt; ldmx::NoiseGenerator &gt; noiseGenerator_</div><div class="ttdoc">Generates noise hits based off of number of cells that are not hit.</div><div class="ttdef"><b>Definition:</b> <a href="HcalDigiProducer_8h_source.html#l00094">HcalDigiProducer.h:94</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="HcalDigiProducer_8h_source.html#l00094">noiseGenerator_</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ae3bd185138d6bd2edd0acf2e866991d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3bd185138d6bd2edd0acf2e866991d7">&#9670;&nbsp;</a></span>configure()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void hcal::HcalDigiProducer::configure </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classframework_1_1config_1_1Parameters.html">framework::config::Parameters</a> &amp;&#160;</td>
          <td class="paramname"><em>ps</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">final</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Configure this producer from the python configuration. Sets event constants and configures the noise generator, noise injector, and pulse function. Creates digi collection </p>

<p>Reimplemented from <a class="el" href="classframework_1_1EventProcessor.html#a21156f6f3954394925e9a265de9d702a">framework::EventProcessor</a>.</p>

<p class="definition">Definition at line <a class="el" href="HcalDigiProducer_8cxx_source.html#l00028">28</a> of file <a class="el" href="HcalDigiProducer_8cxx_source.html">HcalDigiProducer.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;                                                              {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="comment">// settings of readout chip</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="comment">//  used  in actual digitization</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keyword">auto</span> hgcrocParams = ps.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;<a class="code" href="classframework_1_1config_1_1Parameters.html">framework::config::Parameters</a>&gt;(<span class="stringliteral">&quot;hgcroc&quot;</span>);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="classhcal_1_1HcalDigiProducer.html#a791c6c1074e62a4cecae1233149ff8dd">hgcroc_</a> = std::make_unique&lt;ldmx::HgcrocEmulator&gt;(hgcrocParams);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <a class="code" href="classhcal_1_1HcalDigiProducer.html#aa36ad55847617ebd9238c903d7f93fb3">clockCycle_</a> = hgcrocParams.getParameter&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;clockCycle&quot;</span>);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="classhcal_1_1HcalDigiProducer.html#a609560c3306d8250cfe930ce9ead3677">nADCs_</a> = hgcrocParams.getParameter&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;nADCs&quot;</span>);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="classhcal_1_1HcalDigiProducer.html#adbbcd1ed932d4bd6d2b413389c3f361e">iSOI_</a> = hgcrocParams.getParameter&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;iSOI&quot;</span>);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <a class="code" href="classhcal_1_1HcalDigiProducer.html#a01f82c5ba266c333c19196e5819b03e1">noise_</a> = hgcrocParams.getParameter&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;noise&quot;</span>);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="comment">// collection names</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <a class="code" href="classhcal_1_1HcalDigiProducer.html#a7d6e9bf49db864b6fb99b1841b5878c6">inputCollName_</a> = ps.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;std::string&gt;(<span class="stringliteral">&quot;inputCollName&quot;</span>);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <a class="code" href="classhcal_1_1HcalDigiProducer.html#ad2806b040b218ebc864abbe3a63db63c">inputPassName_</a> = ps.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;std::string&gt;(<span class="stringliteral">&quot;inputPassName&quot;</span>);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <a class="code" href="classhcal_1_1HcalDigiProducer.html#a326eb0f0fa3ec2013d9bb9ba5cdb37cd">digiCollName_</a> = ps.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;std::string&gt;(<span class="stringliteral">&quot;digiCollName&quot;</span>);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="comment">// physical constants</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="comment">//  used to calculate unit conversions</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <a class="code" href="classhcal_1_1HcalDigiProducer.html#a650bae00fb1a9a41789d7e63607958e4">MeV_</a> = ps.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;MeV&quot;</span>);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <a class="code" href="classhcal_1_1HcalDigiProducer.html#a25dcab4605628b669e1f74ff4f586552">attlength_</a> = ps.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;attenuationLength&quot;</span>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="comment">// Time -&gt; clock counts conversion</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="comment">//  time [ns] * ( 2^10 / max time in ns ) = clock counts</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <a class="code" href="classhcal_1_1HcalDigiProducer.html#a4db5353e2ed4df91d2349d707ff6ce39">ns_</a> = 1024. / <a class="code" href="classhcal_1_1HcalDigiProducer.html#aa36ad55847617ebd9238c903d7f93fb3">clockCycle_</a>;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="comment">// Configure generator that will produce noise hits in empty channels</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordtype">double</span> readoutThreshold = ps.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;avgReadoutThreshold&quot;</span>);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keywordtype">double</span> gain = ps.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;avgGain&quot;</span>);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keywordtype">double</span> pedestal = ps.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;avgPedestal&quot;</span>);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">// rms noise in mV</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <a class="code" href="classhcal_1_1HcalDigiProducer.html#a29ac2f405f25d3afbd96fb6c4a2bec80">noiseGenerator_</a>-&gt;setNoise(</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      hgcrocParams.getParameter&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;noiseRMS&quot;</span>));  <span class="comment">// rms noise in mV</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="comment">// mean noise amplitude (if using Gaussian Model for the noise) in mV</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <a class="code" href="classhcal_1_1HcalDigiProducer.html#a29ac2f405f25d3afbd96fb6c4a2bec80">noiseGenerator_</a>-&gt;setPedestal(gain * pedestal);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="comment">// threshold for readout in mV</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <a class="code" href="classhcal_1_1HcalDigiProducer.html#a29ac2f405f25d3afbd96fb6c4a2bec80">noiseGenerator_</a>-&gt;setNoiseThreshold(gain * readoutThreshold);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;}</div>
<div class="ttc" id="aclassframework_1_1config_1_1Parameters_html"><div class="ttname"><a href="classframework_1_1config_1_1Parameters.html">framework::config::Parameters</a></div><div class="ttdef"><b>Definition:</b> <a href="Parameters_8h_source.html#l00027">Parameters.h:27</a></div></div>
<div class="ttc" id="aclassframework_1_1config_1_1Parameters_html_a18206b7c01007dd706abce7e5505eae1"><div class="ttname"><a href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">framework::config::Parameters::getParameter</a></div><div class="ttdeci">T getParameter(const std::string &amp;name) const</div><div class="ttdef"><b>Definition:</b> <a href="Parameters_8h_source.html#l00089">Parameters.h:89</a></div></div>
<div class="ttc" id="aclasshcal_1_1HcalDigiProducer_html_a01f82c5ba266c333c19196e5819b03e1"><div class="ttname"><a href="classhcal_1_1HcalDigiProducer.html#a01f82c5ba266c333c19196e5819b03e1">hcal::HcalDigiProducer::noise_</a></div><div class="ttdeci">bool noise_</div><div class="ttdef"><b>Definition:</b> <a href="HcalDigiProducer_8h_source.html#l00085">HcalDigiProducer.h:85</a></div></div>
<div class="ttc" id="aclasshcal_1_1HcalDigiProducer_html_a25dcab4605628b669e1f74ff4f586552"><div class="ttname"><a href="classhcal_1_1HcalDigiProducer.html#a25dcab4605628b669e1f74ff4f586552">hcal::HcalDigiProducer::attlength_</a></div><div class="ttdeci">double attlength_</div><div class="ttdoc">Strip attenuation length [m].</div><div class="ttdef"><b>Definition:</b> <a href="HcalDigiProducer_8h_source.html#l00078">HcalDigiProducer.h:78</a></div></div>
<div class="ttc" id="aclasshcal_1_1HcalDigiProducer_html_a326eb0f0fa3ec2013d9bb9ba5cdb37cd"><div class="ttname"><a href="classhcal_1_1HcalDigiProducer.html#a326eb0f0fa3ec2013d9bb9ba5cdb37cd">hcal::HcalDigiProducer::digiCollName_</a></div><div class="ttdeci">std::string digiCollName_</div><div class="ttdoc">output hit collection name</div><div class="ttdef"><b>Definition:</b> <a href="HcalDigiProducer_8h_source.html#l00063">HcalDigiProducer.h:63</a></div></div>
<div class="ttc" id="aclasshcal_1_1HcalDigiProducer_html_a4db5353e2ed4df91d2349d707ff6ce39"><div class="ttname"><a href="classhcal_1_1HcalDigiProducer.html#a4db5353e2ed4df91d2349d707ff6ce39">hcal::HcalDigiProducer::ns_</a></div><div class="ttdeci">double ns_</div><div class="ttdoc">Conversion from time in ns to ticks of the internal clock.</div><div class="ttdef"><b>Definition:</b> <a href="HcalDigiProducer_8h_source.html#l00091">HcalDigiProducer.h:91</a></div></div>
<div class="ttc" id="aclasshcal_1_1HcalDigiProducer_html_a609560c3306d8250cfe930ce9ead3677"><div class="ttname"><a href="classhcal_1_1HcalDigiProducer.html#a609560c3306d8250cfe930ce9ead3677">hcal::HcalDigiProducer::nADCs_</a></div><div class="ttdeci">int nADCs_</div><div class="ttdoc">Depth of ADC buffer.</div><div class="ttdef"><b>Definition:</b> <a href="HcalDigiProducer_8h_source.html#l00069">HcalDigiProducer.h:69</a></div></div>
<div class="ttc" id="aclasshcal_1_1HcalDigiProducer_html_a650bae00fb1a9a41789d7e63607958e4"><div class="ttname"><a href="classhcal_1_1HcalDigiProducer.html#a650bae00fb1a9a41789d7e63607958e4">hcal::HcalDigiProducer::MeV_</a></div><div class="ttdeci">double MeV_</div><div class="ttdoc">Conversion from energy in MeV to voltage in mV.</div><div class="ttdef"><b>Definition:</b> <a href="HcalDigiProducer_8h_source.html#l00075">HcalDigiProducer.h:75</a></div></div>
<div class="ttc" id="aclasshcal_1_1HcalDigiProducer_html_a791c6c1074e62a4cecae1233149ff8dd"><div class="ttname"><a href="classhcal_1_1HcalDigiProducer.html#a791c6c1074e62a4cecae1233149ff8dd">hcal::HcalDigiProducer::hgcroc_</a></div><div class="ttdeci">std::unique_ptr&lt; ldmx::HgcrocEmulator &gt; hgcroc_</div><div class="ttdoc">Hgcroc Emulator to digitize analog voltage signals.</div><div class="ttdef"><b>Definition:</b> <a href="HcalDigiProducer_8h_source.html#l00088">HcalDigiProducer.h:88</a></div></div>
<div class="ttc" id="aclasshcal_1_1HcalDigiProducer_html_a7d6e9bf49db864b6fb99b1841b5878c6"><div class="ttname"><a href="classhcal_1_1HcalDigiProducer.html#a7d6e9bf49db864b6fb99b1841b5878c6">hcal::HcalDigiProducer::inputCollName_</a></div><div class="ttdeci">std::string inputCollName_</div><div class="ttdoc">input hit collection name</div><div class="ttdef"><b>Definition:</b> <a href="HcalDigiProducer_8h_source.html#l00057">HcalDigiProducer.h:57</a></div></div>
<div class="ttc" id="aclasshcal_1_1HcalDigiProducer_html_aa36ad55847617ebd9238c903d7f93fb3"><div class="ttname"><a href="classhcal_1_1HcalDigiProducer.html#aa36ad55847617ebd9238c903d7f93fb3">hcal::HcalDigiProducer::clockCycle_</a></div><div class="ttdeci">double clockCycle_</div><div class="ttdoc">Time interval for chip clock in ns.</div><div class="ttdef"><b>Definition:</b> <a href="HcalDigiProducer_8h_source.html#l00066">HcalDigiProducer.h:66</a></div></div>
<div class="ttc" id="aclasshcal_1_1HcalDigiProducer_html_ad2806b040b218ebc864abbe3a63db63c"><div class="ttname"><a href="classhcal_1_1HcalDigiProducer.html#ad2806b040b218ebc864abbe3a63db63c">hcal::HcalDigiProducer::inputPassName_</a></div><div class="ttdeci">std::string inputPassName_</div><div class="ttdoc">input pass name</div><div class="ttdef"><b>Definition:</b> <a href="HcalDigiProducer_8h_source.html#l00060">HcalDigiProducer.h:60</a></div></div>
<div class="ttc" id="aclasshcal_1_1HcalDigiProducer_html_adbbcd1ed932d4bd6d2b413389c3f361e"><div class="ttname"><a href="classhcal_1_1HcalDigiProducer.html#adbbcd1ed932d4bd6d2b413389c3f361e">hcal::HcalDigiProducer::iSOI_</a></div><div class="ttdeci">int iSOI_</div><div class="ttdoc">Index for the Sample Of Interest in the list of digi samples.</div><div class="ttdef"><b>Definition:</b> <a href="HcalDigiProducer_8h_source.html#l00072">HcalDigiProducer.h:72</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="HcalDigiProducer_8h_source.html#l00078">attlength_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00066">clockCycle_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00063">digiCollName_</a>, <a class="el" href="Parameters_8h_source.html#l00089">framework::config::Parameters::getParameter()</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00088">hgcroc_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00057">inputCollName_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00060">inputPassName_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00072">iSOI_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00075">MeV_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00069">nADCs_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00085">noise_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00094">noiseGenerator_</a>, and <a class="el" href="HcalDigiProducer_8h_source.html#l00091">ns_</a>.</p>

</div>
</div>
<a id="ae44fca8b4ef481cb8f82e23c4d7aab2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae44fca8b4ef481cb8f82e23c4d7aab2e">&#9670;&nbsp;</a></span>produce()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void hcal::HcalDigiProducer::produce </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classframework_1_1Event.html">framework::Event</a> &amp;&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">final</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Simulates measurement of pulse and creates digi collection for input event. </p>
<p>Define two pulses: with positive and negative ends. For this we need to: (1) Find the position along the bar: For back Hcal: x (y) for even (odd) layers. For side Hcal: x (top,bottom) and y (left,right).</p>
<p>(2) Define the end of the bar: The end of an HcalDigiID is based on its distance (x,y) along the bar.</p><ul>
<li>A positive end (endID=0), corresponds to top,left.</li>
<li>A negative end (endID=1), corresponds to bottom,right. For back Hcal:</li>
<li>if the position along the bar &gt; 0, the close pulse's end is 0, else 1. For side Hcal:</li>
<li>if the position along the bar &gt; half_width point of the bar, the close pulse's end is 0, else 1. The far pulse's end will be opposite to the close pulse's end.</li>
</ul>
<p>(3) Find the distance to each end (positive and negative) from the origin. For the back Hcal, the half point of the bar coincides with the coordinates of the origin. For the side Hcal, the length of the bar from the origin is:</p><ul>
<li>2 *(half_width) - Ecal_dx(y)/2 away from the positive end, and,</li>
<li>Ecal_dx(y) away from the negative end.</li>
</ul>
<p>Now we have all the sub-hits from all the simhits Digitize: For back Hcal return two digis. For side Hcal we choose which pulse to readout based on the position of the hit and the sub-section. For Top and Left we read the positive end digi. For Bottom and Right we read the negative end digi.</p>

<p>Implements <a class="el" href="classframework_1_1Producer.html#a8591fb1e12fd5d8b1f2a5838d030042e">framework::Producer</a>.</p>

<p class="definition">Definition at line <a class="el" href="HcalDigiProducer_8cxx_source.html#l00065">65</a> of file <a class="el" href="HcalDigiProducer_8cxx_source.html">HcalDigiProducer.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                                                    {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="comment">// Handle seeding on the first event</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classhcal_1_1HcalDigiProducer.html#a29ac2f405f25d3afbd96fb6c4a2bec80">noiseGenerator_</a>-&gt;hasSeed()) {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; rseed = getCondition&lt;framework::RandomNumberSeedService&gt;(</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <a class="code" href="classframework_1_1RandomNumberSeedService.html#a48e87463ea63d1862064cad26d5b9bb4">framework::RandomNumberSeedService::CONDITIONS_OBJECT_NAME</a>);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="classhcal_1_1HcalDigiProducer.html#a29ac2f405f25d3afbd96fb6c4a2bec80">noiseGenerator_</a>-&gt;seedGenerator(</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        rseed.getSeed(<span class="stringliteral">&quot;HcalDigiProducer::NoiseGenerator&quot;</span>));</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classhcal_1_1HcalDigiProducer.html#adae695077b45d750aa098820bf56d598">noiseInjector_</a>.get() == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; rseed = getCondition&lt;framework::RandomNumberSeedService&gt;(</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <a class="code" href="classframework_1_1RandomNumberSeedService.html#a48e87463ea63d1862064cad26d5b9bb4">framework::RandomNumberSeedService::CONDITIONS_OBJECT_NAME</a>);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <a class="code" href="classhcal_1_1HcalDigiProducer.html#adae695077b45d750aa098820bf56d598">noiseInjector_</a> = std::make_unique&lt;TRandom3&gt;(</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        rseed.getSeed(<span class="stringliteral">&quot;HcalDigiProducer::NoiseInjector&quot;</span>));</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classhcal_1_1HcalDigiProducer.html#a791c6c1074e62a4cecae1233149ff8dd">hgcroc_</a>-&gt;hasSeed()) {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; rseed = getCondition&lt;framework::RandomNumberSeedService&gt;(</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <a class="code" href="classframework_1_1RandomNumberSeedService.html#a48e87463ea63d1862064cad26d5b9bb4">framework::RandomNumberSeedService::CONDITIONS_OBJECT_NAME</a>);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="classhcal_1_1HcalDigiProducer.html#a791c6c1074e62a4cecae1233149ff8dd">hgcroc_</a>-&gt;seedGenerator(rseed.getSeed(<span class="stringliteral">&quot;HcalDigiProducer::HgcrocEmulator&quot;</span>));</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  }</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="comment">// Get the Hgcroc Conditions</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <a class="code" href="classhcal_1_1HcalDigiProducer.html#a791c6c1074e62a4cecae1233149ff8dd">hgcroc_</a>-&gt;condition(</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      getCondition&lt;conditions::DoubleTableCondition&gt;(<span class="stringliteral">&quot;HcalHgcrocConditions&quot;</span>));</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="comment">// Get the Hcal Geometry</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; hcalGeometry = getCondition&lt;ldmx::HcalGeometry&gt;(</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <a class="code" href="classldmx_1_1HcalGeometry.html#a509523c5f18a53d16be9d6a79e6e590a">ldmx::HcalGeometry::CONDITIONS_OBJECT_NAME</a>);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">// Empty collection to be filled</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="classldmx_1_1HgcrocDigiCollection.html">ldmx::HgcrocDigiCollection</a> hcalDigis;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  hcalDigis.<a class="code" href="classldmx_1_1HgcrocDigiCollection.html#a710b705f129831a7029b9b42c3dcdf23">setNumSamplesPerDigi</a>(<a class="code" href="classhcal_1_1HcalDigiProducer.html#a609560c3306d8250cfe930ce9ead3677">nADCs_</a>);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  hcalDigis.<a class="code" href="classldmx_1_1HgcrocDigiCollection.html#aa7400fd63b92e03d22f94898630f1f77">setSampleOfInterestIndex</a>(<a class="code" href="classhcal_1_1HcalDigiProducer.html#adbbcd1ed932d4bd6d2b413389c3f361e">iSOI_</a>);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  std::map&lt;unsigned int, std::vector&lt;const ldmx::SimCalorimeterHit*&gt;&gt; hitsByID;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">// get simulated hcal hits from Geant4 and group them by id</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keyword">auto</span> hcalSimHits{<span class="keyword">event</span>.getCollection&lt;<a class="code" href="classldmx_1_1SimCalorimeterHit.html">ldmx::SimCalorimeterHit</a>&gt;(</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <a class="code" href="classhcal_1_1HcalDigiProducer.html#a7d6e9bf49db864b6fb99b1841b5878c6">inputCollName_</a>, <a class="code" href="classhcal_1_1HcalDigiProducer.html#ad2806b040b218ebc864abbe3a63db63c">inputPassName_</a>)};</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; simHit : hcalSimHits) {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">// get ID</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hitID = simHit.<a class="code" href="classldmx_1_1SimCalorimeterHit.html#aa253dffd148f4f5dc07288cfd7a0fa85">getID</a>();</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keyword">auto</span> idh = hitsByID.find(hitID);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">if</span> (idh == hitsByID.end()) {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      hitsByID[hitID] = std::vector&lt;const ldmx::SimCalorimeterHit*&gt;(1, &amp;simHit);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      idh-&gt;second.push_back(&amp;simHit);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">  /******************************************************************************************</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">   * HGCROC Emulation on Simulated Hits (grouped by HcalID)</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">   ******************************************************************************************/</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; simBar : hitsByID) {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <a class="code" href="classldmx_1_1HcalID.html">ldmx::HcalID</a> detID(simBar.first);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordtype">int</span> section = detID.section();</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordtype">int</span> layer = detID.layer();</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordtype">int</span> strip = detID.strip();</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// get position</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordtype">double</span> half_total_width = hcalGeometry.getHalfTotalWidth(section);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordtype">double</span> ecal_dx = hcalGeometry.getEcalDx();</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordtype">double</span> ecal_dy = hcalGeometry.getEcalDy();</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">// contributions</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    std::vector&lt;std::pair&lt;double, double&gt;&gt; pulses_posend;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    std::vector&lt;std::pair&lt;double, double&gt;&gt; pulses_negend;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> psimHit : simBar.second) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="keyword">const</span> <a class="code" href="classldmx_1_1SimCalorimeterHit.html">ldmx::SimCalorimeterHit</a>&amp; simHit = *psimHit;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      std::vector&lt;float&gt; position = simHit.<a class="code" href="classldmx_1_1SimCalorimeterHit.html#a2e91af4c19fa6aadb1c3a8bceb6c32a9">getPosition</a>();</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <span class="keywordtype">float</span> distance_along_bar, distance_ecal;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="keywordtype">float</span> distance_close, distance_far;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <span class="keywordtype">int</span> end_close;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="keywordflow">if</span> (section == ldmx::HcalID::HcalSection::BACK) {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        distance_along_bar = (layer % 2) ? position[0] : position[1];</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        end_close = (distance_along_bar &gt; 0) ? 0 : 1;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        distance_close = half_total_width;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        distance_far = half_total_width;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">if</span> ((section == ldmx::HcalID::HcalSection::TOP) ||</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            ((section == ldmx::HcalID::HcalSection::BOTTOM))) {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;          distance_along_bar = position[0];</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;          distance_ecal = ecal_dx;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((section == ldmx::HcalID::HcalSection::LEFT) ||</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                   (section == ldmx::HcalID::HcalSection::RIGHT)) {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;          distance_along_bar = position[1];</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;          distance_ecal = ecal_dy;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        end_close = (distance_along_bar &gt; half_total_width) ? 0 : 1;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        distance_close = (end_close == 0)</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                             ? 2 * half_total_width - distance_ecal / 2</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                             : distance_ecal / 2;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        distance_far = (end_close == 0)</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                           ? distance_ecal / 2</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                           : 2 * half_total_width - distance_ecal / 2;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      }</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="comment">// Calculate voltage attenuation and time shift for the close and far</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="comment">// pulse.</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <span class="keywordtype">float</span> v = 299.792 /</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                1.6;  <span class="comment">// velocity of light in Polystyrene, n = 1.6 = c/v mm/ns</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <span class="keywordtype">double</span> att_close =</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;          exp(-1. * ((distance_close - fabs(distance_along_bar)) / 1000.) /</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;              <a class="code" href="classhcal_1_1HcalDigiProducer.html#a25dcab4605628b669e1f74ff4f586552">attlength_</a>);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="keywordtype">double</span> att_far =</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;          exp(-1. * ((distance_far + fabs(distance_along_bar)) / 1000.) /</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;              <a class="code" href="classhcal_1_1HcalDigiProducer.html#a25dcab4605628b669e1f74ff4f586552">attlength_</a>);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="keywordtype">double</span> shift_close =</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;          fabs((distance_close - fabs(distance_along_bar)) / v);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <span class="keywordtype">double</span> shift_far = fabs((distance_far + fabs(distance_along_bar)) / v);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="comment">// Get voltages and times.</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iContrib = 0; iContrib &lt; simHit.<a class="code" href="classldmx_1_1SimCalorimeterHit.html#a3696b8480b0bf0455fd22b2097a258e7">getNumberOfContribs</a>();</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;           iContrib++) {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="keywordtype">double</span> voltage = simHit.<a class="code" href="classldmx_1_1SimCalorimeterHit.html#a6f5cc61053300b17a4a5a4b52b33f3d5">getContrib</a>(iContrib).<a class="code" href="structldmx_1_1SimCalorimeterHit_1_1Contrib.html#adcfa3f67936c8b0ca74192cf7a029fd9">edep</a> * <a class="code" href="classhcal_1_1HcalDigiProducer.html#a650bae00fb1a9a41789d7e63607958e4">MeV_</a>;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keywordtype">double</span> time =</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            simHit.<a class="code" href="classldmx_1_1SimCalorimeterHit.html#a6f5cc61053300b17a4a5a4b52b33f3d5">getContrib</a>(iContrib).<a class="code" href="structldmx_1_1SimCalorimeterHit_1_1Contrib.html#a6a59b1b0f67e9208f46e6a8f478943fe">time</a>;  <span class="comment">// global time (t=0ns at target)</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        time -= position.at(2) /</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                299.702547;  <span class="comment">// shift light-speed particle traveling along z</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">if</span> (end_close == 0) {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;          pulses_posend.emplace_back(voltage * att_close, time + shift_close);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;          pulses_negend.emplace_back(voltage * att_far, time + shift_far);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;          pulses_posend.emplace_back(voltage * att_far, time + shift_far);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;          pulses_negend.emplace_back(voltage * att_close, time + shift_close);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">if</span> (section == ldmx::HcalID::HcalSection::BACK) {</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      std::vector&lt;ldmx::HgcrocDigiCollection::Sample&gt; digiToAddPosend,</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;          digiToAddNegend;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      <a class="code" href="classldmx_1_1HcalDigiID.html">ldmx::HcalDigiID</a> posendID(section, layer, strip, 0);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <a class="code" href="classldmx_1_1HcalDigiID.html">ldmx::HcalDigiID</a> negendID(section, layer, strip, 1);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classhcal_1_1HcalDigiProducer.html#a791c6c1074e62a4cecae1233149ff8dd">hgcroc_</a>-&gt;digitize(posendID.raw(), pulses_posend, digiToAddPosend) &amp;&amp;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;          <a class="code" href="classhcal_1_1HcalDigiProducer.html#a791c6c1074e62a4cecae1233149ff8dd">hgcroc_</a>-&gt;digitize(negendID.raw(), pulses_negend, digiToAddNegend)) {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        hcalDigis.<a class="code" href="classldmx_1_1HgcrocDigiCollection.html#ad6607762651c38c82453a787dd2da582">addDigi</a>(posendID.raw(), digiToAddPosend);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        hcalDigis.<a class="code" href="classldmx_1_1HgcrocDigiCollection.html#ad6607762651c38c82453a787dd2da582">addDigi</a>(negendID.raw(), digiToAddNegend);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      }  <span class="comment">// Back Hcal needs to digitize both pulses or none</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="keywordtype">bool</span> is_posend = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      std::vector&lt;ldmx::HgcrocDigiCollection::Sample&gt; digiToAdd;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="keywordflow">if</span> ((section == ldmx::HcalID::HcalSection::TOP) ||</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;          (section == ldmx::HcalID::HcalSection::LEFT)) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        is_posend = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((section == ldmx::HcalID::HcalSection::BOTTOM) ||</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                 (section == ldmx::HcalID::HcalSection::RIGHT)) {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        is_posend = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      }</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <span class="keywordflow">if</span> (is_posend) {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <a class="code" href="classldmx_1_1HcalDigiID.html">ldmx::HcalDigiID</a> digiID(section, layer, strip, 0);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classhcal_1_1HcalDigiProducer.html#a791c6c1074e62a4cecae1233149ff8dd">hgcroc_</a>-&gt;digitize(digiID.raw(), pulses_posend, digiToAdd)) {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;          hcalDigis.<a class="code" href="classldmx_1_1HgcrocDigiCollection.html#ad6607762651c38c82453a787dd2da582">addDigi</a>(digiID.raw(), digiToAdd);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <a class="code" href="classldmx_1_1HcalDigiID.html">ldmx::HcalDigiID</a> digiID(section, layer, strip, 1);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classhcal_1_1HcalDigiProducer.html#a791c6c1074e62a4cecae1233149ff8dd">hgcroc_</a>-&gt;digitize(digiID.raw(), pulses_negend, digiToAdd)) {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;          hcalDigis.<a class="code" href="classldmx_1_1HgcrocDigiCollection.html#ad6607762651c38c82453a787dd2da582">addDigi</a>(digiID.raw(), digiToAdd);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  }</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">  /******************************************************************************************</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">   * Noise Simulation on Empty Channels</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">   *****************************************************************************************/</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classhcal_1_1HcalDigiProducer.html#a01f82c5ba266c333c19196e5819b03e1">noise_</a>) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordtype">int</span> numChannels = 0;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; hcalGeometry.getNumSections(); l++) {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="keywordtype">int</span> nChannels =</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;          hcalGeometry.getNumLayers(l) * hcalGeometry.getNumStrips(l);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="comment">// for back Hcal we have double readout, therefore we multiply the number</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      <span class="comment">// of channels by 2.</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="keywordflow">if</span> (l == 0) nChannels *= 2;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      numChannels += nChannels;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordtype">int</span> numEmptyChannels = numChannels - hcalDigis.<a class="code" href="classldmx_1_1HgcrocDigiCollection.html#ae3580a8a632b91b0ff4265346cc74715">getNumDigis</a>();</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">// noise generator gives us a list of noise amplitudes [mV] that randomly</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="comment">// populate the empty channels and are above the readout threshold</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keyword">auto</span> noiseHitAmplitudes{</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <a class="code" href="classhcal_1_1HcalDigiProducer.html#a29ac2f405f25d3afbd96fb6c4a2bec80">noiseGenerator_</a>-&gt;generateNoiseHits(numEmptyChannels)};</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    std::vector&lt;std::pair&lt;double, double&gt;&gt; fake_pulse(1, {0., 0.});</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">double</span> noiseHit : noiseHitAmplitudes) {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <span class="comment">// generate detector ID for noise hit</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="comment">// making sure that it is in an empty channel</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> noiseID;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <span class="keywordtype">int</span> sectionID, layerID, stripID, endID;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        sectionID = <a class="code" href="classhcal_1_1HcalDigiProducer.html#adae695077b45d750aa098820bf56d598">noiseInjector_</a>-&gt;Integer(hcalGeometry.getNumSections());</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        layerID = <a class="code" href="classhcal_1_1HcalDigiProducer.html#adae695077b45d750aa098820bf56d598">noiseInjector_</a>-&gt;Integer(hcalGeometry.getNumLayers(sectionID));</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="comment">// set layer to 1 if the generator says it is 0 (geometry map starts</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="comment">// from 1)</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">if</span> (layerID == 0) layerID = 1;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        stripID = <a class="code" href="classhcal_1_1HcalDigiProducer.html#adae695077b45d750aa098820bf56d598">noiseInjector_</a>-&gt;Integer(hcalGeometry.getNumStrips(sectionID));</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        endID = <a class="code" href="classhcal_1_1HcalDigiProducer.html#adae695077b45d750aa098820bf56d598">noiseInjector_</a>-&gt;Integer(2);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">if</span> ((sectionID == ldmx::HcalID::HcalSection::TOP) ||</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            (sectionID == ldmx::HcalID::HcalSection::LEFT)) {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;          endID = 0;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((sectionID == ldmx::HcalID::HcalSection::BOTTOM) ||</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                   (sectionID == ldmx::HcalID::HcalSection::RIGHT)) {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;          endID = 1;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keyword">auto</span> detID = <a class="code" href="classldmx_1_1HcalDigiID.html">ldmx::HcalDigiID</a>(sectionID, layerID, stripID, endID);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        noiseID = detID.raw();</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      } <span class="keywordflow">while</span> (hitsByID.find(noiseID) != hitsByID.end());</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      hitsByID[noiseID] =</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;          std::vector&lt;const ldmx::SimCalorimeterHit*&gt;();  <span class="comment">// mark this as used</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="comment">// get a time for this noise hit</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      fake_pulse[0].second = <a class="code" href="classhcal_1_1HcalDigiProducer.html#adae695077b45d750aa098820bf56d598">noiseInjector_</a>-&gt;Uniform(<a class="code" href="classhcal_1_1HcalDigiProducer.html#aa36ad55847617ebd9238c903d7f93fb3">clockCycle_</a>);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="comment">// noise generator gives the amplitude above the readout threshold</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="comment">// we need to convert it to the amplitude above the pedestal</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="keywordtype">double</span> gain = <a class="code" href="classhcal_1_1HcalDigiProducer.html#a791c6c1074e62a4cecae1233149ff8dd">hgcroc_</a>-&gt;gain(noiseID);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      fake_pulse[0].first = noiseHit +</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                            gain * <a class="code" href="classhcal_1_1HcalDigiProducer.html#a791c6c1074e62a4cecae1233149ff8dd">hgcroc_</a>-&gt;readoutThreshold(noiseID) -</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                            gain * <a class="code" href="classhcal_1_1HcalDigiProducer.html#a791c6c1074e62a4cecae1233149ff8dd">hgcroc_</a>-&gt;pedestal(noiseID);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      <span class="keywordflow">if</span> (sectionID == ldmx::HcalID::HcalSection::BACK) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        std::vector&lt;ldmx::HgcrocDigiCollection::Sample&gt; digiToAddPosend,</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            digiToAddNegend;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <a class="code" href="classldmx_1_1HcalDigiID.html">ldmx::HcalDigiID</a> posendID(sectionID, layerID, stripID, 0);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <a class="code" href="classldmx_1_1HcalDigiID.html">ldmx::HcalDigiID</a> negendID(sectionID, layerID, stripID, 1);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classhcal_1_1HcalDigiProducer.html#a791c6c1074e62a4cecae1233149ff8dd">hgcroc_</a>-&gt;digitize(posendID.raw(), fake_pulse, digiToAddPosend) &amp;&amp;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <a class="code" href="classhcal_1_1HcalDigiProducer.html#a791c6c1074e62a4cecae1233149ff8dd">hgcroc_</a>-&gt;digitize(negendID.raw(), fake_pulse, digiToAddNegend)) {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;          hcalDigis.<a class="code" href="classldmx_1_1HgcrocDigiCollection.html#ad6607762651c38c82453a787dd2da582">addDigi</a>(posendID.raw(), digiToAddPosend);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;          hcalDigis.<a class="code" href="classldmx_1_1HgcrocDigiCollection.html#ad6607762651c38c82453a787dd2da582">addDigi</a>(negendID.raw(), digiToAddNegend);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        }</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        std::vector&lt;ldmx::HgcrocDigiCollection::Sample&gt; digiToAdd;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classhcal_1_1HcalDigiProducer.html#a791c6c1074e62a4cecae1233149ff8dd">hgcroc_</a>-&gt;digitize(noiseID, fake_pulse, digiToAdd)) {</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;          hcalDigis.<a class="code" href="classldmx_1_1HgcrocDigiCollection.html#ad6607762651c38c82453a787dd2da582">addDigi</a>(noiseID, digiToAdd);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    }  <span class="comment">// loop over noise amplitudes</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  }    <span class="comment">// if we should add noise</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="keyword">event</span>.add(<a class="code" href="classhcal_1_1HcalDigiProducer.html#a326eb0f0fa3ec2013d9bb9ba5cdb37cd">digiCollName_</a>, hcalDigis);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;}  <span class="comment">// produce</span></div>
<div class="ttc" id="aclassframework_1_1RandomNumberSeedService_html_a48e87463ea63d1862064cad26d5b9bb4"><div class="ttname"><a href="classframework_1_1RandomNumberSeedService.html#a48e87463ea63d1862064cad26d5b9bb4">framework::RandomNumberSeedService::CONDITIONS_OBJECT_NAME</a></div><div class="ttdeci">static const std::string CONDITIONS_OBJECT_NAME</div><div class="ttdoc">Conditions object name.</div><div class="ttdef"><b>Definition:</b> <a href="RandomNumberSeedService_8h_source.html#l00037">RandomNumberSeedService.h:37</a></div></div>
<div class="ttc" id="aclasshcal_1_1HcalDigiProducer_html_adae695077b45d750aa098820bf56d598"><div class="ttname"><a href="classhcal_1_1HcalDigiProducer.html#adae695077b45d750aa098820bf56d598">hcal::HcalDigiProducer::noiseInjector_</a></div><div class="ttdeci">std::unique_ptr&lt; TRandom3 &gt; noiseInjector_</div><div class="ttdoc">Generates Gaussian noise on top of real hits.</div><div class="ttdef"><b>Definition:</b> <a href="HcalDigiProducer_8h_source.html#l00097">HcalDigiProducer.h:97</a></div></div>
<div class="ttc" id="aclassldmx_1_1HcalDigiID_html"><div class="ttname"><a href="classldmx_1_1HcalDigiID.html">ldmx::HcalDigiID</a></div><div class="ttdoc">Extension of HcalAbstractID providing access to HCal digi information.</div><div class="ttdef"><b>Definition:</b> <a href="HcalDigiID_8h_source.html#l00013">HcalDigiID.h:13</a></div></div>
<div class="ttc" id="aclassldmx_1_1HcalGeometry_html_a509523c5f18a53d16be9d6a79e6e590a"><div class="ttname"><a href="classldmx_1_1HcalGeometry.html#a509523c5f18a53d16be9d6a79e6e590a">ldmx::HcalGeometry::CONDITIONS_OBJECT_NAME</a></div><div class="ttdeci">static constexpr const char * CONDITIONS_OBJECT_NAME</div><div class="ttdef"><b>Definition:</b> <a href="HcalGeometry_8h_source.html#l00042">HcalGeometry.h:42</a></div></div>
<div class="ttc" id="aclassldmx_1_1HcalID_html"><div class="ttname"><a href="classldmx_1_1HcalID.html">ldmx::HcalID</a></div><div class="ttdoc">Implements detector ids for HCal subdetector.</div><div class="ttdef"><b>Definition:</b> <a href="HcalID_8h_source.html#l00019">HcalID.h:19</a></div></div>
<div class="ttc" id="aclassldmx_1_1HgcrocDigiCollection_html"><div class="ttname"><a href="classldmx_1_1HgcrocDigiCollection.html">ldmx::HgcrocDigiCollection</a></div><div class="ttdoc">Represents a collection of the digi hits readout by an HGCROC.</div><div class="ttdef"><b>Definition:</b> <a href="HgcrocDigiCollection_8h_source.html#l00042">HgcrocDigiCollection.h:42</a></div></div>
<div class="ttc" id="aclassldmx_1_1HgcrocDigiCollection_html_a710b705f129831a7029b9b42c3dcdf23"><div class="ttname"><a href="classldmx_1_1HgcrocDigiCollection.html#a710b705f129831a7029b9b42c3dcdf23">ldmx::HgcrocDigiCollection::setNumSamplesPerDigi</a></div><div class="ttdeci">void setNumSamplesPerDigi(unsigned int n)</div><div class="ttdef"><b>Definition:</b> <a href="HgcrocDigiCollection_8h_source.html#l00339">HgcrocDigiCollection.h:339</a></div></div>
<div class="ttc" id="aclassldmx_1_1HgcrocDigiCollection_html_aa7400fd63b92e03d22f94898630f1f77"><div class="ttname"><a href="classldmx_1_1HgcrocDigiCollection.html#aa7400fd63b92e03d22f94898630f1f77">ldmx::HgcrocDigiCollection::setSampleOfInterestIndex</a></div><div class="ttdeci">void setSampleOfInterestIndex(unsigned int n)</div><div class="ttdef"><b>Definition:</b> <a href="HgcrocDigiCollection_8h_source.html#l00358">HgcrocDigiCollection.h:358</a></div></div>
<div class="ttc" id="aclassldmx_1_1HgcrocDigiCollection_html_ad6607762651c38c82453a787dd2da582"><div class="ttname"><a href="classldmx_1_1HgcrocDigiCollection.html#ad6607762651c38c82453a787dd2da582">ldmx::HgcrocDigiCollection::addDigi</a></div><div class="ttdeci">void addDigi(unsigned int id, const std::vector&lt; Sample &gt; &amp;digi)</div></div>
<div class="ttc" id="aclassldmx_1_1HgcrocDigiCollection_html_ae3580a8a632b91b0ff4265346cc74715"><div class="ttname"><a href="classldmx_1_1HgcrocDigiCollection.html#ae3580a8a632b91b0ff4265346cc74715">ldmx::HgcrocDigiCollection::getNumDigis</a></div><div class="ttdeci">unsigned int getNumDigis() const</div><div class="ttdef"><b>Definition:</b> <a href="HgcrocDigiCollection_8h_source.html#l00382">HgcrocDigiCollection.h:382</a></div></div>
<div class="ttc" id="aclassldmx_1_1SimCalorimeterHit_html"><div class="ttname"><a href="classldmx_1_1SimCalorimeterHit.html">ldmx::SimCalorimeterHit</a></div><div class="ttdoc">Stores simulated calorimeter hit information.</div><div class="ttdef"><b>Definition:</b> <a href="SimCalorimeterHit_8h_source.html#l00031">SimCalorimeterHit.h:31</a></div></div>
<div class="ttc" id="aclassldmx_1_1SimCalorimeterHit_html_a2e91af4c19fa6aadb1c3a8bceb6c32a9"><div class="ttname"><a href="classldmx_1_1SimCalorimeterHit.html#a2e91af4c19fa6aadb1c3a8bceb6c32a9">ldmx::SimCalorimeterHit::getPosition</a></div><div class="ttdeci">std::vector&lt; float &gt; getPosition() const</div><div class="ttdef"><b>Definition:</b> <a href="SimCalorimeterHit_8h_source.html#l00112">SimCalorimeterHit.h:112</a></div></div>
<div class="ttc" id="aclassldmx_1_1SimCalorimeterHit_html_a3696b8480b0bf0455fd22b2097a258e7"><div class="ttname"><a href="classldmx_1_1SimCalorimeterHit.html#a3696b8480b0bf0455fd22b2097a258e7">ldmx::SimCalorimeterHit::getNumberOfContribs</a></div><div class="ttdeci">unsigned getNumberOfContribs() const</div><div class="ttdef"><b>Definition:</b> <a href="SimCalorimeterHit_8h_source.html#l00142">SimCalorimeterHit.h:142</a></div></div>
<div class="ttc" id="aclassldmx_1_1SimCalorimeterHit_html_a6f5cc61053300b17a4a5a4b52b33f3d5"><div class="ttname"><a href="classldmx_1_1SimCalorimeterHit.html#a6f5cc61053300b17a4a5a4b52b33f3d5">ldmx::SimCalorimeterHit::getContrib</a></div><div class="ttdeci">Contrib getContrib(int i) const</div></div>
<div class="ttc" id="aclassldmx_1_1SimCalorimeterHit_html_aa253dffd148f4f5dc07288cfd7a0fa85"><div class="ttname"><a href="classldmx_1_1SimCalorimeterHit.html#aa253dffd148f4f5dc07288cfd7a0fa85">ldmx::SimCalorimeterHit::getID</a></div><div class="ttdeci">int getID() const</div><div class="ttdef"><b>Definition:</b> <a href="SimCalorimeterHit_8h_source.html#l00088">SimCalorimeterHit.h:88</a></div></div>
<div class="ttc" id="astructldmx_1_1SimCalorimeterHit_1_1Contrib_html_a6a59b1b0f67e9208f46e6a8f478943fe"><div class="ttname"><a href="structldmx_1_1SimCalorimeterHit_1_1Contrib.html#a6a59b1b0f67e9208f46e6a8f478943fe">ldmx::SimCalorimeterHit::Contrib::time</a></div><div class="ttdeci">float time</div><div class="ttdoc">Time this contributor made the hit (global Geant4 time)</div><div class="ttdef"><b>Definition:</b> <a href="SimCalorimeterHit_8h_source.html#l00061">SimCalorimeterHit.h:61</a></div></div>
<div class="ttc" id="astructldmx_1_1SimCalorimeterHit_1_1Contrib_html_adcfa3f67936c8b0ca74192cf7a029fd9"><div class="ttname"><a href="structldmx_1_1SimCalorimeterHit_1_1Contrib.html#adcfa3f67936c8b0ca74192cf7a029fd9">ldmx::SimCalorimeterHit::Contrib::edep</a></div><div class="ttdeci">float edep</div><div class="ttdoc">Energy depostied by this contributor.</div><div class="ttdef"><b>Definition:</b> <a href="SimCalorimeterHit_8h_source.html#l00058">SimCalorimeterHit.h:58</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="classldmx_1_1HgcrocDigiCollection.html#ad6607762651c38c82453a787dd2da582">ldmx::HgcrocDigiCollection::addDigi()</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00078">attlength_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00066">clockCycle_</a>, <a class="el" href="HcalGeometry_8h_source.html#l00042">ldmx::HcalGeometry::CONDITIONS_OBJECT_NAME</a>, <a class="el" href="RandomNumberSeedService_8h_source.html#l00037">framework::RandomNumberSeedService::CONDITIONS_OBJECT_NAME</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00063">digiCollName_</a>, <a class="el" href="SimCalorimeterHit_8h_source.html#l00058">ldmx::SimCalorimeterHit::Contrib::edep</a>, <a class="el" href="classldmx_1_1SimCalorimeterHit.html#a6f5cc61053300b17a4a5a4b52b33f3d5">ldmx::SimCalorimeterHit::getContrib()</a>, <a class="el" href="SimCalorimeterHit_8h_source.html#l00088">ldmx::SimCalorimeterHit::getID()</a>, <a class="el" href="SimCalorimeterHit_8h_source.html#l00142">ldmx::SimCalorimeterHit::getNumberOfContribs()</a>, <a class="el" href="HgcrocDigiCollection_8h_source.html#l00382">ldmx::HgcrocDigiCollection::getNumDigis()</a>, <a class="el" href="SimCalorimeterHit_8h_source.html#l00112">ldmx::SimCalorimeterHit::getPosition()</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00088">hgcroc_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00057">inputCollName_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00060">inputPassName_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00072">iSOI_</a>, <a class="el" href="HcalID_8h_source.html#l00088">ldmx::HcalID::layer()</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00075">MeV_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00069">nADCs_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00085">noise_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00094">noiseGenerator_</a>, <a class="el" href="HcalDigiProducer_8h_source.html#l00097">noiseInjector_</a>, <a class="el" href="DetectorID_8h_source.html#l00067">ldmx::DetectorID::raw()</a>, <a class="el" href="HgcrocDigiCollection_8h_source.html#l00339">ldmx::HgcrocDigiCollection::setNumSamplesPerDigi()</a>, <a class="el" href="HgcrocDigiCollection_8h_source.html#l00358">ldmx::HgcrocDigiCollection::setSampleOfInterestIndex()</a>, <a class="el" href="HcalID_8h_source.html#l00106">ldmx::HcalID::strip()</a>, and <a class="el" href="SimCalorimeterHit_8h_source.html#l00061">ldmx::SimCalorimeterHit::Contrib::time</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a01f82c5ba266c333c19196e5819b03e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01f82c5ba266c333c19196e5819b03e1">&#9670;&nbsp;</a></span>noise_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool hcal::HcalDigiProducer::noise_ {true}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Put noise into empty channels, not configurable, only helpful in development </p>

<p class="definition">Definition at line <a class="el" href="HcalDigiProducer_8h_source.html#l00085">85</a> of file <a class="el" href="HcalDigiProducer_8h_source.html">HcalDigiProducer.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="HcalDigiProducer_8cxx_source.html#l00028">configure()</a>, and <a class="el" href="HcalDigiProducer_8cxx_source.html#l00065">produce()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>Hcal/include/Hcal/<a class="el" href="HcalDigiProducer_8h_source.html">HcalDigiProducer.h</a></li>
<li>Hcal/src/Hcal/<a class="el" href="HcalDigiProducer_8cxx_source.html">HcalDigiProducer.cxx</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
		<script src="custom.js"></script>
	</body>
</html>