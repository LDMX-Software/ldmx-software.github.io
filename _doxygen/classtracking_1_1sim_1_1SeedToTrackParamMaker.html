<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=9"/>
		<meta name="generator" content="Doxygen 1.9.5"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>LDMX Software: tracking::sim::SeedToTrackParamMaker Class Reference</title>
		<link href="tabs.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
		<link href="doxygen.css" rel="stylesheet" type="text/css" />
		<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom_dark_theme.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectalign" style="padding-left: 0.5em;">
							<div id="projectname">LDMX Software
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacetracking.html">tracking</a></li><li class="navelem"><b>sim</b></li><li class="navelem"><a class="el" href="classtracking_1_1sim_1_1SeedToTrackParamMaker.html">SeedToTrackParamMaker</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classtracking_1_1sim_1_1SeedToTrackParamMaker-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">tracking::sim::SeedToTrackParamMaker Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:abb06cf60475051b0c839e4f07f4a00c0"><td class="memTemplParams" colspan="2"><a id="abb06cf60475051b0c839e4f07f4a00c0" name="abb06cf60475051b0c839e4f07f4a00c0"></a>
template&lt;typename external_spacepoint_t &gt; </td></tr>
<tr class="memitem:abb06cf60475051b0c839e4f07f4a00c0"><td class="memTemplItemLeft" align="right" valign="top">bool&#160;</td><td class="memTemplItemRight" valign="bottom"><b>KarimakiFit</b> (const std::vector&lt; external_spacepoint_t * &gt; &amp;sp, std::array&lt; double, 9 &gt; &amp;data, const Acts::Vector2 refPoint)</td></tr>
<tr class="separator:abb06cf60475051b0c839e4f07f4a00c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ce733867a87465f4be917501ab1016e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtracking_1_1sim_1_1SeedToTrackParamMaker.html#a9ce733867a87465f4be917501ab1016e">transformRhoPhid</a> (const Acts::Vector2 &amp;r1, const Acts::Vector2 &amp;r2, double &amp;phi, double &amp;rho, double &amp;d)</td></tr>
<tr class="separator:a9ce733867a87465f4be917501ab1016e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af51341afa58c8030e0e41f0f9757c9e3"><td class="memTemplParams" colspan="2">template&lt;typename external_spacepoint_t &gt; </td></tr>
<tr class="memitem:af51341afa58c8030e0e41f0f9757c9e3"><td class="memTemplItemLeft" align="right" valign="top">bool&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classtracking_1_1sim_1_1SeedToTrackParamMaker.html#af51341afa58c8030e0e41f0f9757c9e3">FitSeedAtlas</a> (const Acts::Seed&lt; external_spacepoint_t &gt; &amp;seed, std::array&lt; double, 9 &gt; &amp;data, const Acts::Transform3 &amp;Tp, const double &amp;bFieldZ)</td></tr>
<tr class="separator:af51341afa58c8030e0e41f0f9757c9e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd1a864f05b71a7dccddad03e31e410d"><td class="memTemplParams" colspan="2"><a id="abd1a864f05b71a7dccddad03e31e410d" name="abd1a864f05b71a7dccddad03e31e410d"></a>
template&lt;typename external_spacepoint_t &gt; </td></tr>
<tr class="memitem:abd1a864f05b71a7dccddad03e31e410d"><td class="memTemplItemLeft" align="right" valign="top">bool&#160;</td><td class="memTemplItemRight" valign="bottom"><b>FitSeedAtlas</b> (const std::vector&lt; external_spacepoint_t &gt; &amp;sp, std::array&lt; double, 9 &gt; &amp;data, const Acts::Transform3 &amp;Tp, const double &amp;bFieldZ)</td></tr>
<tr class="separator:abd1a864f05b71a7dccddad03e31e410d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d5a0258d0e25509c7326e4bf0f901f5"><td class="memTemplParams" colspan="2"><a id="a9d5a0258d0e25509c7326e4bf0f901f5" name="a9d5a0258d0e25509c7326e4bf0f901f5"></a>
template&lt;typename external_spacepoint_t &gt; </td></tr>
<tr class="memitem:a9d5a0258d0e25509c7326e4bf0f901f5"><td class="memTemplItemLeft" align="right" valign="top">bool&#160;</td><td class="memTemplItemRight" valign="bottom"><b>FitSeedLinPar</b> (const Acts::Seed&lt; external_spacepoint_t &gt; &amp;seed, std::vector&lt; double &gt; &amp;data)</td></tr>
<tr class="memdesc:a9d5a0258d0e25509c7326e4bf0f901f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is a simple Line and Parabola fit (from HPS reconstruction by Robert Johnson) <br /></td></tr>
<tr class="separator:a9d5a0258d0e25509c7326e4bf0f901f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f963ee77f708b7f4b42f2e64f1ce97e"><td class="memTemplParams" colspan="2">template&lt;typename spacepoint_iterator_t &gt; </td></tr>
<tr class="memitem:a4f963ee77f708b7f4b42f2e64f1ce97e"><td class="memTemplItemLeft" align="right" valign="top">std::optional&lt; Acts::BoundVector &gt;&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classtracking_1_1sim_1_1SeedToTrackParamMaker.html#a4f963ee77f708b7f4b42f2e64f1ce97e">estimateTrackParamsFromSeed</a> (const Acts::Transform3 &amp;Tp, spacepoint_iterator_t spBegin, spacepoint_iterator_t spEnd, Acts::Vector3 bField, Acts::ActsScalar bFieldMin, Acts::ActsScalar mass=139.57018 *Acts::UnitConstants::MeV)</td></tr>
<tr class="separator:a4f963ee77f708b7f4b42f2e64f1ce97e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="SeedToTrackParamMaker_8h_source.html#l00015">15</a> of file <a class="el" href="SeedToTrackParamMaker_8h_source.html">SeedToTrackParamMaker.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ac1ebe9e9f8a7a4c2bfce41a77011d867" name="ac1ebe9e9f8a7a4c2bfce41a77011d867"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1ebe9e9f8a7a4c2bfce41a77011d867">&#9670;&#160;</a></span>SeedToTrackParamMaker()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">tracking::sim::SeedToTrackParamMaker::SeedToTrackParamMaker </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="SeedToTrackParamMaker_8h_source.html#l00018">18</a> of file <a class="el" href="SeedToTrackParamMaker_8h_source.html">SeedToTrackParamMaker.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   18</span>{};</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a4f963ee77f708b7f4b42f2e64f1ce97e" name="a4f963ee77f708b7f4b42f2e64f1ce97e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f963ee77f708b7f4b42f2e64f1ce97e">&#9670;&#160;</a></span>estimateTrackParamsFromSeed()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename spacepoint_iterator_t &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::optional&lt; Acts::BoundVector &gt; tracking::sim::SeedToTrackParamMaker::estimateTrackParamsFromSeed </td>
          <td>(</td>
          <td class="paramtype">const Acts::Transform3 &amp;&#160;</td>
          <td class="paramname"><em>Tp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">spacepoint_iterator_t&#160;</td>
          <td class="paramname"><em>spBegin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">spacepoint_iterator_t&#160;</td>
          <td class="paramname"><em>spEnd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Acts::Vector3&#160;</td>
          <td class="paramname"><em>bField</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Acts::ActsScalar&#160;</td>
          <td class="paramname"><em>bFieldMin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Acts::ActsScalar&#160;</td>
          <td class="paramname"><em>mass</em> = <code>139.57018&#160;*&#160;Acts::UnitConstants::MeV</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Estimate the full track parameters from three space points</p>
<p >This method is based on the conformal map transformation. It estimates the full bound track parameters, i.e. (loc0, loc1, phi, theta, q/p, t) at the bottom space point. The bottom space is assumed to be the first element in the range defined by the iterators. The magnetic field (which might be along any direction) is also necessary for the momentum estimation.</p>
<p >It resembles the method used in ATLAS for the track parameters estimated from seed, i.e. the function InDet::SiTrackMaker_xk::getAtaPlane here: <a href="https://acode-browser.usatlas.bnl.gov/lxr/source/athena/InnerDetector/InDetRecTools/SiTrackMakerTool_xk/src/SiTrackMaker_xk.cxx">https://acode-browser.usatlas.bnl.gov/lxr/source/athena/InnerDetector/InDetRecTools/SiTrackMakerTool_xk/src/SiTrackMaker_xk.cxx</a></p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">spacepoint_iterator_t</td><td>The type of space point iterator</td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tp</td><td>the local to global transformation </td></tr>
    <tr><td class="paramname">spBegin</td><td>is the begin iterator for the space points </td></tr>
    <tr><td class="paramname">spEnd</td><td>is the end iterator for the space points </td></tr>
    <tr><td class="paramname">surface</td><td>is the surface of the bottom space point. The estimated bound track parameters will be represented also at this surface </td></tr>
    <tr><td class="paramname">bField</td><td>is the magnetic field vector </td></tr>
    <tr><td class="paramname">bFieldMin</td><td>is the minimum magnetic field required to trigger the estimation of q/pt </td></tr>
    <tr><td class="paramname">mass</td><td>is the estimated particle mass</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>optional bound parameters </dd></dl>

<p class="definition">Definition at line <a class="el" href="SeedToTrackParamMaker_8h_source.html#l00090">90</a> of file <a class="el" href="SeedToTrackParamMaker_8h_source.html">SeedToTrackParamMaker.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   93</span>                                                                                        {</div>
<div class="line"><span class="lineno">   94</span>  </div>
<div class="line"><span class="lineno">   95</span>    <span class="comment">// Check the number of provided space points</span></div>
<div class="line"><span class="lineno">   96</span>    <span class="keywordtype">size_t</span> numSP = std::distance(spBegin, spEnd);</div>
<div class="line"><span class="lineno">   97</span>    <span class="keywordflow">if</span> (numSP != 3) {</div>
<div class="line"><span class="lineno">   98</span>      std::cout&lt;&lt;<span class="stringliteral">&quot;ERROR::less than 3 point provided&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><span class="lineno">   99</span>      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><span class="lineno">  100</span>    }</div>
<div class="line"><span class="lineno">  101</span> </div>
<div class="line"><span class="lineno">  102</span>    <span class="comment">// Convert bField to Tesla</span></div>
<div class="line"><span class="lineno">  103</span>    Acts::ActsScalar bFieldInTesla = bField.norm() / Acts::UnitConstants::T;</div>
<div class="line"><span class="lineno">  104</span>    Acts::ActsScalar bFieldMinInTesla = bFieldMin / Acts::UnitConstants::T;</div>
<div class="line"><span class="lineno">  105</span>    <span class="comment">// Check if magnetic field is too small</span></div>
<div class="line"><span class="lineno">  106</span>    <span class="keywordflow">if</span> (bFieldInTesla &lt; bFieldMinInTesla) {</div>
<div class="line"><span class="lineno">  107</span>      <span class="comment">// @todo shall we use straight-line estimation and use default q/pt in such</span></div>
<div class="line"><span class="lineno">  108</span>      <span class="comment">// case?</span></div>
<div class="line"><span class="lineno">  109</span>      std::cout&lt;&lt;<span class="stringliteral">&quot;The magnetic field at the bottom space point: B = &quot;</span></div>
<div class="line"><span class="lineno">  110</span>               &lt;&lt; bFieldInTesla &lt;&lt; <span class="stringliteral">&quot; T is smaller than |B|_min = &quot;</span></div>
<div class="line"><span class="lineno">  111</span>               &lt;&lt; bFieldMinInTesla &lt;&lt; <span class="stringliteral">&quot; T. Estimation is not performed.&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><span class="lineno">  112</span>      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><span class="lineno">  113</span>    }</div>
<div class="line"><span class="lineno">  114</span> </div>
<div class="line"><span class="lineno">  115</span>    <span class="comment">// The global positions of the bottom, middle and space points</span></div>
<div class="line"><span class="lineno">  116</span>    std::array&lt;Acts::Vector3, 3&gt; spGlobalPositions = {Acts::Vector3::Zero(), Acts::Vector3::Zero(),</div>
<div class="line"><span class="lineno">  117</span>      Acts::Vector3::Zero()};</div>
<div class="line"><span class="lineno">  118</span>    <span class="comment">// The first, second and third space point are assumed to be bottom, middle</span></div>
<div class="line"><span class="lineno">  119</span>    <span class="comment">// and top space point, respectively</span></div>
<div class="line"><span class="lineno">  120</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> isp = 0; isp &lt; 3; ++isp) {</div>
<div class="line"><span class="lineno">  121</span>      spacepoint_iterator_t it = std::next(spBegin, isp);</div>
<div class="line"><span class="lineno">  122</span>      <span class="keywordflow">if</span> (*it == <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  123</span>        std::cout&lt;&lt;<span class="stringliteral">&quot;Empty space point found. This should not happen.&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><span class="lineno">  124</span>        <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><span class="lineno">  125</span>      }</div>
<div class="line"><span class="lineno">  126</span>      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; sp = *it;</div>
<div class="line"><span class="lineno">  127</span>      spGlobalPositions[isp] = Acts::Vector3(sp-&gt;x(), sp-&gt;y(), sp-&gt;z());</div>
<div class="line"><span class="lineno">  128</span>    }</div>
<div class="line"><span class="lineno">  129</span> </div>
<div class="line"><span class="lineno">  130</span>    <span class="comment">// Define a new coordinate frame with its origin at the bottom space point, z</span></div>
<div class="line"><span class="lineno">  131</span>    <span class="comment">// axis along the magnetic field direction and y axis perpendicular to vector</span></div>
<div class="line"><span class="lineno">  132</span>    <span class="comment">// from the bottom to middle space point. Hence, the projection of the middle</span></div>
<div class="line"><span class="lineno">  133</span>    <span class="comment">// space point on the tranverse plane will be located at the x axis of the new</span></div>
<div class="line"><span class="lineno">  134</span>    <span class="comment">// frame.</span></div>
<div class="line"><span class="lineno">  135</span>    Acts::Vector3 relVec = spGlobalPositions[1] - spGlobalPositions[0];</div>
<div class="line"><span class="lineno">  136</span>    Acts::Vector3 newZAxis = bField.normalized();</div>
<div class="line"><span class="lineno">  137</span>    Acts::Vector3 newYAxis = newZAxis.cross(relVec).normalized();</div>
<div class="line"><span class="lineno">  138</span>    Acts::Vector3 newXAxis = newYAxis.cross(newZAxis);</div>
<div class="line"><span class="lineno">  139</span>    Acts::RotationMatrix3 rotation;</div>
<div class="line"><span class="lineno">  140</span>    rotation.col(0) = newXAxis;</div>
<div class="line"><span class="lineno">  141</span>    rotation.col(1) = newYAxis;</div>
<div class="line"><span class="lineno">  142</span>    rotation.col(2) = newZAxis;</div>
<div class="line"><span class="lineno">  143</span>    <span class="comment">// The center of the new frame is at the bottom space point</span></div>
<div class="line"><span class="lineno">  144</span>    Acts::Translation3 trans(spGlobalPositions[0]);</div>
<div class="line"><span class="lineno">  145</span>    <span class="comment">// The transform which constructs the new frame</span></div>
<div class="line"><span class="lineno">  146</span>    Acts::Transform3 transform(trans * rotation);</div>
<div class="line"><span class="lineno">  147</span> </div>
<div class="line"><span class="lineno">  148</span>    <span class="comment">// The coordinate of the middle and top space point in the new frame</span></div>
<div class="line"><span class="lineno">  149</span>    Acts::Vector3 local1 = transform.inverse() * spGlobalPositions[1];</div>
<div class="line"><span class="lineno">  150</span>    Acts::Vector3 local2 = transform.inverse() * spGlobalPositions[2];</div>
<div class="line"><span class="lineno">  151</span> </div>
<div class="line"><span class="lineno">  152</span>    <span class="comment">// Lambda to transform the coordinates to the (u, v) space</span></div>
<div class="line"><span class="lineno">  153</span>    <span class="keyword">auto</span> uvTransform = [](<span class="keyword">const</span> Acts::Vector3&amp; local) -&gt; Acts::Vector2 {</div>
<div class="line"><span class="lineno">  154</span>      Acts::Vector2 uv;</div>
<div class="line"><span class="lineno">  155</span>      Acts::ActsScalar denominator = local.x() * local.x() + local.y() * local.y();</div>
<div class="line"><span class="lineno">  156</span>      uv.x() = local.x() / denominator;</div>
<div class="line"><span class="lineno">  157</span>      uv.y() = local.y() / denominator;</div>
<div class="line"><span class="lineno">  158</span>      <span class="keywordflow">return</span> uv;</div>
<div class="line"><span class="lineno">  159</span>    };</div>
<div class="line"><span class="lineno">  160</span>    <span class="comment">// The uv1.y() should be zero</span></div>
<div class="line"><span class="lineno">  161</span>    Acts::Vector2 uv1 = uvTransform(local1);</div>
<div class="line"><span class="lineno">  162</span>    Acts::Vector2 uv2 = uvTransform(local2);</div>
<div class="line"><span class="lineno">  163</span> </div>
<div class="line"><span class="lineno">  164</span>    <span class="comment">// A,B are slope and intercept of the straight line in the u,v plane</span></div>
<div class="line"><span class="lineno">  165</span>    <span class="comment">// connecting the three points</span></div>
<div class="line"><span class="lineno">  166</span>    Acts::ActsScalar A = (uv2.y() - uv1.y()) / (uv2.x() - uv1.x());</div>
<div class="line"><span class="lineno">  167</span>    Acts::ActsScalar B = uv2.y() - A * uv2.x();</div>
<div class="line"><span class="lineno">  168</span>    <span class="comment">// Curvature (with a sign) estimate</span></div>
<div class="line"><span class="lineno">  169</span>    Acts::ActsScalar rho = -2.0 * B / std::hypot(1., A);</div>
<div class="line"><span class="lineno">  170</span>    <span class="comment">// The projection of the top space point on the transverse plane of the new</span></div>
<div class="line"><span class="lineno">  171</span>    <span class="comment">// frame</span></div>
<div class="line"><span class="lineno">  172</span>    Acts::ActsScalar rn = local2.x() * local2.x() + local2.y() * local2.y();</div>
<div class="line"><span class="lineno">  173</span>    <span class="comment">// The (1/tanTheta) of momentum in the new frame,</span></div>
<div class="line"><span class="lineno">  174</span>    Acts::ActsScalar invTanTheta =</div>
<div class="line"><span class="lineno">  175</span>        local2.z() * std::sqrt(1. / rn) / (1. + rho * rho * rn);</div>
<div class="line"><span class="lineno">  176</span>    <span class="comment">// The momentum direction in the new frame (the center of the circle has the</span></div>
<div class="line"><span class="lineno">  177</span>    <span class="comment">// coordinate (-1.*A/(2*B), 1./(2*B)))</span></div>
<div class="line"><span class="lineno">  178</span>    Acts::Vector3 transDirection(1., A, std::hypot(1, A) * invTanTheta);</div>
<div class="line"><span class="lineno">  179</span>    <span class="comment">// Transform it back to the original frame</span></div>
<div class="line"><span class="lineno">  180</span>    Acts::Vector3 direction = rotation * transDirection.normalized();</div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>    <span class="comment">// Initialize the bound parameters vector</span></div>
<div class="line"><span class="lineno">  183</span>    Acts::BoundVector params = Acts::BoundVector::Zero();</div>
<div class="line"><span class="lineno">  184</span> </div>
<div class="line"><span class="lineno">  185</span>    <span class="comment">// The estimated phi and theta</span></div>
<div class="line"><span class="lineno">  186</span>    params[Acts::eBoundPhi] = Acts::VectorHelpers::phi(direction);</div>
<div class="line"><span class="lineno">  187</span>    params[Acts::eBoundTheta] = Acts::VectorHelpers::theta(direction);</div>
<div class="line"><span class="lineno">  188</span> </div>
<div class="line"><span class="lineno">  189</span>    Acts::Vector3 bottomLocalPos = Tp.inverse() * spGlobalPositions[0];</div>
<div class="line"><span class="lineno">  190</span>        </div>
<div class="line"><span class="lineno">  191</span>    <span class="comment">// The estimated loc0 and loc1</span></div>
<div class="line"><span class="lineno">  192</span>    params[Acts::eBoundLoc0] = bottomLocalPos.x();</div>
<div class="line"><span class="lineno">  193</span>    params[Acts::eBoundLoc1] = bottomLocalPos.y();</div>
<div class="line"><span class="lineno">  194</span> </div>
<div class="line"><span class="lineno">  195</span>    <span class="comment">// The estimated q/pt in [GeV/c]^-1 (note that the pt is the projection of</span></div>
<div class="line"><span class="lineno">  196</span>    <span class="comment">// momentum on the transverse plane of the new frame)</span></div>
<div class="line"><span class="lineno">  197</span>    Acts::ActsScalar qOverPt = rho * (Acts::UnitConstants::m) / (0.3 * bFieldInTesla);</div>
<div class="line"><span class="lineno">  198</span>    <span class="comment">// The estimated q/p in [GeV/c]^-1</span></div>
<div class="line"><span class="lineno">  199</span>    params[Acts::eBoundQOverP] = qOverPt / std::hypot(1., invTanTheta);</div>
<div class="line"><span class="lineno">  200</span> </div>
<div class="line"><span class="lineno">  201</span>    <span class="comment">// The estimated momentum, and its projection along the magnetic field</span></div>
<div class="line"><span class="lineno">  202</span>    <span class="comment">// diretion</span></div>
<div class="line"><span class="lineno">  203</span>    Acts::ActsScalar pInGeV = std::abs(1.0 / params[Acts::eBoundQOverP]);</div>
<div class="line"><span class="lineno">  204</span>    Acts::ActsScalar pzInGeV = 1.0 / std::abs(qOverPt) * invTanTheta;</div>
<div class="line"><span class="lineno">  205</span>    Acts::ActsScalar massInGeV = mass / Acts::UnitConstants::GeV;</div>
<div class="line"><span class="lineno">  206</span>    <span class="comment">// The estimated velocity, and its projection along the magnetic field</span></div>
<div class="line"><span class="lineno">  207</span>    <span class="comment">// diretion</span></div>
<div class="line"><span class="lineno">  208</span>    Acts::ActsScalar v = pInGeV / std::hypot(pInGeV, massInGeV);</div>
<div class="line"><span class="lineno">  209</span>    Acts::ActsScalar vz = pzInGeV / std::hypot(pInGeV, massInGeV);</div>
<div class="line"><span class="lineno">  210</span>    <span class="comment">// The z coordinate of the bottom space point along the magnetic field</span></div>
<div class="line"><span class="lineno">  211</span>    <span class="comment">// direction</span></div>
<div class="line"><span class="lineno">  212</span>    Acts::ActsScalar pathz = spGlobalPositions[0].dot(bField) / bField.norm();</div>
<div class="line"><span class="lineno">  213</span>    <span class="comment">// The estimated time (use path length along magnetic field only if it&#39;s not</span></div>
<div class="line"><span class="lineno">  214</span>    <span class="comment">// zero)</span></div>
<div class="line"><span class="lineno">  215</span>    <span class="keywordflow">if</span> (pathz != 0) {</div>
<div class="line"><span class="lineno">  216</span>      params[Acts::eBoundTime] = pathz / vz;</div>
<div class="line"><span class="lineno">  217</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  218</span>      params[Acts::eBoundTime] = spGlobalPositions[0].norm() / v;</div>
<div class="line"><span class="lineno">  219</span>    }</div>
<div class="line"><span class="lineno">  220</span> </div>
<div class="line"><span class="lineno">  221</span>    <span class="keywordflow">return</span> params;</div>
<div class="line"><span class="lineno">  222</span>  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="af51341afa58c8030e0e41f0f9757c9e3" name="af51341afa58c8030e0e41f0f9757c9e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af51341afa58c8030e0e41f0f9757c9e3">&#9670;&#160;</a></span>FitSeedAtlas()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename external_spacepoint_t &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">bool tracking::sim::SeedToTrackParamMaker::FitSeedAtlas </td>
          <td>(</td>
          <td class="paramtype">const Acts::Seed&lt; external_spacepoint_t &gt; &amp;&#160;</td>
          <td class="paramname"><em>seed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::array&lt; double, 9 &gt; &amp;&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Acts::Transform3 &amp;&#160;</td>
          <td class="paramname"><em>Tp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double &amp;&#160;</td>
          <td class="paramname"><em>bFieldZ</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >This resembles the method used in ATLAS for the seed fitting L811 <a href="https://acode-browser.usatlas.bnl.gov/lxr/source/athena/InnerDetector/InDetRecTools/SiTrackMakerTool_xk/src/SiTrackMaker_xk.cxx">https://acode-browser.usatlas.bnl.gov/lxr/source/athena/InnerDetector/InDetRecTools/SiTrackMakerTool_xk/src/SiTrackMaker_xk.cxx</a> </p>

</div>
</div>
<a id="a9ce733867a87465f4be917501ab1016e" name="a9ce733867a87465f4be917501ab1016e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ce733867a87465f4be917501ab1016e">&#9670;&#160;</a></span>transformRhoPhid()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool tracking::sim::SeedToTrackParamMaker::transformRhoPhid </td>
          <td>(</td>
          <td class="paramtype">const Acts::Vector2 &amp;&#160;</td>
          <td class="paramname"><em>r1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Acts::Vector2 &amp;&#160;</td>
          <td class="paramname"><em>r2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double &amp;&#160;</td>
          <td class="paramname"><em>phi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double &amp;&#160;</td>
          <td class="paramname"><em>rho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double &amp;&#160;</td>
          <td class="paramname"><em>d</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="SeedToTrackParamMaker_8h_source.html#l00029">29</a> of file <a class="el" href="SeedToTrackParamMaker_8h_source.html">SeedToTrackParamMaker.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   30</span>                                                            {</div>
<div class="line"><span class="lineno">   31</span>            </div>
<div class="line"><span class="lineno">   32</span>    <span class="keywordtype">float</span> trackDir = cos(phi)*(r1[0] - r2[0]) + sin(phi)*(r1[1]-r2[1]);</div>
<div class="line"><span class="lineno">   33</span>            </div>
<div class="line"><span class="lineno">   34</span>    <span class="keywordflow">if</span> (trackDir &lt; 0) {</div>
<div class="line"><span class="lineno">   35</span>      phi = M_PI + phi;</div>
<div class="line"><span class="lineno">   36</span>      rho = -rho;</div>
<div class="line"><span class="lineno">   37</span>      d   = -d;</div>
<div class="line"><span class="lineno">   38</span>      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">   39</span>    }</div>
<div class="line"><span class="lineno">   40</span>            </div>
<div class="line"><span class="lineno">   41</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">   42</span>      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   43</span> </div>
<div class="line"><span class="lineno">   44</span>  }</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>Tracking/include/Tracking/Sim/<a class="el" href="SeedToTrackParamMaker_8h_source.html">SeedToTrackParamMaker.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
		<script src="custom.js"></script>
	</body>
</html>