<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=9"/>
		<meta name="generator" content="Doxygen 1.9.1"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>LDMX Software: Ecal/src/Ecal/EcalVetoProcessor.cxx Source File</title>
		<link href="tabs.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
		<link href="doxygen.css" rel="stylesheet" type="text/css" />
		<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom_dark_theme.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectalign" style="padding-left: 0.5em;">
							<div id="projectname">LDMX Software
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part --><!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_f725b3c61c8cd94501dd7e29c36c23f9.html">Ecal</a></li><li class="navelem"><a class="el" href="dir_0b334f3e39ebbcc1bbdd2e653bbc30b4.html">src</a></li><li class="navelem"><a class="el" href="dir_b008054c52a15006cfad3bce76a01d46.html">Ecal</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">EcalVetoProcessor.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="EcalVetoProcessor_8h.html">Ecal/EcalVetoProcessor.h</a>&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// LDMX</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &quot;DetDescr/SimSpecialID.h&quot;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SimTrackerHit_8h.html">SimCore/Event/SimTrackerHit.h</a>&quot;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;SimCore/Event/SimParticle.h&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;Ecal/Event/EcalHit.h&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="EventConstants_8h.html">Recon/Event/EventConstants.h</a>&quot;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160; </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">/*~~~~~~~~~~~*/</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">/*   Tools   */</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">/*~~~~~~~~~~~*/</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AnalysisUtils_8h.html">Tools/AnalysisUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// C++</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">// ROOT (MIP tracking)</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;TMatrixD.h&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;TDecompSVD.h&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;TVector3.h&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">namespace </span>ecal {</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">// arrays holding 68% containment radius per layer for different bins in</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">// momentum/angle</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">const</span> std::vector&lt;double&gt; radius68_thetalt10_plt500 = {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    4.045666158618167,  4.086393662224346,  4.359141107602775,</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    4.666549994726691,  5.8569181911416015, 6.559716356124256,</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    8.686967529043072,  10.063482736354674, 13.053528344041274,</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    14.883496407943747, 18.246694748611368, 19.939799900443724,</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    22.984795944506224, 25.14745829663406,  28.329169392203216,</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    29.468032123356345, 34.03271241527079,  35.03747443690781,</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    38.50748727211848,  39.41576583301171,  42.63622296033334,</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    45.41123601592071,  48.618139095742876, 48.11801717451056,</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    53.220539860213655, 58.87753380915155,  66.31550881539764,</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    72.94685877928593,  85.95506228335348,  89.20607201266672,</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    93.34370253818409,  96.59471226749734,  100.7323427930147,</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    103.98335252232795};</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">const</span> std::vector&lt;double&gt; radius68_thetalt10_pgt500 = {</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    4.081926458777424,  4.099431732299409,  4.262428482867968,</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    4.362017581473145,  4.831341579961153,  4.998346041276382,</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    6.2633736512415705, 6.588371889265881,  8.359969947444522,</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    9.015085558044309,  11.262722588206483, 12.250305471269183,</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    15.00547660437276,  16.187264014640103, 19.573764900578503,</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    20.68072032434797,  24.13797140783321,  25.62942209291236,</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    29.027596514735617, 30.215039667389316, 33.929540248019585,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    36.12911729771914,  39.184563500620946, 42.02062468386282,</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    46.972125628650204, 47.78214816041894,  55.88428562462974,</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    59.15520134927332,  63.31816666637158,  66.58908239101515,</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    70.75204770811342,  74.022963432757,    78.18592874985525,</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    81.45684447449884};</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="keyword">const</span> std::vector&lt;double&gt; radius68_theta10to20 = {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    4.0251896715647115, 4.071661598616328,  4.357690094817289,</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    4.760224640141712,  6.002480766325418,  6.667318981016246,</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    8.652513285172342,  9.72379373302137,   12.479492693251478,</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    14.058548828317289, 17.544872909347912, 19.43616066939176,</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    23.594162859513734, 25.197329065282954, 29.55995803074302,</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    31.768946746958296, 35.79247330197688,  37.27810357669942,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    41.657281051476545, 42.628141392692626, 47.94208483539388,</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    49.9289473559796,   54.604030254423975, 53.958762417361655,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    53.03339560920388,  57.026277390001425, 62.10810455035879,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    66.10098633115634,  71.1828134915137,   75.17569527231124,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    80.25752243266861,  84.25040421346615,  89.33223137382352,</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    93.32511315462106};</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keyword">const</span> std::vector&lt;double&gt; radius68_thetagt20 = {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    4.0754238481177705, 4.193693485630508,  5.14209420056253,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    6.114996249971468,  7.7376807326481645, 8.551663213602291,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    11.129110612057813, 13.106293737495639, 17.186617323282082,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    19.970887612094604, 25.04088272634407,  28.853696411302344,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    34.72538105333071,  40.21218694947545,  46.07344239520299,</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    50.074953583805346, 62.944045771758645, 61.145621459396814,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    69.86940198299047,  74.82378572939959,  89.4528387422834,</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    93.18228303096758,  92.51751129204555,  98.80228884380018,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    111.17537347472128, 120.89712563907408, 133.27021026999518,</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    142.99196243434795, 155.36504706526904, 165.08679922962185,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    177.45988386054293, 187.18163602489574, 199.55472065581682,</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    209.2764728201696};</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="keywordtype">void</span> EcalVetoProcessor::buildBDTFeatureVector(</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keyword">const</span> <a class="code" href="classldmx_1_1EcalVetoResult.html">ldmx::EcalVetoResult</a> &amp;result) {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  bdtFeatures_.clear();</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  bdtFeatures_.push_back(result.getNReadoutHits());</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  bdtFeatures_.push_back(result.getSummedDet());</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  bdtFeatures_.push_back(result.getSummedTightIso());</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  bdtFeatures_.push_back(result.getMaxCellDep());</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  bdtFeatures_.push_back(result.getShowerRMS());</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  bdtFeatures_.push_back(result.getXStd());</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  bdtFeatures_.push_back(result.getYStd());</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  bdtFeatures_.push_back(result.getAvgLayerHit());</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  bdtFeatures_.push_back(result.getDeepestLayerHit());</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  bdtFeatures_.push_back(result.getStdLayerHit());</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="comment">// MIP tracking (unused but could be uncommented)</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">// bdtFeatures.push_back(result.getNStraightTracks());</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">// bdtFeatures.push_back(result.getNLinregTracks());</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">// bdtFeatures.push_back(result.getFirstNearPhLayer());</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ireg = 0; ireg &lt; result.getElectronContainmentEnergy().size();</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;       ++ireg) {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    bdtFeatures_.push_back(result.getElectronContainmentEnergy()[ireg]);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ireg = 0; ireg &lt; result.getPhotonContainmentEnergy().size();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;       ++ireg) {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    bdtFeatures_.push_back(result.getPhotonContainmentEnergy()[ireg]);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ireg = 0; ireg &lt; result.getOutsideContainmentEnergy().size();</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;       ++ireg) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    bdtFeatures_.push_back(result.getOutsideContainmentEnergy()[ireg]);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ireg = 0; ireg &lt; result.getOutsideContainmentNHits().size();</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;       ++ireg) {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    bdtFeatures_.push_back(result.getOutsideContainmentNHits()[ireg]);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ireg = 0; ireg &lt; result.getOutsideContainmentXStd().size(); ++ireg) {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    bdtFeatures_.push_back(result.getOutsideContainmentXStd()[ireg]);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ireg = 0; ireg &lt; result.getOutsideContainmentYStd().size(); ++ireg) {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    bdtFeatures_.push_back(result.getOutsideContainmentYStd()[ireg]);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  bdtFeatures_.push_back(result.getEcalBackEnergy());</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;}</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="classecal_1_1EcalVetoProcessor.html#a4ca7aa772f98de6fcf0a76caba82fa56">  129</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classecal_1_1EcalVetoProcessor.html#a4ca7aa772f98de6fcf0a76caba82fa56">EcalVetoProcessor::configure</a>(<a class="code" href="classframework_1_1config_1_1Parameters.html">framework::config::Parameters</a> &amp;parameters) {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  doBdt_ = parameters.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;do_bdt&quot;</span>);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">if</span> (doBdt_) {</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    rt_ = std::make_unique&lt;ldmx::Ort::ONNXRuntime&gt;(</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        parameters.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;std::string&gt;(<span class="stringliteral">&quot;bdt_file&quot;</span>));</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  cellFileNamexy_ = parameters.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;std::string&gt;(<span class="stringliteral">&quot;cellxy_file&quot;</span>);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordflow">if</span> (!std::ifstream(cellFileNamexy_).good()) {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    EXCEPTION_RAISE(<span class="stringliteral">&quot;EcalVetoProcessor&quot;</span>, <span class="stringliteral">&quot;The specified x,y cell file &#39;&quot;</span> +</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                                             cellFileNamexy_ +</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                                             <span class="stringliteral">&quot;&#39; does not exist!&quot;</span>);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    std::ifstream cellxyfile(cellFileNamexy_);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordtype">float</span> valuex;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordtype">float</span> valuey;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">while</span> (cellxyfile &gt;&gt; valuex &gt;&gt; valuey) {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      mapsx.push_back(valuex);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      mapsy.push_back(valuey);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  hexReadout_ = 0;  <span class="comment">// load during event processing</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  nEcalLayers_ = parameters.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;num_ecal_layers&quot;</span>);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  bdtCutVal_ = parameters.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;disc_cut&quot;</span>);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  ecalLayerEdepRaw_.resize(nEcalLayers_, 0);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  ecalLayerEdepReadout_.resize(nEcalLayers_, 0);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  ecalLayerTime_.resize(nEcalLayers_, 0);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="comment">// Set the collection name as defined in the configuration</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <a class="code" href="classecal_1_1EcalVetoProcessor.html#acd4bcfdf71db97e44d1bca93b9d642af">collectionName_</a> = parameters.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;std::string&gt;(<span class="stringliteral">&quot;collection_name&quot;</span>);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  rec_pass_name_ = parameters.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;std::string&gt;(<span class="stringliteral">&quot;rec_pass_name&quot;</span>);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  rec_coll_name_ = parameters.<a class="code" href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">getParameter</a>&lt;std::string&gt;(<span class="stringliteral">&quot;rec_coll_name&quot;</span>);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;}</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="keywordtype">void</span> EcalVetoProcessor::clearProcessor() {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  cellMap_.clear();</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  cellMapTightIso_.clear();</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  bdtFeatures_.clear();</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  nReadoutHits_ = 0;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  summedDet_ = 0;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  summedTightIso_ = 0;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  maxCellDep_ = 0;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  showerRMS_ = 0;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  xStd_ = 0;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  yStd_ = 0;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  avgLayerHit_ = 0;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  stdLayerHit_ = 0;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  deepestLayerHit_ = 0;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  ecalBackEnergy_ = 0;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="comment">// MIP tracking</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <a class="code" href="classecal_1_1EcalVetoProcessor.html#a93ec63e453896ba66ef975c428f9c712">nStraightTracks_</a> = 0;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <a class="code" href="classecal_1_1EcalVetoProcessor.html#aaaec7b90b44da7583bc91477536a7b53">nLinregTracks_</a> = 0;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <a class="code" href="classecal_1_1EcalVetoProcessor.html#ab1d46988d80f6ebedeb2f3bb2b49d648">firstNearPhLayer_</a> = 0;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <a class="code" href="classecal_1_1EcalVetoProcessor.html#a9014314f0e3a6b42697d127476ecc87f">epAng_</a> = 0;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <a class="code" href="classecal_1_1EcalVetoProcessor.html#a1fd58d76fb9e6367f4f298c6e9ddd099">epSep_</a> = 0;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  std::fill(ecalLayerEdepRaw_.begin(), ecalLayerEdepRaw_.end(), 0);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  std::fill(ecalLayerEdepReadout_.begin(), ecalLayerEdepReadout_.end(), 0);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  std::fill(ecalLayerTime_.begin(), ecalLayerTime_.end(), 0);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;}</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="classecal_1_1EcalVetoProcessor.html#a39c839e3d8bf793140f23ddbdd4bec70">  194</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classecal_1_1EcalVetoProcessor.html#a39c839e3d8bf793140f23ddbdd4bec70">EcalVetoProcessor::produce</a>(<a class="code" href="classframework_1_1Event.html">framework::Event</a> &amp;event) {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="comment">// Get the Ecal Geometry</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="keyword">const</span> <a class="code" href="classldmx_1_1EcalHexReadout.html">ldmx::EcalHexReadout</a> &amp;hexReadout = getCondition&lt;ldmx::EcalHexReadout&gt;(</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      ldmx::EcalHexReadout::CONDITIONS_OBJECT_NAME);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  hexReadout_ = &amp;hexReadout;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <a class="code" href="classldmx_1_1EcalVetoResult.html">ldmx::EcalVetoResult</a> result;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  clearProcessor();</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="comment">// Get the collection of Ecal scoring plane hits. If it doesn&#39;t exist,</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="comment">// don&#39;t bother adding any truth tracking information.</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  std::vector&lt;double&gt; recoilP;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  std::vector&lt;float&gt; recoilPos;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  std::vector&lt;double&gt; recoilPAtTarget;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  std::vector&lt;float&gt; recoilPosAtTarget;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordflow">if</span> (event.<a class="code" href="classframework_1_1Event.html#a7e65967eea5ac3172852838f1c8f266a">exists</a>(<span class="stringliteral">&quot;EcalScoringPlaneHits&quot;</span>)) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">// Loop through all of the sim particles and find the recoil electron.</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// Get the collection of simulated particles from the event</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keyword">auto</span> particleMap{<span class="keyword">event</span>.getMap&lt;int, <a class="code" href="classldmx_1_1SimParticle.html">ldmx::SimParticle</a>&gt;(<span class="stringliteral">&quot;SimParticles&quot;</span>)};</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">// Search for the recoil electron</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keyword">auto</span> [recoilTrackID, recoilElectron] = Analysis::getRecoil(particleMap);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// Find ECAL SP hit for recoil electron</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keyword">auto</span> ecalSpHits{</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keyword">event</span>.getCollection&lt;<a class="code" href="classldmx_1_1SimTrackerHit.html">ldmx::SimTrackerHit</a>&gt;(<span class="stringliteral">&quot;EcalScoringPlaneHits&quot;</span>)};</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordtype">float</span> pmax = 0;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classldmx_1_1SimTrackerHit.html">ldmx::SimTrackerHit</a> &amp;spHit : ecalSpHits) {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      <a class="code" href="classldmx_1_1SimSpecialID.html">ldmx::SimSpecialID</a> hit_id(spHit.getID());</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <span class="keywordflow">if</span> (hit_id.<a class="code" href="classldmx_1_1SimSpecialID.html#a6ab95daab9c99bc99550fbd758380c6f">plane</a>() != 31 || spHit.getMomentum()[2] &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="keywordflow">if</span> (spHit.getTrackID() == recoilTrackID) {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordflow">if</span> (sqrt(pow(spHit.getMomentum()[0], 2) +</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                 pow(spHit.getMomentum()[1], 2) +</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                 pow(spHit.getMomentum()[2], 2)) &gt; pmax) {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;          recoilP = spHit.getMomentum();</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;          recoilPos = spHit.getPosition();</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;          pmax = sqrt(pow(recoilP[0], 2) + pow(recoilP[1], 2) +</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                      pow(recoilP[2], 2));</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">// Find target SP hit for recoil electron</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">if</span> (event.<a class="code" href="classframework_1_1Event.html#a7e65967eea5ac3172852838f1c8f266a">exists</a>(<span class="stringliteral">&quot;TargetScoringPlaneHits&quot;</span>)) {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      std::vector&lt;ldmx::SimTrackerHit&gt; targetSpHits =</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;          <span class="keyword">event</span>.getCollection&lt;<a class="code" href="classldmx_1_1SimTrackerHit.html">ldmx::SimTrackerHit</a>&gt;(<span class="stringliteral">&quot;TargetScoringPlaneHits&quot;</span>);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      pmax = 0;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classldmx_1_1SimTrackerHit.html">ldmx::SimTrackerHit</a> &amp;spHit : targetSpHits) {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <a class="code" href="classldmx_1_1SimSpecialID.html">ldmx::SimSpecialID</a> hit_id(spHit.getID());</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordflow">if</span> (hit_id.<a class="code" href="classldmx_1_1SimSpecialID.html#a6ab95daab9c99bc99550fbd758380c6f">plane</a>() != 1 || spHit.getMomentum()[2] &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">if</span> (spHit.getTrackID() == recoilTrackID) {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;          <span class="keywordflow">if</span> (sqrt(pow(spHit.getMomentum()[0], 2) +</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                   pow(spHit.getMomentum()[1], 2) +</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                   pow(spHit.getMomentum()[2], 2)) &gt; pmax) {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            recoilPAtTarget = spHit.getMomentum();</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            recoilPosAtTarget = spHit.getPosition();</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            pmax =</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                sqrt(pow(recoilPAtTarget[0], 2) + pow(recoilPAtTarget[1], 2) +</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                     pow(recoilPAtTarget[2], 2));</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;          }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      }</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="comment">// Get projected trajectories for electron and photon</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  std::vector&lt;XYCoords&gt; ele_trajectory, photon_trajectory;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="keywordflow">if</span> (recoilP.size() &gt; 0) {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    ele_trajectory = getTrajectory(recoilP, recoilPos);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    std::vector&lt;double&gt; pvec = recoilPAtTarget.size()</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                                   ? recoilPAtTarget</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                                   : std::vector&lt;double&gt;{0.0, 0.0, 0.0};</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    std::vector&lt;float&gt; posvec = recoilPosAtTarget.size()</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                                    ? recoilPosAtTarget</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                                    : std::vector&lt;float&gt;{0.0, 0.0, 0.0};</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    photon_trajectory =</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        getTrajectory({-pvec[0], -pvec[1], 4000.0 - pvec[2]}, posvec);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keywordtype">float</span> recoilPMag =</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      recoilP.size()</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;          ? sqrt(pow(recoilP[0], 2) + pow(recoilP[1], 2) + pow(recoilP[2], 2))</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;          : -1.0;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordtype">float</span> recoilTheta = recoilPMag &gt; 0 ? recoilP[2] / recoilPMag : -1.0;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  std::vector&lt;double&gt; ele_radii = radius68_thetalt10_plt500;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordflow">if</span> (recoilTheta &lt; 10 &amp;&amp; recoilPMag &gt;= 500)</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    ele_radii = radius68_thetalt10_pgt500;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (recoilTheta &gt;= 10 &amp;&amp; recoilTheta &lt; 20)</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    ele_radii = radius68_theta10to20;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (recoilTheta &gt;= 20)</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    ele_radii = radius68_thetagt20;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="comment">// Use default binning</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  std::vector&lt;double&gt; photon_radii = radius68_thetalt10_plt500;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="comment">// Get the collection of digitized Ecal hits from the event.</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keyword">const</span> std::vector&lt;ldmx::EcalHit&gt; ecalRecHits =</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="keyword">event</span>.getCollection&lt;<a class="code" href="classldmx_1_1EcalHit.html">ldmx::EcalHit</a>&gt;(<span class="stringliteral">&quot;EcalRecHits&quot;</span>, rec_pass_name_);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <a class="code" href="classldmx_1_1EcalID.html">ldmx::EcalID</a> globalCentroid =</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      GetShowerCentroidIDAndRMS(ecalRecHits, showerRMS_);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="comment">/* ~~ Fill the hit map ~~ O(n)  */</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <a class="code" href="classecal_1_1EcalVetoProcessor.html#adf676d987dc2ff51dde0373faf1e38e4">fillHitMap</a>(ecalRecHits, cellMap_);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keywordtype">bool</span> doTight = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="comment">/* ~~ Fill the isolated hit maps ~~ O(n)  */</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  fillIsolatedHitMap(ecalRecHits, globalCentroid, cellMap_, cellMapTightIso_,</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                     doTight);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="comment">// Loop over the hits from the event to calculate the rest of the important</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="comment">// quantities</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordtype">float</span> wavgLayerHit = 0;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keywordtype">float</span> xMean = 0;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keywordtype">float</span> yMean = 0;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="comment">// Containment variables</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nregions = 5;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  std::vector&lt;float&gt; electronContainmentEnergy(nregions, 0.0);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  std::vector&lt;float&gt; photonContainmentEnergy(nregions, 0.0);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  std::vector&lt;float&gt; outsideContainmentEnergy(nregions, 0.0);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  std::vector&lt;int&gt; outsideContainmentNHits(nregions, 0);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  std::vector&lt;float&gt; outsideContainmentXmean(nregions, 0.0);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  std::vector&lt;float&gt; outsideContainmentYmean(nregions, 0.0);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  std::vector&lt;float&gt; outsideContainmentXstd(nregions, 0.0);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  std::vector&lt;float&gt; outsideContainmentYstd(nregions, 0.0);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="comment">// MIP tracking:  vector of hits to be used in the MIP tracking algorithm.  All hits inside the</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="comment">// electron ROC (or all hits in the ECal if the event is missing an electron) will be included.</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  std::vector&lt;HitData&gt; trackingHitList;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classldmx_1_1EcalHit.html">ldmx::EcalHit</a> &amp;hit : ecalRecHits) {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">// Layer-wise quantities</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <a class="code" href="classldmx_1_1EcalID.html">ldmx::EcalID</a> <span class="keywordtype">id</span> = hitID(hit);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    ecalLayerEdepRaw_[<span class="keywordtype">id</span>.layer()] =</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        ecalLayerEdepRaw_[<span class="keywordtype">id</span>.layer()] + hit.getEnergy();</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">if</span> (<span class="keywordtype">id</span>.layer() &gt;= 20) ecalBackEnergy_ += hit.getEnergy();</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">if</span> (maxCellDep_ &lt; hit.getEnergy()) maxCellDep_ = hit.getEnergy();</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">if</span> (hit.getEnergy() &gt; 0) {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      nReadoutHits_++;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      ecalLayerEdepReadout_[<span class="keywordtype">id</span>.layer()] += hit.getEnergy();</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      ecalLayerTime_[<span class="keywordtype">id</span>.layer()] += (hit.getEnergy()) * hit.getTime();</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      xMean += getCellCentroidXYPair(<span class="keywordtype">id</span>).first * hit.getEnergy();</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      yMean += getCellCentroidXYPair(<span class="keywordtype">id</span>).second * hit.getEnergy();</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      avgLayerHit_ += <span class="keywordtype">id</span>.layer();</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      wavgLayerHit += <span class="keywordtype">id</span>.layer() * hit.getEnergy();</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="keywordflow">if</span> (deepestLayerHit_ &lt; <span class="keywordtype">id</span>.layer()) {</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        deepestLayerHit_ = <span class="keywordtype">id</span>.layer();</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      }</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      XYCoords xy_pair = getCellCentroidXYPair(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <span class="keywordtype">float</span> distance_ele_trajectory =</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;          ele_trajectory.size()</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;              ? sqrt(</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                    pow((xy_pair.first - ele_trajectory[<span class="keywordtype">id</span>.layer()].first), 2) +</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                    pow((xy_pair.second - ele_trajectory[<span class="keywordtype">id</span>.layer()].second),</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                        2))</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;              : -1.0;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keywordtype">float</span> distance_photon_trajectory =</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;          photon_trajectory.size()</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;              ? sqrt(</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                    pow((xy_pair.first - photon_trajectory[<span class="keywordtype">id</span>.layer()].first),</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                        2) +</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                    pow((xy_pair.second - photon_trajectory[<span class="keywordtype">id</span>.layer()].second),</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                        2))</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;              : -1.0;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="comment">// Decide which region a hit goes into and add to sums</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ireg = 0; ireg &lt; nregions; ireg++) {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordflow">if</span> (distance_ele_trajectory &gt;= ireg * ele_radii[<span class="keywordtype">id</span>.layer()] &amp;&amp;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            distance_ele_trajectory &lt; (ireg + 1) * ele_radii[<span class="keywordtype">id</span>.layer()])</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;          electronContainmentEnergy[ireg] += hit.getEnergy();</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordflow">if</span> (distance_photon_trajectory &gt;= ireg * photon_radii[<span class="keywordtype">id</span>.layer()] &amp;&amp;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            distance_photon_trajectory &lt; (ireg + 1) * photon_radii[<span class="keywordtype">id</span>.layer()])</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;          photonContainmentEnergy[ireg] += hit.getEnergy();</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="keywordflow">if</span> (distance_ele_trajectory &gt; (ireg + 1) * ele_radii[<span class="keywordtype">id</span>.layer()] &amp;&amp;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            distance_photon_trajectory &gt;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                (ireg + 1) * photon_radii[<span class="keywordtype">id</span>.layer()]) {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;          outsideContainmentEnergy[ireg] += hit.getEnergy();</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;          outsideContainmentNHits[ireg] += 1;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;          outsideContainmentXmean[ireg] += xy_pair.first * hit.getEnergy();</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;          outsideContainmentYmean[ireg] += xy_pair.second * hit.getEnergy();</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        }</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="comment">// MIP tracking:  Decide whether hit should be added to trackingHitList</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="comment">// If inside e- RoC or if etraj is missing, use the hit for tracking:</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">if</span>(distance_ele_trajectory &gt;= ele_radii[<span class="keywordtype">id</span>.layer()] || distance_ele_trajectory == -1.0) {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <a class="code" href="structecal_1_1EcalVetoProcessor_1_1HitData.html">HitData</a> hd;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        hd.pos = TVector3(xy_pair.first, xy_pair.second, hexReadout.<a class="code" href="classldmx_1_1EcalHexReadout.html#a53eb62b5d96ad24072aff1a1752e0bad">getZPosition</a>(<span class="keywordtype">id</span>.layer())); <span class="comment">//LAYER_Z_POSITIONS[id.layer()]);</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        hd.layer = <span class="keywordtype">id</span>.layer();</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        trackingHitList.push_back(hd);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;[<span class="keywordtype">id</span>, energy] : cellMapTightIso_) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">if</span> (energy &gt; 0) summedTightIso_ += energy;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  }</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iLayer = 0; iLayer &lt; ecalLayerEdepReadout_.size(); iLayer++) {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    ecalLayerTime_[iLayer] =</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        ecalLayerTime_[iLayer] / ecalLayerEdepReadout_[iLayer];</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    summedDet_ += ecalLayerEdepReadout_[iLayer];</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="keywordflow">if</span> (nReadoutHits_ &gt; 0) {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    avgLayerHit_ /= nReadoutHits_;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    wavgLayerHit /= summedDet_;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    xMean /= summedDet_;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    yMean /= summedDet_;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    wavgLayerHit = 0;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    avgLayerHit_ = 0;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    xMean = 0;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    yMean = 0;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ireg = 0; ireg &lt; nregions; ireg++) {</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keywordflow">if</span> (outsideContainmentEnergy[ireg] &gt; 0) {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      outsideContainmentXmean[ireg] /= outsideContainmentEnergy[ireg];</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      outsideContainmentYmean[ireg] /= outsideContainmentEnergy[ireg];</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="comment">// Loop over hits a second time to find the standard deviations.</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classldmx_1_1EcalHit.html">ldmx::EcalHit</a> &amp;hit : ecalRecHits) {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <a class="code" href="classldmx_1_1EcalID.html">ldmx::EcalID</a> <span class="keywordtype">id</span> = hitID(hit);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">if</span> (hit.getEnergy() &gt; 0) {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      xStd_ +=</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;          pow((getCellCentroidXYPair(<span class="keywordtype">id</span>).first - xMean), 2) * hit.getEnergy();</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      yStd_ +=</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;          pow((getCellCentroidXYPair(<span class="keywordtype">id</span>).second - yMean), 2) * hit.getEnergy();</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      stdLayerHit_ += pow((<span class="keywordtype">id</span>.layer() - wavgLayerHit), 2) * hit.getEnergy();</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    XYCoords xy_pair = getCellCentroidXYPair(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordtype">float</span> distance_ele_trajectory =</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        ele_trajectory.size()</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            ? sqrt(pow((xy_pair.first - ele_trajectory[<span class="keywordtype">id</span>.layer()].first), 2) +</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                   pow((xy_pair.second - ele_trajectory[<span class="keywordtype">id</span>.layer()].second), 2))</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            : -1.0;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordtype">float</span> distance_photon_trajectory =</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        photon_trajectory.size()</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            ? sqrt(pow((xy_pair.first - photon_trajectory[<span class="keywordtype">id</span>.layer()].first),</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                       2) +</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                   pow((xy_pair.second - photon_trajectory[<span class="keywordtype">id</span>.layer()].second),</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                       2))</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            : -1.0;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ireg = 0; ireg &lt; nregions; ireg++) {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      <span class="keywordflow">if</span> (distance_ele_trajectory &gt; (ireg + 1) * ele_radii[<span class="keywordtype">id</span>.layer()] &amp;&amp;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;          distance_photon_trajectory &gt; (ireg + 1) * photon_radii[<span class="keywordtype">id</span>.layer()]) {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        outsideContainmentXstd[ireg] +=</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            pow((xy_pair.first - outsideContainmentXmean[ireg]), 2) *</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            hit.getEnergy();</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        outsideContainmentYstd[ireg] +=</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            pow((xy_pair.second - outsideContainmentYmean[ireg]), 2) *</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            hit.getEnergy();</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      }</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    }</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160; </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordflow">if</span> (nReadoutHits_ &gt; 0) {</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    xStd_ = sqrt(xStd_ / summedDet_);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    yStd_ = sqrt(yStd_ / summedDet_);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    stdLayerHit_ = sqrt(stdLayerHit_ / summedDet_);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    xStd_ = 0;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    yStd_ = 0;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    stdLayerHit_ = 0;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  }</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160; </div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ireg = 0; ireg &lt; nregions; ireg++) {</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordflow">if</span> (outsideContainmentEnergy[ireg] &gt; 0) {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      outsideContainmentXstd[ireg] =</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;          sqrt(outsideContainmentXstd[ireg] / outsideContainmentEnergy[ireg]);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      outsideContainmentYstd[ireg] =</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;          sqrt(outsideContainmentYstd[ireg] / outsideContainmentEnergy[ireg]);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    }</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="comment">// end loop over sim hits</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; </div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="comment">/* Code for fiducial region below */</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  std::vector&lt;float&gt; faceXY(2);</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160; </div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="keywordflow">if</span> (!recoilP.empty() &amp;&amp; recoilP[2] != 0) {</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    faceXY[0] = ((223.8 - 220.0) * (recoilP[0] / recoilP[2])) + recoilPos[0];</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    faceXY[1] = ((223.8 - 220.0) * (recoilP[1] / recoilP[2])) + recoilPos[1];</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    faceXY[0] = -9999.0;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    faceXY[1] = -9999.0;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="keywordtype">int</span> inside = 0;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="keywordtype">int</span> up = 0;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordtype">int</span> step = 0;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="keywordtype">int</span> index;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordtype">float</span> cell_radius = 5.0;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  std::vector&lt;float&gt;::iterator it;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  it = std::lower_bound(mapsx.begin(), mapsx.end(), faceXY[0]);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160; </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  index = std::distance(mapsx.begin(), it);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <span class="keywordflow">if</span> (index == mapsx.size()) {</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    index += -1;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  }</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="keywordflow">if</span> (!recoilP.empty() &amp;&amp; faceXY[0] != -9999.0) {</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      std::vector&lt;double&gt; dis(2);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      dis[0] = faceXY[0] - mapsx[index + step];</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      dis[1] = faceXY[1] - mapsy[index + step];</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160; </div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <span class="keywordtype">float</span> celldis = sqrt(pow(dis[0], 2) + pow(dis[1], 2));</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      <span class="keywordflow">if</span> (celldis &lt;= cell_radius) {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        inside = 1;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      }</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      <span class="keywordflow">if</span> ((abs(dis[0]) &gt; 5 &amp;&amp; up == 0) || index + step == mapsx.size() - 1) {</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        up = 1;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        step = 0;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((abs(dis[0]) &gt; 5 &amp;&amp; up == 1) ||</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                 (index + step == 0 &amp;&amp; up == 1)) {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      }</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160; </div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <span class="keywordflow">if</span> (up == 0) {</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        step += 1;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        step += -1;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      }</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    }</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  }</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="comment">// MIP tracking starts here</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="comment">/* Goal:  Calculate </span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">   *  nStraightTracks (self-explanatory), </span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">   *  nLinregTracks (tracks found by linreg algorithm),</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="comment">// Find epAng and epSep, and prepare EP trajectory vectors:</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  TVector3 e_traj_start;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  TVector3 e_traj_end;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  TVector3 p_traj_start;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  TVector3 p_traj_end;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="keywordflow">if</span>(ele_trajectory.size() &gt; 0 &amp;&amp; photon_trajectory.size() &gt; 0) {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="comment">// Create TVector3s marking the start and endpoints of each projected trajectory</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    e_traj_start.SetXYZ(ele_trajectory[0].first,    ele_trajectory[0].second,   hexReadout.<a class="code" href="classldmx_1_1EcalHexReadout.html#a53eb62b5d96ad24072aff1a1752e0bad">getZPosition</a>(0)); <span class="comment">// LAYER_Z_POSITIONS.front());</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    e_traj_end.SetXYZ(  ele_trajectory[33].first,    ele_trajectory[33].second, hexReadout.<a class="code" href="classldmx_1_1EcalHexReadout.html#a53eb62b5d96ad24072aff1a1752e0bad">getZPosition</a>(33)); <span class="comment">//   LAYER_Z_POSITIONS.back());</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    p_traj_start.SetXYZ(photon_trajectory[0].first, photon_trajectory[0].second, hexReadout.<a class="code" href="classldmx_1_1EcalHexReadout.html#a53eb62b5d96ad24072aff1a1752e0bad">getZPosition</a>(0)); <span class="comment">//LAYER_Z_POSITIONS.front());</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    p_traj_end.SetXYZ(  photon_trajectory[33].first, photon_trajectory[33].second, hexReadout.<a class="code" href="classldmx_1_1EcalHexReadout.html#a53eb62b5d96ad24072aff1a1752e0bad">getZPosition</a>(33));  <span class="comment">//LAYER_Z_POSITIONS.back());</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    TVector3 evec   = e_traj_end - e_traj_start;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    TVector3 e_norm = evec.Unit();</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    TVector3 pvec   = p_traj_end - p_traj_start;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    TVector3 p_norm = pvec.Unit();</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="comment">// Separation variables are currently unused due to pT bias concerns and low efficiency</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="comment">// May be removed after a more careful MIP tracking study</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordtype">float</span> epDot = e_norm.Dot(p_norm);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <a class="code" href="classecal_1_1EcalVetoProcessor.html#a9014314f0e3a6b42697d127476ecc87f">epAng_</a> = acos(epDot) * 180.0 / M_PI;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <a class="code" href="classecal_1_1EcalVetoProcessor.html#a1fd58d76fb9e6367f4f298c6e9ddd099">epSep_</a> = sqrt( pow(e_traj_start.X() - p_traj_start.X(), 2) +</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                   pow(e_traj_start.Y() - p_traj_start.Y(), 2) );</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="comment">// Electron trajectory is missing, so all hits in the Ecal are fair game.</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="comment">// Pick e/ptraj so that they won&#39;t restrict the tracking algorithm (place them far outside the ECal).</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    e_traj_start = TVector3(999,999,hexReadout.<a class="code" href="classldmx_1_1EcalHexReadout.html#a53eb62b5d96ad24072aff1a1752e0bad">getZPosition</a>(0)); <span class="comment">//0);</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    e_traj_end = TVector3(999,999,hexReadout.<a class="code" href="classldmx_1_1EcalHexReadout.html#a53eb62b5d96ad24072aff1a1752e0bad">getZPosition</a>(33)); <span class="comment">// 999);</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    p_traj_start = TVector3(1000,1000,hexReadout.<a class="code" href="classldmx_1_1EcalHexReadout.html#a53eb62b5d96ad24072aff1a1752e0bad">getZPosition</a>(0)); <span class="comment">//0);</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    p_traj_end = TVector3(1000,1000,hexReadout.<a class="code" href="classldmx_1_1EcalHexReadout.html#a53eb62b5d96ad24072aff1a1752e0bad">getZPosition</a>(33)); <span class="comment">//1000);</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <a class="code" href="classecal_1_1EcalVetoProcessor.html#a9014314f0e3a6b42697d127476ecc87f">epAng_</a> = 3.0 + 1.0;  <span class="comment">/*ensures event will not be vetoed by angle/separation cut  */</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <a class="code" href="classecal_1_1EcalVetoProcessor.html#a1fd58d76fb9e6367f4f298c6e9ddd099">epSep_</a> = 10.0 + 1.0;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  }</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="comment">// Near photon step:  Find the first layer of the ECal where a hit near the projected</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="comment">// photon trajectory is found</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="comment">// Currently unusued pending further study; performance has dropped between v9 and v12.</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <a class="code" href="classecal_1_1EcalVetoProcessor.html#ab1d46988d80f6ebedeb2f3bb2b49d648">firstNearPhLayer_</a> = hexReadout.<a class="code" href="classldmx_1_1EcalHexReadout.html#a53eb62b5d96ad24072aff1a1752e0bad">getZPosition</a>(33);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="keywordflow">if</span>(photon_trajectory.size() != 0) {  <span class="comment">//If no photon trajectory, leave this at the default (ECal back)</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordflow">for</span>(std::vector&lt;HitData&gt;::iterator it = trackingHitList.begin(); it != trackingHitList.end(); ++it) {</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      <span class="keywordtype">float</span> ehDist = sqrt( pow((*it).pos.X() - photon_trajectory[(*it).layer].first,  2)</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                         + pow((*it).pos.Y() - photon_trajectory[(*it).layer].second, 2));</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      <span class="keywordflow">if</span>(ehDist &lt; 8.7 &amp;&amp; (*it).layer &lt; <a class="code" href="classecal_1_1EcalVetoProcessor.html#ab1d46988d80f6ebedeb2f3bb2b49d648">firstNearPhLayer_</a>) {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <a class="code" href="classecal_1_1EcalVetoProcessor.html#ab1d46988d80f6ebedeb2f3bb2b49d648">firstNearPhLayer_</a> = (*it).layer;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <span class="comment">// Find straight MIP tracks:</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160; </div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  std::sort(trackingHitList.begin(), trackingHitList.end(), [](<a class="code" href="structecal_1_1EcalVetoProcessor_1_1HitData.html">HitData</a> ha, <a class="code" href="structecal_1_1EcalVetoProcessor_1_1HitData.html">HitData</a> hb) {return ha.layer &gt; hb.layer;});</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="comment">// For merging tracks:  Need to keep track of existing tracks</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="comment">// Candidate tracks to merge in will always be in front of the current track (lower z), so only store the last hit</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="comment">// 3-layer vector:  each track = vector of 3-tuples (xy+layer).</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  std::vector&lt;std::vector&lt;HitData&gt;&gt; track_list;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="keywordtype">float</span> cellWidth = 8.7;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iHit = 0; iHit &lt; trackingHitList.size(); iHit++) {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordtype">int</span> track[34];  <span class="comment">// list of hit numbers in track (34 = maximum theoretical length)</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordtype">int</span> currenthit;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordtype">int</span> trackLen;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160; </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    track[0] = iHit;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    currenthit = iHit;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    trackLen = 1;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="comment">// Search for hits to add to the track:  if hit is in the next two layers behind the current hit,</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="comment">// consider adding.</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jHit = 0; jHit &lt; trackingHitList.size(); jHit++) {</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      <span class="keywordflow">if</span> (trackingHitList[jHit].layer == trackingHitList[currenthit].layer ||</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;          trackingHitList[jHit].layer &gt; trackingHitList[currenthit].layer + 3) {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="keywordflow">continue</span>;  <span class="comment">// if not in the next two layers, continue</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="comment">//if it is:  add to track if new hit is directly behind the current hit.</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="keywordflow">if</span> (trackingHitList[jHit].pos.X() == trackingHitList[currenthit].pos.X() &amp;&amp;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;          trackingHitList[jHit].pos.Y() == trackingHitList[currenthit].pos.Y()) {</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        track[trackLen] = jHit;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        trackLen++;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      }</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    }</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="comment">// Confirm that the track is valid:</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordflow">if</span> (trackLen &lt; 2) <span class="keywordflow">continue</span>;   <span class="comment">// Track must contain at least 2 hits</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <span class="keywordtype">float</span> closest_e = <a class="code" href="classecal_1_1EcalVetoProcessor.html#a37f49d60dc28d5a56e6497b9bc901a42">distTwoLines</a>(trackingHitList[track[0]].pos, trackingHitList[track[trackLen-1]].pos,</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                                     e_traj_start, e_traj_end);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      <span class="keywordtype">float</span> closest_p = <a class="code" href="classecal_1_1EcalVetoProcessor.html#a37f49d60dc28d5a56e6497b9bc901a42">distTwoLines</a>(trackingHitList[track[0]].pos, trackingHitList[track[trackLen-1]].pos,</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                                     p_traj_start, p_traj_end);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      <span class="comment">// Make sure that the track is near the photon trajectory and away from the electron trajectory</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <span class="comment">// Details of these constraints may be revised</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <span class="keywordflow">if</span> (closest_p &gt; cellWidth and closest_e &lt; 2*cellWidth) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <span class="keywordflow">if</span> (trackLen &lt; 4 and closest_e &gt; closest_p) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="comment">//if track found, increment nStraightTracks and remove all hits in track from future consideration</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="keywordflow">if</span> (trackLen &gt;= 2) {</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        std::vector&lt;HitData&gt; temp_track_list;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> kHit = 0; kHit &lt; trackLen; kHit++) {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;          temp_track_list.push_back(trackingHitList[track[kHit]]);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;          trackingHitList.erase(trackingHitList.begin() + track[kHit]);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        track_list.push_back(temp_track_list);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="comment">//The *current* hit will have been removed, so iHit is currently pointing to the next hit.</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        iHit--;  <span class="comment">//Decrement iHit so no hits will get skipped by iHit++</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <span class="comment">//nStraightTracks_++; // moved to post-merging</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      }</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  }</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <span class="comment">//Optional addition:  Merge nearby straight tracks.  Not necessary for veto.</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="comment">// Criteria:  consider tail of track.  Merge if head of next track is 1/2 layers behind, within 1 cell of xy position.</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="comment">//std::cout &lt;&lt; &quot;BEGINNING TRACK MERGING&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160; </div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> track_i = 0; track_i &lt; track_list.size(); track_i++) {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="comment">// for each track, check the remainder of the track list for compatible tracks</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    std::vector&lt;HitData&gt; base_track = track_list[track_i];</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <a class="code" href="structecal_1_1EcalVetoProcessor_1_1HitData.html">HitData</a> tail_hitdata = base_track.back(); <span class="comment">// xylayer of last hit in track</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot;  Considering track &quot; &lt;&lt; track_i &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> track_j = track_i+1; track_j &lt; track_list.size(); track_j++) {</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="comment">//std::cout &lt;&lt; &quot;    Checking for compatibility: &quot; &lt;&lt; track_j &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      std::vector&lt;HitData&gt; checking_track = track_list[track_j];</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <a class="code" href="structecal_1_1EcalVetoProcessor_1_1HitData.html">HitData</a> head_hitdata = checking_track.front();</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <span class="comment">// if 1-2 layers behind, and xy within one cell...</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="keywordflow">if</span> ((head_hitdata.layer == tail_hitdata.layer+1 || head_hitdata.layer == tail_hitdata.layer+2)</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;          &amp;&amp; pow(pow(head_hitdata.pos.X()-tail_hitdata.pos.X(),2)</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;               + pow(head_hitdata.pos.Y()-tail_hitdata.pos.Y(),2), 0.5) &lt;= cellWidth) {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <span class="comment">// ...then append the second track to the first one and delete it</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="comment">// NOTE:  TO ADD:  (trackingHitList[iHit].pos - trackingHitList[jHit].pos).Mag()</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">        std::cout &lt;&lt; &quot;     **Compatible track found!  Adding track, deleting stuff...&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment">        std::cout &lt;&lt; &quot;     Tail xylayer: &quot; &lt;&lt; head_hitdata.pos.X() &lt;&lt; &quot;,&quot; &lt;&lt; head_hitdata.pos.Y() &lt;&lt; &quot;,&quot; &lt;&lt; head_hitdata.layer &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">        std::cout &lt;&lt; &quot;     Head xylayer: &quot; &lt;&lt; tail_hitdata.pos.X() &lt;&lt; &quot;,&quot; &lt;&lt; tail_hitdata.pos.Y() &lt;&lt; &quot;,&quot; &lt;&lt; tail_hitdata.layer &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> hit_k = 0; hit_k &lt; checking_track.size(); hit_k++) {</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;          base_track.push_back(track_list[track_j][hit_k]);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        }</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        track_list.erase(track_list.begin() + track_j);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      }</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    }</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  }</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <a class="code" href="classecal_1_1EcalVetoProcessor.html#a93ec63e453896ba66ef975c428f9c712">nStraightTracks_</a> = track_list.size();</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; </div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="comment">// Linreg tracking:</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160; </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="comment">//std::cout &lt;&lt; &quot;Finding linreg tracks...&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160; </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iHit = 0; iHit &lt; trackingHitList.size(); iHit++) {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot;hit &quot; &lt;&lt; iHit &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordtype">int</span> track[34];</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordtype">int</span> trackLen;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keywordtype">int</span> currenthit;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordtype">int</span> hitsInRegion[50]; <span class="comment">// Hits being considered at one time</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="keywordtype">int</span> nHitsInRegion;    <span class="comment">// Number of hits under consideration</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    TMatrixD svdMatrix(3,3);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    TMatrixD Vm(3,3);</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    TMatrixD hdt(3,3);</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    TVector3 slopeVec;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    TVector3 hmean;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    TVector3 hpoint;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keywordtype">float</span> r_corr_best;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordtype">int</span> hitNums_best[3]; <span class="comment">// Hit numbers of current best track candidate</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keywordtype">int</span> hitNums[3];</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160; </div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    trackLen = 0;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    nHitsInRegion = 1;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    currenthit = iHit;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    hitsInRegion[0] = iHit;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot;filling hitsInRegion, tracking list size=&quot; &lt;&lt; trackingHitList.size() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="comment">// Find all hits within 2 cells of the primary hit:</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jHit = 0; jHit &lt; trackingHitList.size(); jHit++) {</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      <span class="comment">//std::cout &lt;&lt; &quot;iHit, jHit:  &quot; &lt;&lt; iHit &lt;&lt; &quot;, &quot; &lt;&lt; jHit &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      <span class="keywordtype">float</span> dstToHit = (trackingHitList[iHit].pos - trackingHitList[jHit].pos).Mag();</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      <span class="comment">//std::cout &lt;&lt; &quot;  Filling hitsInRegion, tracking list len=&quot; &lt;&lt; trackingHitList.size() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      <span class="keywordflow">if</span> (dstToHit &lt;= 2*cellWidth) {</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        hitsInRegion[nHitsInRegion] = jHit;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        nHitsInRegion++;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    }</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160; </div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot;...ready&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="comment">// Look at combinations of hits within the region (do not consider the same combination twice):</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    hitNums[0] = iHit;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jHit = 1; jHit &lt; nHitsInRegion - 1; jHit++) {</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      <span class="keywordflow">if</span> (trackingHitList.size() &lt; 3) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      hitNums[1] = jHit;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> kHit = jHit + 1; kHit &lt; nHitsInRegion; kHit++) {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        hitNums[2] = kHit;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> hInd = 0; hInd &lt; 3; hInd++) {</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;          <span class="comment">//std::cout &lt;&lt; &quot;    inner loop&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;          <span class="comment">// hmean = geometric mean, subtract off from hits to improve SVD performance</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;          hmean(hInd) = (trackingHitList[hitNums[0]].pos(hInd) +</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                         trackingHitList[hitNums[1]].pos(hInd) +</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                         trackingHitList[hitNums[2]].pos(hInd))/3.0;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        }</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> hInd = 0; hInd &lt; 3; hInd++) {</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> lInd = 0; lInd &lt; 3; lInd++) {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            hdt(hInd,lInd) = trackingHitList[hitNums[hInd]].pos(lInd) - hmean(lInd);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;          }</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160; </div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="comment">// Perform &quot;linreg&quot; on selected points:</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        TDecompSVD svdObj = TDecompSVD(hdt);</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        <span class="keywordtype">bool</span> decomposed = svdObj.Decompose();</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="comment">//std::cout &lt;&lt; &quot;    Decomposed&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">if</span> (!decomposed) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        Vm = svdObj.GetV();  <span class="comment">// First col of V matrix is the slope of the best-fit line</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> hInd = 0; hInd &lt; 3; hInd++) {</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;          slopeVec(hInd) = Vm[0][hInd];</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        hpoint = slopeVec + hmean;  <span class="comment">// hmean, hpoint are points on the best-fit line</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <span class="comment">//linreg complete:  Now have best-fit line for 3 hits under consideration</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <span class="comment">//Check whether the track is valid:  r^2 must be high, and the track must plausibly originate from the photon</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="keywordtype">float</span> closest_e = <a class="code" href="classecal_1_1EcalVetoProcessor.html#a37f49d60dc28d5a56e6497b9bc901a42">distTwoLines</a>(hmean, hpoint, e_traj_start, e_traj_end);</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keywordtype">float</span> closest_p = <a class="code" href="classecal_1_1EcalVetoProcessor.html#a37f49d60dc28d5a56e6497b9bc901a42">distTwoLines</a>(hmean, hpoint, p_traj_start, p_traj_end);</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <span class="comment">// Projected track must be close to the photon; details may change after future study.</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordflow">if</span> (closest_p &gt; cellWidth or closest_e &lt; 1.5*cellWidth) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="comment">//find r^2</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        <span class="keywordtype">float</span> vrnc = (trackingHitList[hitNums[0]].pos - hmean).Mag() +</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                     (trackingHitList[hitNums[1]].pos - hmean).Mag() +</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                     (trackingHitList[hitNums[2]].pos - hmean).Mag();  <span class="comment">// ~variance</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="keywordtype">float</span> sumerr = <a class="code" href="classecal_1_1EcalVetoProcessor.html#ac3f3c4ab9e566df0852362f993cf5c62">distPtToLine</a>(trackingHitList[hitNums[0]].pos, hmean, hpoint) +</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                       <a class="code" href="classecal_1_1EcalVetoProcessor.html#ac3f3c4ab9e566df0852362f993cf5c62">distPtToLine</a>(trackingHitList[hitNums[1]].pos, hmean, hpoint) +</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                       <a class="code" href="classecal_1_1EcalVetoProcessor.html#ac3f3c4ab9e566df0852362f993cf5c62">distPtToLine</a>(trackingHitList[hitNums[2]].pos, hmean, hpoint); <span class="comment">// sum of |errors|</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <span class="keywordtype">float</span> r_corr = 1 - sumerr/vrnc;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <span class="comment">// Check whether r^2 exceeds a low minimum r_corr:  &quot;Fake&quot; tracks are still much more common in background, so making the algorithm</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <span class="comment">// oversensitive doesn&#39;t lower performance significantly</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <span class="keywordflow">if</span> (r_corr &gt; r_corr_best and r_corr &gt; .6) {</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;          r_corr_best = r_corr;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;          trackLen = 0;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;3; k++) { <span class="comment">// Only looking for 3-hit tracks currently</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            track[k] = hitNums[k];</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            trackLen++;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;          }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        }</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <span class="comment">//std::cout &lt;&lt; &quot;    inner loop done!&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      }</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    }</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="comment">// Ordinarily, additional hits in line w/ track would be added here.  However, this doesn&#39;t affect the results of the simple veto.</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="comment">// Exclude all hits in a found track from further consideration:</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="keywordflow">if</span> (trackLen &gt;= 2) {</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      <a class="code" href="classecal_1_1EcalVetoProcessor.html#aaaec7b90b44da7583bc91477536a7b53">nLinregTracks_</a>++;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      <span class="comment">//std::cout &lt;&lt; &quot;  Hitlist size = &quot; &lt;&lt; trackingHitList.size() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> kHit = 0; kHit &lt; trackLen; kHit++) {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        trackingHitList.erase(trackingHitList.begin() + track[kHit]);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <span class="comment">//std::cout &lt;&lt; &quot;  Hitlist size = &quot; &lt;&lt; trackingHitList.size() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      iHit--;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    }</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160; </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="comment">//std::cout &lt;&lt; &quot;  MIP tracking completed&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160; </div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160; </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  result.<a class="code" href="classldmx_1_1EcalVetoResult.html#aecfbc81227a2c8a02fdc024248bb2b47">setVariables</a>(</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      nReadoutHits_, deepestLayerHit_, summedDet_, summedTightIso_, maxCellDep_,</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      showerRMS_, xStd_, yStd_, avgLayerHit_, stdLayerHit_, ecalBackEnergy_,</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      <a class="code" href="classecal_1_1EcalVetoProcessor.html#a93ec63e453896ba66ef975c428f9c712">nStraightTracks_</a>, <a class="code" href="classecal_1_1EcalVetoProcessor.html#aaaec7b90b44da7583bc91477536a7b53">nLinregTracks_</a>, <a class="code" href="classecal_1_1EcalVetoProcessor.html#ab1d46988d80f6ebedeb2f3bb2b49d648">firstNearPhLayer_</a>, <a class="code" href="classecal_1_1EcalVetoProcessor.html#a9014314f0e3a6b42697d127476ecc87f">epAng_</a>, <a class="code" href="classecal_1_1EcalVetoProcessor.html#a1fd58d76fb9e6367f4f298c6e9ddd099">epSep_</a>, </div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      electronContainmentEnergy, photonContainmentEnergy,</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      outsideContainmentEnergy, outsideContainmentNHits, outsideContainmentXstd,</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      outsideContainmentYstd, ecalLayerEdepReadout_, recoilP, recoilPos);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160; </div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="keywordflow">if</span> (doBdt_) {</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    buildBDTFeatureVector(result);</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    ldmx::Ort::FloatArrays inputs({bdtFeatures_});</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="keywordtype">float</span> pred = rt_-&gt;run({<span class="stringliteral">&quot;features&quot;</span>}, inputs, {<span class="stringliteral">&quot;probabilities&quot;</span>})[0].at(1);</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="comment">// Removing electron-photon separation step, near photon step due to lower v12 performance; may reconsider</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordtype">bool</span> passesTrackingVeto = (<a class="code" href="classecal_1_1EcalVetoProcessor.html#a93ec63e453896ba66ef975c428f9c712">nStraightTracks_</a> &lt; 3) &amp;&amp; (<a class="code" href="classecal_1_1EcalVetoProcessor.html#aaaec7b90b44da7583bc91477536a7b53">nLinregTracks_</a> == 0);</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                              <span class="comment">//&amp;&amp;  //Commenting the remainder for now</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                              <span class="comment">//(firstNearPhLayer_ &gt;= 6); //&amp;&amp; (epAng_ &gt; 3.0 || epSep_ &gt; 10.0);</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    result.setVetoResult(pred &gt; bdtCutVal_ &amp;&amp; passesTrackingVeto);</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    result.setDiscValue(pred);</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="comment">// std::cout &lt;&lt; &quot;  pred &gt; bdtCutVal = &quot; &lt;&lt; (pred &gt; bdtCutVal_) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="comment">// If the event passes the veto, keep it. Otherwise,</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="comment">// drop the event.</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">if</span> (result.<a class="code" href="classldmx_1_1EcalVetoResult.html#a5d3f09ec9c6d39280d70aedca0508b92">passesVeto</a>() &amp;&amp; inside) {</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <a class="code" href="classframework_1_1EventProcessor.html#a2f93ec80a4207c3847d629482e81989d">setStorageHint</a>(framework::hint_shouldKeep);</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <a class="code" href="classframework_1_1EventProcessor.html#a2f93ec80a4207c3847d629482e81989d">setStorageHint</a>(framework::hint_shouldDrop);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  }</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="keywordflow">if</span> (inside) {</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <a class="code" href="classframework_1_1EventProcessor.html#a2f93ec80a4207c3847d629482e81989d">setStorageHint</a>(framework::hint_shouldKeep);</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <a class="code" href="classframework_1_1EventProcessor.html#a2f93ec80a4207c3847d629482e81989d">setStorageHint</a>(framework::hint_shouldDrop);</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  }</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="keyword">event</span>.add(<a class="code" href="classecal_1_1EcalVetoProcessor.html#acd4bcfdf71db97e44d1bca93b9d642af">collectionName_</a>, result);</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  hexReadout_ = 0;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;}</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160; </div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">/* Function to calculate the energy weighted shower centroid */</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<a class="code" href="classldmx_1_1EcalID.html">ldmx::EcalID</a> EcalVetoProcessor::GetShowerCentroidIDAndRMS(</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="keyword">const</span> std::vector&lt;ldmx::EcalHit&gt; &amp;ecalRecHits, <span class="keywordtype">double</span> &amp;showerRMS) {</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  <span class="keyword">auto</span> wgtCentroidCoords = std::make_pair&lt;float, float&gt;(0., 0.);</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="keywordtype">float</span> sumEdep = 0;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <a class="code" href="classldmx_1_1EcalID.html">ldmx::EcalID</a> returnCellId;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160; </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="comment">// Calculate Energy Weighted Centroid</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classldmx_1_1EcalHit.html">ldmx::EcalHit</a> &amp;hit : ecalRecHits) {</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <a class="code" href="classldmx_1_1EcalID.html">ldmx::EcalID</a> <span class="keywordtype">id</span> = hitID(hit);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    CellEnergyPair cell_energy_pair = std::make_pair(<span class="keywordtype">id</span>, hit.getEnergy());</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    XYCoords centroidCoords = getCellCentroidXYPair(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    wgtCentroidCoords.first = wgtCentroidCoords.first +</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                              centroidCoords.first * cell_energy_pair.second;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    wgtCentroidCoords.second = wgtCentroidCoords.second +</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                               centroidCoords.second * cell_energy_pair.second;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    sumEdep += cell_energy_pair.second;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  }</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  wgtCentroidCoords.first = (sumEdep &gt; 1E-6) ? wgtCentroidCoords.first / sumEdep</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                                             : wgtCentroidCoords.first;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  wgtCentroidCoords.second = (sumEdep &gt; 1E-6)</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;                                 ? wgtCentroidCoords.second / sumEdep</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                                 : wgtCentroidCoords.second;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="comment">// Find Nearest Cell to Centroid</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="keywordtype">float</span> maxDist = 1e6;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classldmx_1_1EcalHit.html">ldmx::EcalHit</a> &amp;hit : ecalRecHits) {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    XYCoords centroidCoords = getCellCentroidXYPair(hitID(hit));</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160; </div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keywordtype">float</span> deltaR =</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        pow(pow((centroidCoords.first - wgtCentroidCoords.first), 2) +</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                pow((centroidCoords.second - wgtCentroidCoords.second), 2),</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            .5);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    showerRMS += deltaR * hit.getEnergy();</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordflow">if</span> (deltaR &lt; maxDist) {</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      maxDist = deltaR;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      returnCellId = hitID(hit);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    }</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  }</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordflow">if</span> (sumEdep &gt; 0) showerRMS = showerRMS / sumEdep;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classldmx_1_1EcalID.html">ldmx::EcalID</a>(0, returnCellId.<a class="code" href="classldmx_1_1EcalID.html#ace22a8676b9cf1079fbcbef690d7d828">module</a>(),</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                      returnCellId.<a class="code" href="classldmx_1_1EcalID.html#a20c985503bfa2a8f9f4591d9006bfb76">cell</a>());  <span class="comment">// flatten</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;}</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00883"></a><span class="lineno"><a class="line" href="classecal_1_1EcalVetoProcessor.html#adf676d987dc2ff51dde0373faf1e38e4">  883</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classecal_1_1EcalVetoProcessor.html#adf676d987dc2ff51dde0373faf1e38e4">EcalVetoProcessor::fillHitMap</a>(</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keyword">const</span> std::vector&lt;ldmx::EcalHit&gt; &amp;ecalRecHits,</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    std::map&lt;ldmx::EcalID, float&gt; &amp;cellMap_) {</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classldmx_1_1EcalHit.html">ldmx::EcalHit</a> &amp;hit : ecalRecHits) {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <a class="code" href="classldmx_1_1EcalID.html">ldmx::EcalID</a> <span class="keywordtype">id</span> = hitID(hit);</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    cellMap_.emplace(<span class="keywordtype">id</span>, hit.getEnergy());</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;}</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160; </div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="keywordtype">void</span> EcalVetoProcessor::fillIsolatedHitMap(</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="keyword">const</span> std::vector&lt;ldmx::EcalHit&gt; &amp;ecalRecHits, <a class="code" href="classldmx_1_1EcalID.html">ldmx::EcalID</a> globalCentroid,</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    std::map&lt;ldmx::EcalID, float&gt; &amp;cellMap_,</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    std::map&lt;ldmx::EcalID, float&gt; &amp;cellMapIso_, <span class="keywordtype">bool</span> doTight) {</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classldmx_1_1EcalHit.html">ldmx::EcalHit</a> &amp;hit : ecalRecHits) {</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="keyword">auto</span> isolatedHit = std::make_pair(<span class="keyword">true</span>, <a class="code" href="classldmx_1_1EcalID.html">ldmx::EcalID</a>());</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <a class="code" href="classldmx_1_1EcalID.html">ldmx::EcalID</a> <span class="keywordtype">id</span> = hitID(hit);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <a class="code" href="classldmx_1_1EcalID.html">ldmx::EcalID</a> flatid(0, <span class="keywordtype">id</span>.module(), <span class="keywordtype">id</span>.cell());</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="keywordflow">if</span> (doTight) {</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      <span class="comment">// Disregard hits that are on the centroid.</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <span class="keywordflow">if</span> (flatid == globalCentroid) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160; </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <span class="comment">// Skip hits that are on centroid inner ring</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classecal_1_1EcalVetoProcessor.html#a6b9494ec9a5bedaaa790317b8cbf696d">isInShowerInnerRing</a>(globalCentroid, flatid)) {</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      }</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    }</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160; </div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="comment">// Skip hits that have a readout neighbor</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="comment">// Get neighboring cell id&#39;s and try to look them up in the full cell map</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <span class="comment">// (constant speed algo.)</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="comment">//  these ideas are only cell/module (must ignore layer)</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    std::vector&lt;ldmx::EcalID&gt; cellNbrIds = getInnerRingCellIds(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160; </div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 6; k++) {</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      <span class="comment">// update neighbor ID to the current layer</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      cellNbrIds[k] = <a class="code" href="classldmx_1_1EcalID.html">ldmx::EcalID</a>(<span class="keywordtype">id</span>.layer(), cellNbrIds[k].module(),</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                                   cellNbrIds[k].cell());</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      <span class="comment">// look in cell hit map to see if it is there</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      <span class="keywordflow">if</span> (cellMap_.find(cellNbrIds[k]) != cellMap_.end()) {</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        isolatedHit = std::make_pair(<span class="keyword">false</span>, cellNbrIds[k]);</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      }</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    }</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="keywordflow">if</span> (!isolatedHit.first) {</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    }</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <span class="comment">// Insert isolated hit</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    cellMapIso_.emplace(<span class="keywordtype">id</span>, hit.getEnergy());</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;}</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160; </div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment">/* Calculate where trajectory intersects ECAL layers using position and momentum</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment"> * at scoring plane */</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;std::vector&lt;std::pair&lt;float, float&gt; &gt; EcalVetoProcessor::getTrajectory(</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    std::vector&lt;double&gt; momentum, std::vector&lt;float&gt; position) {</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  std::vector&lt;XYCoords&gt; positions;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iLayer = 0; iLayer &lt; nEcalLayers_; iLayer++) {</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keywordtype">float</span> posX =</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        position[0] + (momentum[0] / momentum[2]) *</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                          (hexReadout_-&gt;<a class="code" href="classldmx_1_1EcalHexReadout.html#a53eb62b5d96ad24072aff1a1752e0bad">getZPosition</a>(iLayer) - position[2]);</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keywordtype">float</span> posY =</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        position[1] + (momentum[1] / momentum[2]) *</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                          (hexReadout_-&gt;<a class="code" href="classldmx_1_1EcalHexReadout.html#a53eb62b5d96ad24072aff1a1752e0bad">getZPosition</a>(iLayer) - position[2]);</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    positions.push_back(std::make_pair(posX, posY));</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  }</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="keywordflow">return</span> positions;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;}</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160; </div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment">// MIP tracking functions:</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160; </div>
<div class="line"><a name="l00953"></a><span class="lineno"><a class="line" href="classecal_1_1EcalVetoProcessor.html#a37f49d60dc28d5a56e6497b9bc901a42">  953</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classecal_1_1EcalVetoProcessor.html#a37f49d60dc28d5a56e6497b9bc901a42">EcalVetoProcessor::distTwoLines</a>(TVector3 v1, TVector3 v2, TVector3 w1, TVector3 w2) {</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  TVector3 e1 = v1 - v2;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  TVector3 e2 = w1 - w2;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  TVector3 crs = e1.Cross(e2);</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="keywordflow">if</span> (crs.Mag() == 0) {</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="keywordflow">return</span> 100.0;  <span class="comment">// arbitrary large number; edge case that shouldn&#39;t cause</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                   <span class="comment">// problems.</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keywordflow">return</span> std::abs(crs.Dot(v1 - w1) / crs.Mag());</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  }</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;}</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160; </div>
<div class="line"><a name="l00965"></a><span class="lineno"><a class="line" href="classecal_1_1EcalVetoProcessor.html#ac3f3c4ab9e566df0852362f993cf5c62">  965</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classecal_1_1EcalVetoProcessor.html#ac3f3c4ab9e566df0852362f993cf5c62">EcalVetoProcessor::distPtToLine</a>(TVector3 h1, TVector3 p1, TVector3 p2) {</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordflow">return</span> ((h1 - p1).Cross(h1 - p2)).Mag() / (p1 - p2).Mag();</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;}</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160; </div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;}  <span class="comment">// namespace ecal</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160; </div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<a class="code" href="EventProcessor_8h.html#a7896421cd58ee79a1eb300ec836c6c92">DECLARE_PRODUCER_NS</a>(ecal, EcalVetoProcessor);</div>
<div class="ttc" id="aAnalysisUtils_8h_html"><div class="ttname"><a href="AnalysisUtils_8h.html">AnalysisUtils.h</a></div><div class="ttdoc">Collection of utility functions useful for analysis.</div></div>
<div class="ttc" id="aEcalVetoProcessor_8h_html"><div class="ttname"><a href="EcalVetoProcessor_8h.html">EcalVetoProcessor.h</a></div><div class="ttdoc">Class that determines if event is vetoable using ECAL hit information.</div></div>
<div class="ttc" id="aEventConstants_8h_html"><div class="ttname"><a href="EventConstants_8h.html">EventConstants.h</a></div><div class="ttdoc">Class providing string constants for the event model.</div></div>
<div class="ttc" id="aEventProcessor_8h_html_a7896421cd58ee79a1eb300ec836c6c92"><div class="ttname"><a href="EventProcessor_8h.html#a7896421cd58ee79a1eb300ec836c6c92">DECLARE_PRODUCER_NS</a></div><div class="ttdeci">#define DECLARE_PRODUCER_NS(NS, CLASS)</div><div class="ttdoc">Macro which allows the framework to construct a producer given its name during configuration.</div><div class="ttdef"><b>Definition:</b> <a href="EventProcessor_8h_source.html#l00371">EventProcessor.h:371</a></div></div>
<div class="ttc" id="aSimTrackerHit_8h_html"><div class="ttname"><a href="SimTrackerHit_8h.html">SimTrackerHit.h</a></div><div class="ttdoc">Class which encapsulates information from a hit in a simulated tracking detector.</div></div>
<div class="ttc" id="aclassecal_1_1EcalVetoProcessor_html_a1fd58d76fb9e6367f4f298c6e9ddd099"><div class="ttname"><a href="classecal_1_1EcalVetoProcessor.html#a1fd58d76fb9e6367f4f298c6e9ddd099">ecal::EcalVetoProcessor::epSep_</a></div><div class="ttdeci">float epSep_</div><div class="ttdoc">Distance between the projected photon and electron trajectories at the ECal face (currently unused)</div><div class="ttdef"><b>Definition:</b> <a href="EcalVetoProcessor_8h_source.html#l00163">EcalVetoProcessor.h:163</a></div></div>
<div class="ttc" id="aclassecal_1_1EcalVetoProcessor_html_a37f49d60dc28d5a56e6497b9bc901a42"><div class="ttname"><a href="classecal_1_1EcalVetoProcessor.html#a37f49d60dc28d5a56e6497b9bc901a42">ecal::EcalVetoProcessor::distTwoLines</a></div><div class="ttdeci">float distTwoLines(TVector3 v1, TVector3 v2, TVector3 w1, TVector3 w2)</div><div class="ttdef"><b>Definition:</b> <a href="EcalVetoProcessor_8cxx_source.html#l00953">EcalVetoProcessor.cxx:953</a></div></div>
<div class="ttc" id="aclassecal_1_1EcalVetoProcessor_html_a39c839e3d8bf793140f23ddbdd4bec70"><div class="ttname"><a href="classecal_1_1EcalVetoProcessor.html#a39c839e3d8bf793140f23ddbdd4bec70">ecal::EcalVetoProcessor::produce</a></div><div class="ttdeci">void produce(framework::Event &amp;event)</div><div class="ttdef"><b>Definition:</b> <a href="EcalVetoProcessor_8cxx_source.html#l00194">EcalVetoProcessor.cxx:194</a></div></div>
<div class="ttc" id="aclassecal_1_1EcalVetoProcessor_html_a4ca7aa772f98de6fcf0a76caba82fa56"><div class="ttname"><a href="classecal_1_1EcalVetoProcessor.html#a4ca7aa772f98de6fcf0a76caba82fa56">ecal::EcalVetoProcessor::configure</a></div><div class="ttdeci">void configure(framework::config::Parameters &amp;parameters) final override</div><div class="ttdef"><b>Definition:</b> <a href="EcalVetoProcessor_8cxx_source.html#l00129">EcalVetoProcessor.cxx:129</a></div></div>
<div class="ttc" id="aclassecal_1_1EcalVetoProcessor_html_a6b9494ec9a5bedaaa790317b8cbf696d"><div class="ttname"><a href="classecal_1_1EcalVetoProcessor.html#a6b9494ec9a5bedaaa790317b8cbf696d">ecal::EcalVetoProcessor::isInShowerInnerRing</a></div><div class="ttdeci">bool isInShowerInnerRing(ldmx::EcalID centroidID, ldmx::EcalID probeID)</div><div class="ttdef"><b>Definition:</b> <a href="EcalVetoProcessor_8h_source.html#l00064">EcalVetoProcessor.h:64</a></div></div>
<div class="ttc" id="aclassecal_1_1EcalVetoProcessor_html_a9014314f0e3a6b42697d127476ecc87f"><div class="ttname"><a href="classecal_1_1EcalVetoProcessor.html#a9014314f0e3a6b42697d127476ecc87f">ecal::EcalVetoProcessor::epAng_</a></div><div class="ttdeci">float epAng_</div><div class="ttdoc">Angular separation between the projected photon and electron trajectories (currently unused)</div><div class="ttdef"><b>Definition:</b> <a href="EcalVetoProcessor_8h_source.html#l00161">EcalVetoProcessor.h:161</a></div></div>
<div class="ttc" id="aclassecal_1_1EcalVetoProcessor_html_a93ec63e453896ba66ef975c428f9c712"><div class="ttname"><a href="classecal_1_1EcalVetoProcessor.html#a93ec63e453896ba66ef975c428f9c712">ecal::EcalVetoProcessor::nStraightTracks_</a></div><div class="ttdeci">int nStraightTracks_</div><div class="ttdoc">Number of &quot;straight&quot; tracks found in the event.</div><div class="ttdef"><b>Definition:</b> <a href="EcalVetoProcessor_8h_source.html#l00155">EcalVetoProcessor.h:155</a></div></div>
<div class="ttc" id="aclassecal_1_1EcalVetoProcessor_html_aaaec7b90b44da7583bc91477536a7b53"><div class="ttname"><a href="classecal_1_1EcalVetoProcessor.html#aaaec7b90b44da7583bc91477536a7b53">ecal::EcalVetoProcessor::nLinregTracks_</a></div><div class="ttdeci">int nLinregTracks_</div><div class="ttdoc">Number of &quot;linreg&quot; tracks found in the event.</div><div class="ttdef"><b>Definition:</b> <a href="EcalVetoProcessor_8h_source.html#l00157">EcalVetoProcessor.h:157</a></div></div>
<div class="ttc" id="aclassecal_1_1EcalVetoProcessor_html_ab1d46988d80f6ebedeb2f3bb2b49d648"><div class="ttname"><a href="classecal_1_1EcalVetoProcessor.html#ab1d46988d80f6ebedeb2f3bb2b49d648">ecal::EcalVetoProcessor::firstNearPhLayer_</a></div><div class="ttdeci">int firstNearPhLayer_</div><div class="ttdoc">First ECal layer in which a hit is found near the photon (currently unused)</div><div class="ttdef"><b>Definition:</b> <a href="EcalVetoProcessor_8h_source.html#l00159">EcalVetoProcessor.h:159</a></div></div>
<div class="ttc" id="aclassecal_1_1EcalVetoProcessor_html_ac3f3c4ab9e566df0852362f993cf5c62"><div class="ttname"><a href="classecal_1_1EcalVetoProcessor.html#ac3f3c4ab9e566df0852362f993cf5c62">ecal::EcalVetoProcessor::distPtToLine</a></div><div class="ttdeci">float distPtToLine(TVector3 h1, TVector3 p1, TVector3 p2)</div><div class="ttdef"><b>Definition:</b> <a href="EcalVetoProcessor_8cxx_source.html#l00965">EcalVetoProcessor.cxx:965</a></div></div>
<div class="ttc" id="aclassecal_1_1EcalVetoProcessor_html_acd4bcfdf71db97e44d1bca93b9d642af"><div class="ttname"><a href="classecal_1_1EcalVetoProcessor.html#acd4bcfdf71db97e44d1bca93b9d642af">ecal::EcalVetoProcessor::collectionName_</a></div><div class="ttdeci">std::string collectionName_</div><div class="ttdef"><b>Definition:</b> <a href="EcalVetoProcessor_8h_source.html#l00180">EcalVetoProcessor.h:180</a></div></div>
<div class="ttc" id="aclassecal_1_1EcalVetoProcessor_html_adf676d987dc2ff51dde0373faf1e38e4"><div class="ttname"><a href="classecal_1_1EcalVetoProcessor.html#adf676d987dc2ff51dde0373faf1e38e4">ecal::EcalVetoProcessor::fillHitMap</a></div><div class="ttdeci">void fillHitMap(const std::vector&lt; ldmx::EcalHit &gt; &amp;ecalRecHits, std::map&lt; ldmx::EcalID, float &gt; &amp;cellMap_)</div><div class="ttdef"><b>Definition:</b> <a href="EcalVetoProcessor_8cxx_source.html#l00883">EcalVetoProcessor.cxx:883</a></div></div>
<div class="ttc" id="aclassframework_1_1EventProcessor_html_a2f93ec80a4207c3847d629482e81989d"><div class="ttname"><a href="classframework_1_1EventProcessor.html#a2f93ec80a4207c3847d629482e81989d">framework::EventProcessor::setStorageHint</a></div><div class="ttdeci">void setStorageHint(framework::StorageControlHint hint)</div><div class="ttdef"><b>Definition:</b> <a href="EventProcessor_8h_source.html#l00160">EventProcessor.h:160</a></div></div>
<div class="ttc" id="aclassframework_1_1Event_html"><div class="ttname"><a href="classframework_1_1Event.html">framework::Event</a></div><div class="ttdoc">Implements an event buffer system for storing event data.</div><div class="ttdef"><b>Definition:</b> <a href="Event_8h_source.html#l00040">Event.h:40</a></div></div>
<div class="ttc" id="aclassframework_1_1Event_html_a7e65967eea5ac3172852838f1c8f266a"><div class="ttname"><a href="classframework_1_1Event.html#a7e65967eea5ac3172852838f1c8f266a">framework::Event::exists</a></div><div class="ttdeci">bool exists(const std::string &amp;name, const std::string &amp;passName=&quot;&quot;) const</div><div class="ttdef"><b>Definition:</b> <a href="Event_8h_source.html#l00105">Event.h:105</a></div></div>
<div class="ttc" id="aclassframework_1_1config_1_1Parameters_html"><div class="ttname"><a href="classframework_1_1config_1_1Parameters.html">framework::config::Parameters</a></div><div class="ttdef"><b>Definition:</b> <a href="Parameters_8h_source.html#l00027">Parameters.h:27</a></div></div>
<div class="ttc" id="aclassframework_1_1config_1_1Parameters_html_a18206b7c01007dd706abce7e5505eae1"><div class="ttname"><a href="classframework_1_1config_1_1Parameters.html#a18206b7c01007dd706abce7e5505eae1">framework::config::Parameters::getParameter</a></div><div class="ttdeci">T getParameter(const std::string &amp;name) const</div><div class="ttdef"><b>Definition:</b> <a href="Parameters_8h_source.html#l00089">Parameters.h:89</a></div></div>
<div class="ttc" id="aclassldmx_1_1EcalHexReadout_html"><div class="ttname"><a href="classldmx_1_1EcalHexReadout.html">ldmx::EcalHexReadout</a></div><div class="ttdoc">Implementation of ECal hexagonal cell readout.</div><div class="ttdef"><b>Definition:</b> <a href="EcalHexReadout_8h_source.html#l00067">EcalHexReadout.h:67</a></div></div>
<div class="ttc" id="aclassldmx_1_1EcalHexReadout_html_a53eb62b5d96ad24072aff1a1752e0bad"><div class="ttname"><a href="classldmx_1_1EcalHexReadout.html#a53eb62b5d96ad24072aff1a1752e0bad">ldmx::EcalHexReadout::getZPosition</a></div><div class="ttdeci">double getZPosition(int layer) const</div><div class="ttdef"><b>Definition:</b> <a href="EcalHexReadout_8h_source.html#l00107">EcalHexReadout.h:107</a></div></div>
<div class="ttc" id="aclassldmx_1_1EcalHit_html"><div class="ttname"><a href="classldmx_1_1EcalHit.html">ldmx::EcalHit</a></div><div class="ttdoc">Stores reconstructed hit information from the ECAL.</div><div class="ttdef"><b>Definition:</b> <a href="EcalHit_8h_source.html#l00019">EcalHit.h:19</a></div></div>
<div class="ttc" id="aclassldmx_1_1EcalID_html"><div class="ttname"><a href="classldmx_1_1EcalID.html">ldmx::EcalID</a></div><div class="ttdoc">Extension of DetectorID providing access to ECal layers and cell numbers in a hex grid.</div><div class="ttdef"><b>Definition:</b> <a href="EcalID_8h_source.html#l00020">EcalID.h:20</a></div></div>
<div class="ttc" id="aclassldmx_1_1EcalID_html_a20c985503bfa2a8f9f4591d9006bfb76"><div class="ttname"><a href="classldmx_1_1EcalID.html#a20c985503bfa2a8f9f4591d9006bfb76">ldmx::EcalID::cell</a></div><div class="ttdeci">int cell() const</div><div class="ttdef"><b>Definition:</b> <a href="EcalID_8h_source.html#l00111">EcalID.h:111</a></div></div>
<div class="ttc" id="aclassldmx_1_1EcalID_html_ace22a8676b9cf1079fbcbef690d7d828"><div class="ttname"><a href="classldmx_1_1EcalID.html#ace22a8676b9cf1079fbcbef690d7d828">ldmx::EcalID::module</a></div><div class="ttdeci">int module() const</div><div class="ttdef"><b>Definition:</b> <a href="EcalID_8h_source.html#l00087">EcalID.h:87</a></div></div>
<div class="ttc" id="aclassldmx_1_1EcalVetoResult_html"><div class="ttname"><a href="classldmx_1_1EcalVetoResult.html">ldmx::EcalVetoResult</a></div><div class="ttdef"><b>Definition:</b> <a href="EcalVetoResult_8h_source.html#l00024">EcalVetoResult.h:24</a></div></div>
<div class="ttc" id="aclassldmx_1_1EcalVetoResult_html_a5d3f09ec9c6d39280d70aedca0508b92"><div class="ttname"><a href="classldmx_1_1EcalVetoResult.html#a5d3f09ec9c6d39280d70aedca0508b92">ldmx::EcalVetoResult::passesVeto</a></div><div class="ttdeci">bool passesVeto() const</div><div class="ttdef"><b>Definition:</b> <a href="EcalVetoResult_8h_source.html#l00059">EcalVetoResult.h:59</a></div></div>
<div class="ttc" id="aclassldmx_1_1EcalVetoResult_html_aecfbc81227a2c8a02fdc024248bb2b47"><div class="ttname"><a href="classldmx_1_1EcalVetoResult.html#aecfbc81227a2c8a02fdc024248bb2b47">ldmx::EcalVetoResult::setVariables</a></div><div class="ttdeci">void setVariables(int nReadoutHits, int deepestLayerHit, float summedDet, float summedTightIso, float maxCellDep, float showerRMS, float xStd, float yStd, float avgLayerHit, float stdLayerHit, float ecalBackEnergy, int nStraightTracks, int nLinregTracks, int firstNearPhLayer, float epAng, float epSep, std::vector&lt; float &gt; electronContainmentEnergy, std::vector&lt; float &gt; photonContainmentEnergy, std::vector&lt; float &gt; outsideContainmentEnergy, std::vector&lt; int &gt; outsideContainmentNHits, std::vector&lt; float &gt; outsideContainmentXStd, std::vector&lt; float &gt; outsideContainmentYStd, std::vector&lt; float &gt; EcalLayerEdepReadout, std::vector&lt; double &gt; recoilP, std::vector&lt; float &gt; recoilPos)</div></div>
<div class="ttc" id="aclassldmx_1_1SimParticle_html"><div class="ttname"><a href="classldmx_1_1SimParticle.html">ldmx::SimParticle</a></div><div class="ttdef"><b>Definition:</b> <a href="SimParticle_8h_source.html#l00023">SimParticle.h:23</a></div></div>
<div class="ttc" id="aclassldmx_1_1SimSpecialID_html"><div class="ttname"><a href="classldmx_1_1SimSpecialID.html">ldmx::SimSpecialID</a></div><div class="ttdoc">Implements detector ids for special simulation-derived hits like scoring planes.</div><div class="ttdef"><b>Definition:</b> <a href="SimSpecialID_8h_source.html#l00015">SimSpecialID.h:15</a></div></div>
<div class="ttc" id="aclassldmx_1_1SimSpecialID_html_a6ab95daab9c99bc99550fbd758380c6f"><div class="ttname"><a href="classldmx_1_1SimSpecialID.html#a6ab95daab9c99bc99550fbd758380c6f">ldmx::SimSpecialID::plane</a></div><div class="ttdeci">int plane() const</div><div class="ttdef"><b>Definition:</b> <a href="SimSpecialID_8h_source.html#l00078">SimSpecialID.h:78</a></div></div>
<div class="ttc" id="aclassldmx_1_1SimTrackerHit_html"><div class="ttname"><a href="classldmx_1_1SimTrackerHit.html">ldmx::SimTrackerHit</a></div><div class="ttdoc">Represents a simulated tracker hit in the simulation.</div><div class="ttdef"><b>Definition:</b> <a href="SimTrackerHit_8h_source.html#l00024">SimTrackerHit.h:24</a></div></div>
<div class="ttc" id="astructecal_1_1EcalVetoProcessor_1_1HitData_html"><div class="ttname"><a href="structecal_1_1EcalVetoProcessor_1_1HitData.html">ecal::EcalVetoProcessor::HitData</a></div><div class="ttdef"><b>Definition:</b> <a href="EcalVetoProcessor_8h_source.html#l00054">EcalVetoProcessor.h:54</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
		<script src="custom.js"></script>
	</body>
</html>